/*1356045413,173213727*/

if (self.CavalryLogger) { CavalryLogger.start_js(["zn2xf"]); }

__d("FileInputUploader",["ArbiterMixin","DOM","Env","FileForm","Form","copyProperties","submitForm"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('DOM'),i=b('Env'),j=b('FileForm'),k=b('Form'),l=b('copyProperties'),m=b('submitForm');function n(o){this._inputElem=o;this._data={};}l(n.prototype,g,{_formElem:null,_fileForm:null,_uri:null,_allowCrossOrigin:false,_uploadInParallel:false,setURI:function(o){this._uri=o;return this;},setData:function(o){this._data=o;return this;},setAllowCrossOrigin:function(o){this._allowCrossOrigin=!!o;return this;},setUploadInParallel:function(o){this._uploadInParallel=!!o;return this;},send:function(){this._createForm();var o=this._inputElem.cloneNode(false);h.replace(this._inputElem,o);h.appendContent(this._formElem,this._inputElem);h.appendContent(document.body,this._formElem);m(this._formElem);h.replace(o,this._inputElem);this._cleanup();},_onFileFormEvent:function(o,p){this.inform(o,p);},_createForm:function(){this._formElem=h.create('form',{action:this._uri,method:'post'});this._fileForm=new j(this._formElem,null,{allowCrossOrigin:this._allowCrossOrigin,uploadInParallel:this._uploadInParallel});this._fileForm.subscribe(j.EVENTS,this._onFileFormEvent.bind(this));k.createHiddenInputs(l({fb_dtsg:i.fb_dtsg},this._data),this._formElem);},_cleanup:function(){this._fileForm.destroy();this._fileForm=null;h.remove(this._formElem);this._formElem=null;}});e.exports=n;});
__d("ProgressBar",["event-extensions","CSS","DOM","Style","copyProperties","emptyFunction"],function(a,b,c,d,e,f){b('event-extensions');var g=b('CSS'),h=b('DOM'),i=b('Style'),j=b('copyProperties'),k=b('emptyFunction');function l(m,n,o){this._root=m;this._min=n||0;this._max=o||100;this._meter=h.find(m,'div.fill');this._initialPosition=0;this._position=0;this._initialVelocity=0;this._velocity=0;this._acceleration=0;this._loopInterval=30;this._targetPosition=0;this._targetTime=0;this._startTime=null;this._timeout=null;this._onComplete=k;}j(l.prototype,{getRoot:function(){return this._root;},setPosition:function(m){m=this._normalizePosition(m);this._initialPosition=m;this._position=m;this._updateMeter();this.stop();return this;},changeLabel:function(m){var n=h.scry(this._root,'span.label');n.forEach(function(o){h.setContent(o,m);});return this;},setCompleteHandler:function(m){this._onComplete=m||k;return this;},setTarget:function(m,n){clearTimeout(this._timeout);this._targetPosition=m;var o=this._normalizePosition(m);this._targetTime=n;this._initialVelocity=this._velocity;this._initialPosition=this._position;this._acceleration=2*(o-this._initialPosition-this._initialVelocity*n)/(n*n);if(this._position>=o){this._onComplete();}else this._start();return this;},stop:function(){this._velocity=0;this._initialVelocity=0;this._acceleration=0;clearTimeout(this._timeout);return this;},_start:function(){this._startTime=Date.now();this._timeout=setTimeout(this._loop.bind(this),this._loopInterval);return this;},_loop:function(){var m=Date.now()-this._startTime;this._position=(.5*this._acceleration*m*m)+(this._initialVelocity*m)+this._initialPosition;var n=this._velocity;this._velocity=this._acceleration*m+this._initialVelocity;var o=n<0!==this._velocity<0;this._updateMeter();if(this._position>this._normalizePosition(this._targetPosition)||o){this._velocity=this._initialVelocity=0;this._acceleration=0;this.setPosition(this._targetPosition);this._onComplete();}else this._timeout=setTimeout(this._loop.bind(this),this._loopInterval);},_updateMeter:function(){var m=Math.min(Math.max(this._position,0),1);g.conditionClass(this._meter,'empty',m<=0);g.conditionClass(this._meter,'full',m>=1);i.set(this._meter,'width',m*100+'%');},_normalizePosition:function(m){return Math.min(Math.max((m-this._min)/(this._max-this._min),0),1);}});e.exports=l;});
__d("VideoUploadLogger",["AsyncSignal"],function(a,b,c,d,e,f){var g=b('AsyncSignal'),h={SOURCE_SIMPLE:'simple',SOURCE_COMPOSER:'composer',EVENT_STARTED_UPLOADING:'upload.started_uploading',logStartedUploadingVideo:function(i){i.event=h.EVENT_STARTED_UPLOADING;new g('/ajax/video/log/upload/',i).send();}};e.exports=h;});
__d("PhotosMultiUploadInput",["event-extensions","Arbiter","AsyncUploadRequest","Composer","ComposerXDragDrop","ComposerXController","CSS","Dialog","DOM","DragDropTarget","FileForm","FileInputUploader","Parent","PhotosUploadID","PhotosUploadWaterfall","ProgressBar","VideoUploadLogger","$","copyProperties","csx","cx","tx"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('AsyncUploadRequest'),i=b('Composer'),j=b('ComposerXDragDrop'),k=b('ComposerXController'),l=b('CSS'),m=b('Dialog'),n=b('DOM'),o=b('DragDropTarget'),p=b('FileForm'),q=b('FileInputUploader'),r=b('Parent'),s=b('PhotosUploadID'),t=b('PhotosUploadWaterfall'),u=b('ProgressBar'),v=b('VideoUploadLogger'),w=b('$'),x=b('copyProperties'),y=b('csx'),z=b('cx'),aa=b('tx');function ba(ga,ha,ia,ja){this._grid=ea.getInstance(ja.gridID);this._grid.setProgressBarMarkup(ga).setVideoIconMarkup(ha).setConfig(ja);ia.getInput().multiple=(ja.maxselect!=1)&&h.isSupported();ia.subscribe('change',function(ka,event){if(event.getTarget().value)this._grid.doFileUpload(ia);}.bind(this));}x(ba,{imageUploadDone:function(ga,ha,ia,ja){ca[ga].imageUploadDone(ha,ia,ja);},initDragDrop:function(ga,ha){g.inform('PhotosMultiUploadInput/initDragDrop/'+ga,{dragDropArea:ha},g.BEHAVIOR_PERSISTENT);},imageUploadFail:function(ga,ha){ca[ga].removeLoadingIndicator(ha.getFile().uploadID);},doFileUpload:function(ga,ha){ca[ga].doFileUpload(ha);},onFilesDrop:function(ga,ha){ca[ga]._onFilesDrop(ha);},generateLoadingIndicators:function(ga,ha){ca[ga].generateLoadingIndicators(ha);}});var ca={},da=0;function ea(ga){this._loadingIndicators={};this._numRemainingFiles=0;this._progressBarMarkup=null;this._videoIconMarkup=null;this._gridID=ga;this._dragDropTarget=null;this._submitListener=null;this._fileInputInstances=[];g.subscribe('multi-upload/video-removed/'+this._gridID,function(){n.remove(this._videoIconMarkup);this._submitListener&&this._submitListener.remove();this._submitListener=null;this._fileInputInstances.forEach(function(ha){ha.clear();});}.bind(this));g.subscribe('PhotosMultiUploadInput/initDragDrop/'+ga,function(ha,ia){this.initDragDrop(ia.dragDropArea);}.bind(this));}x(ea,{getInstance:function(ga){ca[ga]=ca[ga]||new ea(ga);return ca[ga];}});x(ea.prototype,{getLoadingIndicator:function(ga){var ha=this._loadingIndicators[ga];return ha;},initDragDrop:function(ga){this._dragDropTarget&&this._dragDropTarget.disable();this._dragDropTarget=new o(ga).setOnFilesDropCallback(this._onFilesDrop.bind(this)).setFileFilter(j.filterImages).enable();},setConfig:function(ga){this._config=ga;return this;},setProgressBarMarkup:function(ga){this._progressBarMarkup=ga;return this;},setVideoIconMarkup:function(ga){this._videoIconMarkup=ga;var ha=n.find(ga,"._3ev");Event.listen(ha,'click',this._onVideoRemoved.bind(this));return this;},imageUploadDone:function(ga,ha,ia){var ja=this.getLoadingIndicator(ha);if(!ja)return;if(n.contains(document.body,ja.getRoot())){n.replace(ja.getRoot(),ga);this._numRemainingFiles--;if(this._numRemainingFiles===0)g.inform('multi-upload/images-upload-completed/'+this._gridID);}this._loadingIndicators[ha]=null;g.inform('multi-upload/images-added/'+this._gridID,{fbids:[ia],tagInfo:{}});},generateLoadingIndicators:function(ga){var ha=fa(ga);this._numRemainingFiles+=ha;for(var ia=0;ia<ha;ia++){var ja=this._progressBarMarkup.cloneNode(true);this.insertIntoGrid(ja);var ka;if(ga.files){if(!ga.files[ia].uploadID)ga.files[ia].uploadID=s.getNewID();ka=ga.files[ia].uploadID;}else{ga.uploadID=s.getNewID();ka=ga.uploadID;}this._loadingIndicators[ka]=new u(ja);}},removeFileUpload:function(ga){this._numRemainingFiles=Math.max(0,this._numRemainingFiles-1);this.removeLoadingIndicator(ga);if(this._numRemainingFiles===0)g.inform('multi-upload/images-upload-completed/'+this._gridID);},doFileUpload:function(ga){var ha=false,ia=false;switch(this._config.supportedFileTypes){case 'photos':ia=true;break;case 'videos':ha=true;break;case 'both':ha=ia=true;break;}var ja=ga.getInput().value.split('.').pop().toLowerCase(),ka=ha&&!!this._config.videoExtensions[ja];this._submitListener&&this._submitListener.remove();if(ka){this._videoSelected(ga);}else if(ia){this._photosSelected(ga);}else new m().setBody("Sorry, you can only select video files.").setTitle("Unsupported File").setModal(true).setButtons(m.OK).show();},_photosSelected:function(ga){var ha=ga.getInput(),ia=fa(ha);if(this._config.maxselect>1&&ia>this._config.maxselect){new m().setTitle("Too Many Photos").setBody(aa._("Sorry, you can only add {maxselect} photos to a message. If you'd like, you can add photos to additional messages.",{maxselect:this._config.maxselect})).setButtons(m.OK).setModal(true).show();return;}this._onBeforeAddUploadedImages();this.generateLoadingIndicators(ha);g.inform('multi-upload/images-upload-start/'+this._gridID,{imageCount:ia});var ja=this._config.uploadData;if(ha.uploadID)ja.upload_id=ha.uploadID;var ka=new q(ha).setURI(this._config.photoEndpoint).setData(ja).setAllowCrossOrigin(true).setUploadInParallel(true);ka.subscribe('progress',this._onProgress.bind(this));ka.subscribe('failure',function(ma,na){this.removeFileUpload(na.upload.getFile().uploadID);}.bind(this));ka.subscribe('start',this._onFileUploadStart.bind(this));ka.send();ga.clear();if(this._config.waterfallID){var la=this._config.application?this._config.application:t.APP_COMPOSER;t.sendSignal({qn:this._config.waterfallID,step:t.IMAGES_SELECTED,count:ia,uploader:la,meta:{timesSelected:da++},method:t.METHOD_FILE_SELECTOR});}},_videoSelected:function(ga){var ha=ga.getInput();if(ha.files&&ha.files.length>1){new m().setTitle("Too many files").setBody("Please select only one video file at a time.").setButtons(m.OK).show();return;}g.inform('multi-upload/composer-reset/'+this._gridID);this._dragDropTarget&&this._dragDropTarget.disable();this.insertIntoGrid(this._videoIconMarkup);g.inform('multi-upload/video-added/'+this._gridID);this._fileInputInstances.push(ga);var ia=r.byTag(w(this._gridID),'form');this._submitListener=Event.listen(ia,'submit',this._onVideoSubmit.bind(this,ia,ha),Event.Priority.URGENT);},_onVideoRemoved:function(){this._dragDropTarget&&this._dragDropTarget.enable();g.inform('multi-upload/video-removed/'+this._gridID);},_onVideoSubmit:function(ga,ha){v.logStartedUploadingVideo({target_id:ga.xhpc_targetid,source:v.SOURCE_COMPOSER});ga.action=this._config.videoEndpoint;ha.name='video';var ia=ha.parentNode;l.hide(ha);n.appendContent(ga,ha);l.addClass(ga,"_4_8");var ja=p.getInstance(ga);ja.subscribe(['success','failure'],this._onVideoUploadComplete.bind(this,ga,ha,ia));},_onVideoUploadComplete:function(ga,ha,ia){n.appendContent(ia,ha);l.show(ha);this._onVideoRemoved();l.removeClass(ga,"_4_8");k.reset(ga);},removeLoadingIndicator:function(ga){var ha=this.getLoadingIndicator(ga);ha&&n.remove(ha.getRoot());delete this._loadingIndicators[ga];},_onFileUploadStart:function(ga,ha){var ia=n.find(this.getLoadingIndicator(ha.upload.getFile().uploadID).getRoot(),"._639");l.show(ia);Event.listen(ia,'click',function(){ha.upload.abort();this.removeFileUpload(ha.upload.getFile().uploadID);}.bind(this));},_onProgress:function(ga,ha){var ia=ha.event,ja=this.getLoadingIndicator(ha.upload.getFile().uploadID);if(!ja)return;l.hide(n.find(ja.getRoot(),"._2om"));l.show(n.find(ja.getRoot(),'.uiProgressBar'));if(ia.loaded==ia.total){ja.setPosition(50);ja.setTarget(100,2000);}else ja.setPosition(50*ia.loaded/ia.total);},_onFilesDrop:function(ga){this._onBeforeAddUploadedImages();var ha={files:ga};this.generateLoadingIndicators(ha);g.inform('multi-upload/images-upload-start/'+this._gridID,{imageCount:ga.length});var ia=new h().setData(this._config.uploadData).setFiles(ga).setAllowCrossOrigin(true).setURI(this._config.photoEndpoint);ia.subscribe('failure',function(ka,la){this.removeFileUpload(la.getFile().uploadID);}.bind(this));ia.subscribe('progress',function(ka,la){this._onProgress(ka,{upload:la,event:la.getProgressEvent()});}.bind(this));ia.subscribe('start',function(ka,la){this._onFileUploadStart(ka,{upload:la});}.bind(this));ia.send();if(this._config.waterfallID){var ja=this._config.application?this._config.application:t.APP_COMPOSER;t.sendSignal({qn:this._config.waterfallID,step:t.IMAGES_SELECTED,count:ga.length,uploader:ja,method:t.METHOD_DRAGDROP});}},_onBeforeAddUploadedImages:function(){if(this._config.maxselect==1)g.inform('multi-upload/composer-reset/'+this._gridID);},insertIntoGrid:function(ga){var ha=n.scry(w(this._gridID),"._577")[0];if(ha){n.insertBefore(ha,ga);}else n.prependContent(w(this._gridID),ga);}});function fa(ga){if(ga.files){return ga.files.length;}else return 1;}e.exports=ba;});
__d("TimelineMapScrollableArea",["event-extensions","Animation","ArbiterMixin","CSS","DOM","Run","SimpleDrag","Style","Vector","$","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Animation'),h=b('ArbiterMixin'),i=b('CSS'),j=b('DOM'),k=b('Run'),l=b('SimpleDrag'),m=b('Style'),n=b('Vector'),o=b('$'),p=b('copyProperties');function q(r,s){r&&this.init(o(r),s);}p(q.prototype,h,{init:function(r,s){s=s||{};this._elem=r;this._wrap=j.find(r,'div.fbScrollableAreaWrap');this._body=j.find(this._wrap,'div.fbScrollableAreaBody');this._track=j.find(r,'div.fbScrollableAreaTrack');this._gripper=j.find(this._track,'div.fbScrollableAreaGripper');this._options=s;this.adjustGripper();this._listeners=[Event.listen(this._wrap,'scroll',this._handleScroll.bind(this))];if(s.fade!==false)this._listeners.push(Event.listen(r,'mouseenter',this.adjustGripper.shield(this)),Event.listen(r,'mouseenter',this.showScrollbar.shield(this)),Event.listen(r,'mousemove',this._handleMousemove.bind(this)),Event.listen(r,'mouseout',this.hideScrollbar.shield(this)));if(s.fade!==undefined)this._listeners.push(Event.listen(this._track,'click',this.clickToScroll.bind(this)));if(s.verticalscroll)this._listeners.push(Event.listen(this._wrap,'mousewheel',this.mouseWheel.bind(this)),Event.listen(this._wrap,'DOMMouseScroll',this.mouseWheel.bind(this)));this.initDrag();if(!s.persistent)k.onLeave(this.destroy.bind(this));},initDrag:function(){var r=new l(this._gripper);r.subscribe('start',function(s,event){if(!((event.which&&event.which===1)||(event.button&&event.button===1)))return;this.inform('dragstart');var t=n.getEventPosition(event).x,u=this._gripper.offsetLeft,v=r.subscribe('update',function(x,y){var z=n.getEventPosition(y).x-t,aa=this._elem.clientWidth,ba=this._body.offsetWidth,ca=this._track.offsetWidth,da=aa/ba*ca,ea=ba-this._wrap.offsetWidth,fa=u+z,ga=ca-da;fa=Math.max(Math.min(fa,ga),0);var ha=fa/ga*ea;this._wrap.scrollLeft=ha;}.bind(this)),w=r.subscribe('end',function(){r.unsubscribe(v);r.unsubscribe(w);this.inform('dragend');}.bind(this));}.bind(this));},adjustGripper:function(){var r=this._elem.clientWidth,s=this._body.offsetWidth,t=this._track.offsetWidth,u=r/s*t;if(u<t){m.set(this._gripper,'width',u+'px');var v=this._wrap.scrollLeft/s*t;m.set(this._gripper,'left',v+'px');i.show(this._gripper);}else i.hide(this._gripper);this._checkContentBoundaries();return this;},_checkContentBoundaries:function(){var r=this._wrap.scrollLeft,s=this._wrap.scrollWidth-this._wrap.clientWidth;i.conditionClass(this._elem,'contentBefore',r>0);i.conditionClass(this._elem,'contentAfter',r<s);},destroy:function(){this._listeners.forEach(function(r){r.remove();});this._listeners.length=0;},_handleMousemove:function(event){var r=n.getElementPosition(this._track).y,s=n.getElementDimensions(this._track).y;if(Math.abs(r+s/2-n.getEventPosition(event).y)<25){this.showScrollbar(false);}else this.hideScrollbar();},_handleScroll:function(event){this.adjustGripper();if(this._options.fade!==false)this.showScrollbar();},hideScrollbar:function(){if(!this._scrollbarVisible)return this;this._scrollbarVisible=false;if(this._hideTimeout){clearTimeout(this._hideTimeout);this._hideTimeout=null;}this._hideTimeout=function(){if(this._scrollbarAnimation){this._scrollbarAnimation.stop();this._scrollbarAnimation=null;}this._scrollbarAnimation=new g(this._track).from('opacity',1).to('opacity',0).duration(250).ondone(i.addClass.curry(this._track,'invisible_elem')).go();}.bind(this).defer(750);return this;},showScrollbar:function(r){if(this._scrollbarVisible)return this;this._scrollbarVisible=true;if(this._hideTimeout){clearTimeout(this._hideTimeout);this._hideTimeout=null;}if(this._scrollbarAnimation){this._scrollbarAnimation.stop();this._scrollbarAnimation=null;}this.adjustGripper();m.set(this._track,'opacity',1);i.removeClass(this._track,'invisible_elem');if(r!==false)this.hideScrollbar();return this;},clickToScroll:function(event){var r=n.getEventPosition(event).x,s=this._elem.clientWidth,t=this._body.offsetWidth,u=this._track.offsetWidth,v=s/t*u,w=n.getElementPosition(this._gripper);if(r>=w.x&&r<=w.x+v)return;var x=r<w.x?-1:1,y=this._wrap.offsetWidth*.8*x;this.scrollBy(y);},scrollBy:function(r){var s=this._body.offsetWidth-this._wrap.offsetWidth,t=this._wrap.scrollLeft+r;t=Math.max(Math.min(t,s),0);this._wrap.scrollLeft=t;},mouseWheel:function(event){var r=0;if(event.wheelDelta){var s=event.wheelDelta;if(event.wheelDeltaX&&event.wheelDeltaY)s=Math.abs(event.wheelDeltaX)>Math.abs(event.wheelDeltaY)?event.wheelDeltaX:event.wheelDeltaY;r=-s*10/40;}else if(event.detail)r=event.detail*10;this.scrollBy(r);event.prevent();}});e.exports=a.TimelineMapScrollableArea||q;});
__d("VaultEditableGrid",["event-extensions","Arbiter","AsyncRequest","CSS","DOM","URI","$","copyProperties","csx","ge"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('AsyncRequest'),i=b('CSS'),j=b('DOM'),k=b('URI'),l=b('$'),m=b('copyProperties'),n=b('csx'),o=b('ge'),p={};function q(r,s){p[r.id]=this;this._grid=r;this._gridID=r.id;this._dialogEndpoint=s;this._selectedVaultImageIDs=[];g.subscribe('multi-upload/image-removed/'+this._gridID,function(t,u){this._selectedVaultImageIDs.remove(u);}.bind(this));g.subscribe('multi-upload/composer-reset/'+this._gridID,this.removeImages.bind(this));g.inform('fbVaultEditableGrid/created/'+r.id,this,g.BEHAVIOR_PERSISTENT);g.subscribe('multi-upload/images-upload-start/'+this._gridID,this._scrollToRight.bind(this));}m(q,{getInstance:function(r){return p[r];},registerDialogWithGrid:function(r,s,t){g.subscribe(['multi-upload/images-upload-start/'+r,'multi-upload/video-added/'+r],t.hide.bind(t));g.subscribe('fbVaultEditableGrid/created/'+r,function(u,v){v._registerDialogWithGrid(s,t);});},onImagesSelected:function(r,s,t,u){p[r]._onImagesSelected(s,t,u);}});m(q.prototype,{getRoot:function(){var r=o(this._gridID);if(r){return r;}else return this._grid;},_registerDialogWithGrid:function(r,s){this._dialog=s;var t=this.getMoreLink();t&&Event.listen(t,'click',function(){s.show();return false;});s.subscribe('aftershow',function(){var u=[];j.scry(l(this._gridID),'input[type="hidden"]').forEach(function(w){if(w.name.match('composer_vault_images')||w.name.match('composer_unpublished_photo'))u.push(w.value);});var v=r.getGrid();v.bulkChange(function(){var w=v.getSelectionSet();w.clear();w.addAll(u);});}.bind(this));},getID:function(){return this._gridID;},_onImagesSelected:function(r,s,t){var u=j.find(this.getRoot(),"._577");this.removeImages();this._selectedVaultImageIDs=s;r.forEach(function(v){j.insertBefore(u,v);});g.inform('multi-upload/images-added/'+this._gridID,{fbids:s,tagInfo:t});this._scrollToRight();},removeImages:function(){j.scry(this.getRoot(),'.fbVaultGridItem').forEach(function(r){if(!i.hasClass(r,'fbVaultEditableGridMoreLink'))j.remove(r);});this._selectedVaultImageIDs=[];g.inform('multi-upload/all-images-removed/'+this._gridID);},_scrollToRight:function(){var r=this.getRoot(),s=j.find(r,'.fbScrollableAreaWrap');s.scrollLeft=Math.max(0,j.find(r,'.fbScrollableAreaBody').offsetWidth-s.offsetWidth);},showDialog:function(r){if(this._dialog){this._dialog.show();}else h.bootstrap(this._dialogEndpoint,r);},getMoreLink:function(){return j.scry(this.getRoot(),'.fbVaultEditableGridMoreLink')[0];}});e.exports=q;});
__d("MercuryPhotoUploader",["Arbiter","ArbiterMixin","CSS","copyProperties","DOM","FileInput","Parent","PhotosMultiUploadInput","URI","VaultEditableGrid","TimelineMapScrollableArea","csx","cx","event-extensions"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('CSS'),j=b('copyProperties'),k=b('DOM'),l=b('FileInput'),m=b('Parent'),n=b('PhotosMultiUploadInput'),o=b('URI'),p=b('VaultEditableGrid'),q=b('TimelineMapScrollableArea'),r=b('csx'),s=b('cx');b('event-extensions');function t(u,v,w,x){new q(u,{verticalscroll:true});this._grid=u;this._selectedFBIDs=this._getPreselectedFBIDs();g.subscribe('MercuryPhotoUploader/initUploadButton/'+u.id,function(){var y=k.scry(v,'input[type="file"]')[0];if(!y)y=k.create('input',{accept:'image/*',type:'file',className:"_n",name:'composer_unpublished_photo[]',multiple:1});var z=m.byClass(v,"_9_h"),aa=new l(z,k.find(z,"._214"),y);aa.subscribe('change',n.doFileUpload.curry(u.id,aa));});g.subscribe('MercuryPhotoUploader/registerPhotoMenu/'+u.id,function(y,z){var aa=z.menu.getRoot();z.menu.setContext(v);var ba=k.find(aa,"._d2p");Event.listen(ba,'click',function(){p.getInstance(u.id).showDialog(ba);});Event.listen(v,'click',z.menu.show.bind(z.menu));Event.listen(window,'click',function(event){if(!k.contains(v,event.getTarget())&&!k.contains(ba,event.getTarget()))z.menu.hide();});});w.addSubscriptions(g.subscribe('multi-upload/images-added/'+this._grid.id,function(y,z){this._selectedFBIDs=this._selectedFBIDs.concat(z.fbids);this._imagesChanged();}.bind(this)),g.subscribe('multi-upload/image-removed/'+this._grid.id,function(y,z){this._selectedFBIDs.remove(z);this._imagesChanged();}.bind(this)),g.subscribe('multi-upload/images-upload-start/'+this._grid.id,function(){i.show(this._grid);this.inform('dom-updated');}.bind(this)),g.subscribe('multi-upload/composer-reset/'+this._grid.id,this.clear.bind(this)),g.subscribe('multi-upload/all-images-removed/'+this._grid.id,this._onImagesRemoved.bind(this)),g.subscribe('multi-upload/images-upload-completed/'+this._grid.id,function(y){this.inform('all-uploads-completed');}.bind(this)));i.conditionShow(this._grid,this._selectedFBIDs.length);x&&n.initDragDrop(u.id,x);}j(t,{initUploadButton:function(u){g.inform('MercuryPhotoUploader/initUploadButton/'+u,{},g.BEHAVIOR_PERSISTENT);},registerPhotoMenu:function(u,v){g.inform('MercuryPhotoUploader/registerPhotoMenu/'+u,{menu:v},g.BEHAVIOR_PERSISTENT);}});j(t.prototype,h,{getSelectedFBIDs:function(){return this._selectedFBIDs;},_onImagesRemoved:function(){this._selectedFBIDs=[];i.hide(this._grid);this.inform('dom-updated');},clear:function(){var u=p.getInstance(this._grid.id);u&&u.removeImages();},_getPreselectedFBIDs:function(){var u=[];k.scry(this._grid,'input[type="hidden"]').forEach(function(v){if(v.name.match('composer_vault_images'))u.push(v.value);});return u;},_imagesChanged:function(){i.conditionShow(this._grid,this._selectedFBIDs.length>0);this.inform('dom-updated');}});e.exports=t;});
__d("WebMessengerStateConstants",[],function(a,b,c,d,e,f){var g={STATE_CHANGE_EVENT:'state-changed',DETAIL:{COMPOSE_MAIN:'compose-main',COMPOSE_TYPEAHEAD_RESULTS:'compose-typeahead-results',COMPOSE_ALL_PEOPLE_RESULTS:'compose-all-people-results',RECENT_MESSAGES:'recent-messages',SEARCH_CONTEXT:'search-context',SEARCH_SNIPPET:'search-snippet'},MASTER:{RECENT_THREADS:'recent-threads',SEARCH:'search'},MESSAGE_ACTION:{DELETE:'delete',FORWARD:'forward',REPORT_SPAM:'report_spam'}};e.exports=g;});
__d("WebMessengerOldToNewPermalink",["WebMessengerPermalinkConstants","WebMessengerStateConstants"],function(a,b,c,d,e,f){var g=b('WebMessengerPermalinkConstants'),h=b('WebMessengerStateConstants');function i(n){if(!j(n))return n;k(n);m(n);l(n);return n;}function j(n){var o=n.getQueryData();if(o.sk)switch(o.sk){case 'inbox':n.setPath(g.BASE_PATH);n.removeQueryData('sk');break;case 'other':n.setPath(g.OTHER_PATH);n.removeQueryData('sk');break;default:return false;}return true;}function k(n){var o=n.getQueryData();switch(o.action){case 'read':if(!o.tid){n.addQueryData({action:h.DETAIL.RECENT_MESSAGES});}else n.removeQueryData('action');break;}}function l(n){var o=n.getQueryData();if(o.tid){n.setPath(g.getURIPathForThreadID(o.tid,n.getPath()));n.removeQueryData('tid');}}function m(n){var o=n.getQueryData();if(!n.getPath().match(g.SEARCH_POSTFIX_PATH)&&o.action!=h.DETAIL.SEARCH_SNIPPET&&!o.mid){var p=o.query;if(o.query){var q=/\bis:(archived|spam)\b(.*)/,r=q.exec(o.query);if(r){switch(r[1]){case 'archived':n.setPath(g.ARCHIVED_PATH);break;case 'spam':n.setPath(g.SPAM_PATH);break;}var s=o.query.substr(0,o.query.length-r[0].length),t=r[2];p=(s.trim()+' '+t.trim()).trim();}}if(o.thread_query){n.setPath(n.getPath()+g.SEARCH_POSTFIX_PATH);n.setQueryData({query:o.thread_query});}else if(p){n.setPath(n.getPath()+g.SEARCH_POSTFIX_PATH);n.addQueryData({query:p});}else n.removeQueryData('query');}}e.exports=i;});
__d("WebMessengerStateStore",["MercuryAssert","PresenceState"],function(a,b,c,d,e,f){var g=b('MercuryAssert'),h=b('PresenceState'),i=null;function j(){var l=h.get();if(l&&l.wml)return l.wml;return {};}h.registerStateStorer(function(l){if(i)l.wml=i;i=null;});var k={getLastSeenThreadID:function(){var l=j();return l.thread_id||null;},getLastSeenFolder:function(){var l=j();return l.folder||null;},setLastSeen:function(l,m){m&&g.isThreadID(m);i={folder:l,thread_id:m||null};h.doSync();}};e.exports=k;});
__d("WebMessengerPermalinks",["MercuryConstants","MercuryFilters","MercuryIDs","MercuryParticipants","WebMessengerOldToNewPermalink","WebMessengerPermalinkConstants","MercuryServerRequests","WebMessengerStateConstants","WebMessengerStateStore","MercuryThreads","Token","URI","WebMessengerConstants","goURI"],function(a,b,c,d,e,f){var g=b('MercuryConstants'),h=b('MercuryFilters'),i=b('MercuryIDs'),j=b('MercuryParticipants'),k=b('WebMessengerOldToNewPermalink'),l=b('WebMessengerPermalinkConstants'),m=b('MercuryServerRequests'),n=b('WebMessengerStateConstants'),o=b('WebMessengerStateStore'),p=b('MercuryThreads').get(),q=b('Token'),r=b('URI'),s=b('WebMessengerConstants'),t=b('goURI'),u={getDefaultURI:function(){var ga=new r().setSubdomain('www');ga.setPath(l.BASE_PATH);return ga;},goNextURI:function(ga,ha,ia,ja){if(da(ga,ha,ia)){var ka=u.getURI(ga,ha,ia);t(ka,false,ja);return true;}return false;},getURI:function(ga,ha,ia){var ja=u.getDefaultURI();if(!ga||!ha||!ia)return ja;switch(ia.folder){case g.MessagingTag.OTHER:ja.setPath(l.OTHER_PATH);break;case g.MessagingTag.ACTION_ARCHIVED:ja.setPath(l.ARCHIVED_PATH);break;case g.MessagingTag.SPAM:ja.setPath(l.SPAM_PATH);break;}if(ia.filter&&(ia.filter!=h.ALL))ja.addQueryData({filter:ia.filter});var ka;switch(ga){case n.MASTER.SEARCH:ka=false;ja.setPath(ja.getPath()+l.SEARCH_POSTFIX_PATH);break;}switch(ha){case n.DETAIL.COMPOSE_MAIN:case n.DETAIL.COMPOSE_TYPEAHEAD_RESULTS:case n.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS:ja.setPath(ja.getPath()+l.COMPOSE_POSTFIX_PATH);ka=false;break;case n.DETAIL.RECENT_MESSAGES:ka=!ia.thread_id;break;case n.DETAIL.SEARCH_CONTEXT:ka=false;break;default:ka=true;break;}if(ka)ja.addQueryData({action:ha});if(ia.thread_id){var la=p.getCanonicalUserInThread(ia.thread_id),ma=la&&j.getNow(j.getIDForUser(la));if(ma&&ma.type!==g.MercuryParticipantTypes.EVENT){var na=(ma&&ma.vanity)||la;ja.setPath(l.getURIPathForIDOrVanity(na,ja.getPath()));}else{var oa=m.getServerThreadIDNow(ia.thread_id),pa=oa?oa:ia.thread_id;ja.setPath(l.getURIPathForThreadID(pa,ja.getPath()));}}if(ia.query)ja.addQueryData({query:ia.query});if(ia.message_query)ja.addQueryData({mquery:ia.message_query});if(ia.message_id)ja.addQueryData({mid:ia.message_id});if(ia.reuse_composer)ja.addQueryData({rc:true});return ja;},processURI:function(ga){ga=k(ga);if(!u.isWebMessengerURI(ga))return false;var ha=ea(ga);if(!ha.master_state||!ha.detail_state)return fa(ga);var ia={data:{folder:ba(ga),filter:ca(ga)},redirect:false,master_state:ha.master_state,detail_state:ha.detail_state};if(ga.getQueryData().rc)ia.data.reuse_composer=true;ia=y(ga,ia);switch(ha.detail_state){case n.DETAIL.RECENT_MESSAGES:return aa(ga,ia);case n.DETAIL.COMPOSE_MAIN:return v(ga,ia);case n.DETAIL.SEARCH_SNIPPET:ia=z(ga,ia);return ia;case n.DETAIL.SEARCH_CONTEXT:ia=aa(ga,ia);ia=z(ga,ia);return x(ga,ia);}ia.redirect=true;return ia;},isWebMessengerURI:function(ga){return (/^(\/messages)/).test(ga.getPath());}};function v(ga,ha){var ia=ga.getQueryData().to;return w(ia,ha);}function w(ga,ha){if(ga){var ia=j.getNow(j.getIDForUser(ga));if(ia){var ja={uid:ga,text:ia.name,type:s.USER_TYPE};ha.data.new_tokens=[new q(ja)];}}ha.data.start=true;return ha;}function x(ga,ha){var ia=ga.getQueryData().mid;if(ia){ha.data.message_id=ia;}else ha.redirect=true;return ha;}function y(ga,ha){var ia=ga.getQueryData().query;ha.data.query=ia;return ha;}function z(ga,ha){var ia=ga.getQueryData().mquery;ha.data.message_query=ia;return ha;}function aa(ga,ha){var ia=l.getThreadIDFromURI(ga);if(ia){var ja=i.isValid(ia)?ia:m.getClientThreadIDNow(ia);if(ja){ha.data.thread_id=ja;}else ha.redirect=true;}else{var ka=l.getUserIDOrVanity(ga.getPath());if(ka){var la=j.getIDFromVanityOrFBID(ka),ma=la&&p.getCanonicalThreadToParticipant(la,null,g.MercuryAPIArgsSource&&g.MercuryAPIArgsSource.WEBMESSENGER);if(ma){if(ma.timestamp){ha.data.thread_id=ma.thread_id;}else{ha.detail_state=n.DETAIL.COMPOSE_MAIN;ha=w(j.getUserID(la),ha);}}else ha.redirect=true;}}return ha;}function ba(ga,ha){var ia=ga.getPath();if(ia.match('^'+l.ARCHIVED_PATH))return g.MessagingTag.ACTION_ARCHIVED;if(ia.match('^'+l.OTHER_PATH))return g.MessagingTag.OTHER;if(ia.match('^'+l.SPAM_PATH))return g.MessagingTag.SPAM;if(ha!==undefined)return ha;return g.MessagingTag.INBOX;}function ca(ga){return ga.getQueryData().filter||h.ALL;}function da(ga,ha,ia){if(ha===n.DETAIL.SEARCH_CONTEXT)return false;if(ia&&ia.no_uri===true){delete ia.no_uri;return false;}var ja=ha==n.DETAIL.COMPOSE_MAIN||ha==n.DETAIL.COMPOSE_TYPEAHEAD_RESULTS||ha==n.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS;if(ja&&(!ia.start||ia.new_tokens))return false;if(!ga||!ha||!ia)return true;if(ia.bug_reporting_enabled)return false;return !ia.message_action;}function ea(ga){var ha={},ia=ga.getPath(),ja=ga.getQueryData(),ka=ia.match(l.BASE_PATH+'(/[^/]+)?'+l.SEARCH_POSTFIX_PATH+'(/[^/]+)?');ha.master_state=ka&&ja.query?n.MASTER.SEARCH:n.MASTER.RECENT_THREADS;if(ja.action){ha.detail_state=ja.action;return ha;}if(ia.match(l.BASE_PATH+'(/[^/]+)?'+l.COMPOSE_POSTFIX_PATH)){ha.detail_state=n.DETAIL.COMPOSE_MAIN;return ha;}if(ia.match(l.TID_POSTFIX_PARTIAL_PATH)||l.getUserIDOrVanity(ia)){if(ja.mid&&ja.mquery){ha.detail_state=n.DETAIL.SEARCH_CONTEXT;}else ha.detail_state=n.DETAIL.RECENT_MESSAGES;}else if(ja.mquery)ha.detail_state=n.DETAIL.SEARCH_SNIPPET;return ha;}function fa(ga){var ha=ba(ga,null)||o.getLastSeenFolder(),ia=o.getLastSeenThreadID(),ja={redirect:!!ia||!!ha,replace:true,master_state:n.MASTER.RECENT_THREADS,detail_state:n.DETAIL.RECENT_MESSAGES,data:{folder:ha||g.MessagingTag.INBOX,filter:h.ALL,thread_id:ia}};return ja;}e.exports=u;});
__d("WebMessengerStateManager",["Arbiter","MercuryConstants","Dialog","JSLogger","MercuryFilters","WebMessengerPermalinks","WebMessengerStateConstants","copyProperties","tx"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('MercuryConstants'),i=b('Dialog'),j=b('JSLogger'),k=b('MercuryFilters'),l=b('WebMessengerPermalinks'),m=b('WebMessengerStateConstants'),n=b('copyProperties'),o=b('tx'),p=j.create('wm_state_manager'),q=n(new g(),{getCurrentMasterState:function(){return u;},getCurrentDetailState:function(){return v;},getCurrentStateData:function(){return w;},updateMasterState:function(y,z){q.updateAllStates(y,v,z);},updateDetailState:function(y,z){q.updateAllStates(u,y,z);},updateAllStates:function(y,z,aa){for(var ba=0;ba<x.length;ba++)if(x[ba]){var ca=x[ba](y,z,aa);if(ca){t(ca,y,z,aa);return;}}r(y,z,aa);},updateStateOnURI:function(y,z,aa){s(y,z,aa);},registerConfirmationBeforeStateUpdate:function(y){var z=x.length;x.push(y);return z;},unregisterConfirmationBeforeStateUpdate:function(y){delete x[y];}});function r(y,z,aa){if(!aa.folder)aa.folder=w.folder;if(!aa.filter)aa.filter=w.filter;if(!l.goNextURI(y,z,aa))s(y,z,aa);}function s(y,z,aa){u=y;v=z;w=aa;var ba=n({},w);ba.new_tokens=[];(w.new_tokens||[]).forEach(function(ca){ba.new_tokens.push(ca.getInfo());});ba.new_tokens=[];p.log('state_updated',{master_state:u,detail_state:v,data:ba});q.inform(m.STATE_CHANGE_EVENT);}function t(y,z,aa,ba){p.log('confirmation_dialog',{master_state:u,detail_state:v,data:w,new_master_state:z,new_detail_state:aa,new_data:ba,text:y});var ca=[];ca.push({name:'yes',label:"Yes",handler:r.curry(z,aa,ba)});ca.push(i.CANCEL);new i().setTitle("Are you sure you want to navigate away?").setBody(y).setButtons(ca).setModal(true).show();}var u=m.MASTER.RECENT_THREADS,v=m.DETAIL.RECENT_MESSAGES,w={thread_id:null,folder:h.MessagingTag.INBOX,filter:k.ALL},x=[undefined];e.exports=q;});
__d("WebMessengerAdsControl",["event-extensions","Arbiter","CSS","DOM","Env","KeyedCallbackManager","MercuryParticipants","MercuryThreads","UIPagelet","URI","UserActivity","Vector","WebMessengerStateManager","cx","WebMessengerSubscriptionsHandler","copyProperties","csx","throttle","WebMessengerConstants"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('CSS'),i=b('DOM'),j=b('Env'),k=b('KeyedCallbackManager'),l=b('MercuryParticipants'),m=b('MercuryThreads').get(),n=b('UIPagelet'),o=b('URI'),p=b('UserActivity'),q=b('Vector'),r=b('WebMessengerStateManager'),s=b('cx'),t=b('WebMessengerSubscriptionsHandler'),u=b('copyProperties'),s=b('cx'),v=b('csx'),w=b('throttle'),x=b('WebMessengerConstants'),y=x.ADS_ROTATION_INTERVAL_PASSIVE,z=x.ADS_ROTATION_THRESHOLD_ACTIVE,aa=x.MAX_ADS,ba=2,ca=165,da='data-height',ea=new k(),fa='webMessengerAdsStage',ga=0;function ha(){}u(ha,{init:function(){this._ads=null;this._loadingCount=null;this._stage=null;this._drawCount=0;this._lastRefresh=0;this._pageletInProgress=null;this._lastMousedOnAds=false;this._waitOn(['codes','container','sidebar','footer'],this.start.bind(this));t.addSubscriptions(p.subscribe(this._refreshIfReady.shield(this)),g.subscribe('footerLoaded',function(){ea.setResource('footer',1);}),g.subscribe(['sidebar/initialized','sidebar/show','sidebar/hide'],this._sideBarChanged.bind(this)),ea);return this;},setContainer:function(oa){ea.setResource('container',oa);this._container=oa;},setTrackingCodes:function(oa){ea.setResource('codes',oa);},getTrackingCodes:function(){return ea.getResource('codes');},start:function(){this._stage=i.create('div',{id:fa,className:"_2rn"});this._ego=i.find(this._container,"._81");i.insertAfter(this._ego,this._stage);this._updateFooterHeight();this.waitForAdsLoad(this._container,this._processOnPageUnits.bind(this));t.addSubscriptions(Event.listen(window,'resize',w(this.draw,100,this)),Event.listen(this._ego,'mouseenter',this._mouseEvent.shield(this,true)),Event.listen(this._ego,'mouseleave',this._mouseEvent.shield(this,false)));},stateChanged:function(oa,pa){oa=oa||{};pa=pa||{};if(oa.thread_id&&pa.thread_id&&pa.thread_id!==oa.thread_id)this._refreshIfReady(true);},draw:function(){var oa=this._loadingCount<=0;if(!this._ads||!this._drawCount&&!oa)return;this._adjustAdsToFit();},_processOnPageUnits:function(){this._ads=ma(this._ego);this._adjustAdsToFit();},_processStagedUnits:function(){this._pageletInProgress=false;var oa=ma(this._stage);if(!this._lastMousedOnAds&&oa.length&&!this._focusedOnAds()){i.empty(this._ego);while(this._stage.childNodes.length)i.appendContent(this._ego,this._stage.firstChild);this._ads=oa;this._lastRefresh=Date.now();this._adjustAdsToFit();}},waitForAdsLoad:function(oa,pa){var qa=ma(oa);this._loadingCount=qa.length;if(!this._loadingCount){this._lastRefresh=Date.now()-y/2;this._pageletInProgress=false;return;}var ra=function(sa){la(sa);if(--this._loadingCount<=0)pa();}.bind(this);qa.forEach(function(sa){function ta(){ra.curry(sa).defer();}var ua=i.scry(sa,'img.img')[0];if(!ua||ua.complete){ta();}else Event.listen(ua,{load:ta,error:ta,abort:ta});}.bind(this));},_adjustAdsToFit:function(){this._drawCount++;var oa=q.getViewportDimensions().y,pa=oa-this._footerHeight-ca,qa=0;while(pa>0&&qa<this._ads.length){pa-=ka(this._ads[qa]);if(pa>=0)qa++;}qa=Math.max(qa,ba);for(var ra=0;ra<this._ads.length;ra++)ja(this._ads[ra],ra>=qa);h.conditionShow(this._ego,qa);var sa=i.scry(this._container,'.ego_section');sa.forEach(function(ta){ia(ta,i.scry(ta,'[data-onscreen]').length);});ia(this._container,true);this._registerImpressions(qa);},_waitOn:function(oa,pa){ea.executeOrEnqueue(oa,pa);},_mouseEvent:function(oa){this._lastMousedOnAds=oa;},_focusedOnAds:function(){return i.contains(this._container,document.activeElement);},_refreshIfReady:function(oa){var pa=oa?z:y;if(this._lastRefresh===0){this._lastRefresh=Date.now();return;}else if(this._pageletInProgress||!this._drawCount||this._lastMousedOnAds||this._focusedOnAds()||this._lastRefresh+pa>Date.now())return;ea.reset();this._waitOn(['codes'],this.waitForAdsLoad.bind(this,this._stage,this._processStagedUnits.bind(this)));this._pageletInProgress=n.loadFromEndpoint('WebEgoPane',fa,{pid:43,data:[j.user,aa,++ga,na()]},{crossPage:true,bundle:false});},_updateFooterHeight:function(){h.hide(this._ego);this._footerHeight=q.getElementDimensions(this._container).y;h.show(this._ego);},_registerImpressions:function(oa){for(var pa=oa-1;pa>=0;--pa){if(!this._ads[pa])continue;var qa=i.scry(this._ads[pa],"div._4u8");if(!qa.length)continue;var ra=qa[0].getAttribute('data-ad'),sa=JSON.parse(ra).adid,ta=this.getTrackingCodes();if(!ta||!ta[sa])return;var ua=i.create('iframe',{src:o('/ai.php').addQueryData({aed:ta[sa]}),width:0,height:0,frameborder:0,scrolling:'no',className:'fbEmuTracking'});ua.setAttribute('aria-hidden','true');i.appendContent(this._container,ua);delete ta[sa];}},_sideBarChanged:function(oa,pa){if(oa=='sidebar/initialized')ea.setResource('sidebar',1);this._ads&&this.draw();}});function ia(oa,pa){h.conditionClass(oa,"_2rn",!pa);}function ja(oa,pa){h.conditionClass(oa,"_22r",pa);oa.setAttribute('aria-hidden',pa?'true':'false');if(pa){oa.removeAttribute('data-onscreen');}else oa.setAttribute('data-onscreen','1');}function ka(oa){if(!oa)return 0;var pa=oa.getAttribute(da)||la(oa);return parseInt(pa,10);}function la(oa){var pa=q.getElementDimensions(oa).y;oa.setAttribute(da,pa);return pa;}function ma(oa){return i.scry(oa,'div.ego_unit');}function na(){var oa=r.getCurrentStateData();if(oa.thread_id){var pa=m.getThreadMetaNow(oa.thread_id);if(pa)return pa.participants.map(l.getUserID).filter(function(qa){return qa&&qa!=j.user;});}return [];}e.exports=ha;});
__d("MercuryDataSources",[],function(a,b,c,d,e,f){var g={},h={add:function(i,j){g[i]=j;},get:function(i){!g[i];return g[i];}};e.exports=h;});
__d("ExpandableDataSource",["Class","copyProperties","DataSource"],function(a,b,c,d,e,f){var g=b('Class'),h=b('copyProperties'),i=b('DataSource');function j(k,l,m){this._initialLimit=l;this._moreResultsLimit=m;this._states={};k=k||{};k.maxResults=this._initialLimit;this.parent.construct(this,k);}g.extend(j,i);h(j.prototype,{query:function(k,l,m){this.setQueryData({offset:0,limit:this._initialLimit});this.parent.query(k,l,m);},fetchHandler:function(k,l){var m=k.getPayload(),n=l.value;this.getState('is_loading_more_per_query')[this.value]=false;this.getState('total_results_count_per_query')[this.value]=m.total_count;this.parent.fetchHandler(k,l);},loadMore:function(){if(this.value&&!this.hasLoadedAllResults()){var k=this.getState('max_results_per_query');if(!k[this.value])k[this.value]=this._initialLimit;this.setQueryData({offset:k[this.value],limit:this._moreResultsLimit});k[this.value]+=this._moreResultsLimit;if(k[this.value]>this._maxResults)this._maxResults=k[this.value];this.getState('is_loading_more_per_query')[this.value]=true;this.fetch(this.queryEndpoint,this.getQueryData(this.value,this.buildUids(this.value)),{value:this.value});}},isLoadingMore:function(){return this.getState('is_loading_more_per_query')[this.value];},hasLoadedAllResults:function(){var k=this.getState('total_results_count_per_query')[this.value],l=(this.buildQueryResults(this.value)||[]).length;return k&&l>=k;},getStates:function(){return this._states;},getState:function(k){var l=this.getStates();if(!l[k])l[k]={};return l[k];},getQueryCache:function(){return this.getState('query_cache');}});e.exports=j;});
__d("WebMessengerEvents",["Arbiter","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties'),i=h(new g(),{MASTER_DOM_CHANGED:'master-dom-changed',DETAIL_DOM_CHANGED:'detail-dom-changed',FOCUS_COMPOSER:'focus-composer',FOCUS_SEARCH:'focus-search',FOCUS_AND_SELECT_SEARCH:'focus-and-select-search',SUBMIT_REPLY:'submit-reply',UPDATE_SELECTION:'update-selection',masterDOMChanged:function(){this.inform(i.MASTER_DOM_CHANGED);},detailDOMChanged:function(){this.inform(i.DETAIL_DOM_CHANGED);},focusComposer:function(){this.inform(i.FOCUS_COMPOSER);},focusSearch:function(){this.inform(i.FOCUS_SEARCH);},focusAndSelectSearch:function(){this.inform(i.FOCUS_AND_SELECT_SEARCH);},updateSelection:function(j){this.inform(i.UPDATE_SELECTION,j);},submitReply:function(){this.inform(i.SUBMIT_REPLY);}});e.exports=i;});
__d("MercuryShareLinkUploader",["ArbiterMixin","AsyncRequest","CSS","copyProperties","DOM","Form","HTML","URLScraper","WebMessengerEvents","event-extensions"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('AsyncRequest'),i=b('CSS'),j=b('copyProperties'),k=b('DOM'),l=b('Form'),m=b('HTML'),n=b('URLScraper'),o=b('WebMessengerEvents');b('event-extensions');function p(s,t,u,v,w){this._stageElement=s;this._stageContentElement=t;this._stageLoadingElement=u;this._isShareLoaded=false;this._shareInProgress=null;Event.listen(v,'click',this.close.bind(this));this._scraper=new n(w);this._scraper.subscribe('match',r.curry(this));}j(p.prototype,g);j(p.prototype,{getAttachData:function(){if(this._isShareLoaded){return l.serialize(this._stageElement);}else return null;},check:function(){this._scraper.check();},close:function(){q(this);this._scraper.disable();this.inform('closed');},clear:function(){q(this);this._scraper.enable();},enable:function(){this._scraper.enable();},disable:function(){this._scraper.disable();}});function q(s){i.hide(s._stageElement);s._isShareLoaded=false;s._shareInProgress=null;s._scraper.reset();o.detailDOMChanged();}function r(s,event,t){s._shareInProgress=t.url;new h().setMethod('POST').setURI('/ajax/share_scrape.php').setData({u:t.url}).setHandler(function(u){if(s._shareInProgress!==t.url)return;s._shareInProgress=null;i.show(s._stageElement);k.empty(s._stageContentElement);k.setContent(s._stageContentElement,m(u.payload));s._isShareLoaded=true;o.detailDOMChanged();}).setStatusElement(s._stageLoadingElement).send();s.inform('link-detected');}e.exports=p;});
__d("MercuryTypeaheadRenderer",["event-extensions","MercuryConstants","CSS","DOM","MercuryImageTemplates","MercuryTypeaheadTemplates","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('MercuryConstants'),h=b('CSS'),i=b('DOM'),j=b('MercuryImageTemplates'),k=b('MercuryTypeaheadTemplates'),l=b('copyProperties');function m(o,p){var q=g.MercuryTypeaheadConstants,r;switch(o.type){case q.HEADER_TYPE:r=k[':fb:mercury:typeahead:header'].build();m.renderHeader(r,o);break;case q.USER_TYPE:r=k[':fb:mercury:typeahead:result'].build();m.renderPerson(r,o);break;default:throw new Error('Unsupported result type: '+o.type);}return r.getRoot();}l(m,{renderHeader:function(o,p){if(p.disabled){h.hide(o.getRoot());return;}var q=p.getLinkHandler&&p.getLinkHandler();if(q){var r=o.getNode('link');i.setContent(r,p.linkText);Event.listen(r,'click',q);}else h.hide(o.getNode('link'));o.setNodeContent('text',p.text);},renderPersonWithBigPhoto:function(o,p){var q=j[':fb:mercury:thread-image:single'].build();n(o,p,q);},renderPerson:function(o,p){var q=j[':fb:mercury:thread-image:single:medium'].build();n(o,p,q);}});function n(o,p,q){if(p.photo){q.getRoot().setAttribute('src',p.photo);i.setContent(o.getNode('image'),q.getRoot());}if(p.text){i.setContent(o.getNode('name'),p.text);o.getRoot().setAttribute('aria-label',p.text);}if(p.subtext||p.category){var r='';if(p.subtext){r+=p.subtext;if(p.category)r+=" \u00b7 ";}if(p.category)r+=p.category;i.setContent(o.getNode('snippet'),r);}}e.exports=m;});
__d("WebMessengerAddPeopleToConversationDialog",["event-extensions","MercuryConstants","ContextualTypeaheadView","Dialog","DOM","FreeformTokenizerBehavior","MercuryDataSources","MercuryTypeahead","MercuryTypeaheadRenderer","MercuryMessages","WebMessengerTemplates","MercuryThreads","WebMessengerConstants","tx"],function(a,b,c,d,e,f){b('event-extensions');var g=b('MercuryConstants'),h=b('ContextualTypeaheadView'),i=b('Dialog'),j=b('DOM'),k=b('FreeformTokenizerBehavior'),l=b('MercuryDataSources'),m=b('MercuryTypeahead'),n=b('MercuryTypeaheadRenderer'),o=b('MercuryMessages'),p=b('WebMessengerTemplates'),q=b('MercuryThreads').get(),r=b('WebMessengerConstants'),s=b('tx'),t={show:function(v){var w="Add People",x={};x[r.FRIEND_TYPE]={uid:r.FRIEND_TYPE,type:r.HEADER_TYPE,disabled:true};x[r.NON_FRIEND_TYPE]={uid:r.NON_FRIEND_TYPE,text:"Other People",type:r.HEADER_TYPE};var y=new m(l.get('MercuryRecipientsDataSource'),h);y.setViewOption('renderer',n);y.setViewOption('typeObjects',x);y.addTokenizerBehavior({behavior:k,config:{matcher:r.VALID_EMAIL}});y.setPlaceholder("Enter a friend's name");var z=[];z.push({name:'subscribe',label:w,handler:u.bind(null,v,y)});z.push(i.CANCEL);var aa=p[':fb:web-messenger:add-people-dialog'].build(),ba=new i().setTitle(w).setBody(aa.getRoot()).setButtons(z).showLoading();q.getThreadMeta(v,function(ca){y.setFullWidthView(aa.getNode('participantsTypeahead'));y.setExcludedParticipants(ca.participants);y.build();j.appendContent(aa.getNode('participantsTypeahead'),y.getElement());ba.show();y.focus();},g.MercuryAPIArgsSource&&g.MercuryAPIArgsSource.WEBMESSENGER);}};function u(v,w){var x=w.getTokens(),y=x.map(function(z){if(z.getInfo().type==r.USER_TYPE){return 'fbid:'+z.getValue();}else return 'email:'+z.getValue();});if(!y.length)return false;o.sendMessage(o.constructLogMessageObject(g.MercurySourceType.TITAN_WEB,v,g.MercuryLogMessageType.SUBSCRIBE,{added_participants:y}),null,g.MercuryAPIArgsSource&&g.MercuryAPIArgsSource.WEBMESSENGER);return true;}e.exports=t;});
__d("Autosize",["CSS","cx","DOM","DOMQuery","Style"],function(a,b,c,d,e,f){var g=b("CSS"),h=b('cx'),i=b("DOM"),j=b("DOMQuery"),k=b("Style"),l=['fontFamily','fontStyle','fontVariant','fontWeight','letterSpacing','textDecoration','textIndent','textTransform','whiteSpace','wordSpacing','wordWrap'],m=/^[0-9]+$/;function n(s){var t=s.cloneNode(true);g.addClass(t,"_4g");var u=s.clientWidth-k.getFloat(s,'paddingLeft')-k.getFloat(s,'paddingRight');k.set(t,'width',u+'px');var v=s.clientHeight-k.getFloat(s,'paddingTop')-k.getFloat(s,'paddingBottom');k.set(t,'height',v+'px');i.insertAfter(s,t);return t;}function o(s,t,u,v,w){var x=s.style.fontSize,y=s.style.height;k.set(s,"height","auto");if(t!==null){var z=s.style.width;k.set(s,"width","auto");}var aa=0,ba=w.length-1;while(aa<ba){var ca=Math.ceil((aa+ba)/2);k.set(s,"font-size",w[ca]+v);if((u!==null&&s.scrollHeight>u)||(t!==null&&s.scrollWidth>t)){ba=ca-1;}else aa=ca;}s.style.fontSize=x;s.style.height=y;if(t!==null)s.style.width=z;return w[aa]+v;}function p(s,t,u,v,w,x){var y=s.style.fontSize,z=s.style.height;k.set(s,"height","auto");if(t!==null){var aa=s.style.width;k.set(s,"width","auto");}k.set(s,"font-size",x+v);if((u===null||s.scrollHeight<=u)&&(t===null||s.scrollWidth<=t)){s.style.fontSize=y;s.style.height=z;if(t!==null)s.style.width=aa;return x+v;}k.set(s,"font-size",w+v);if((u!==null&&s.scrollHeight>u)||(t!==null&&s.scrollWidth>t)){s.style.fontSize=y;s.style.height=z;if(t!==null)s.style.width=aa;return w+v;}while(w+1<x){var ba=Math.ceil((w+x)/2);k.set(s,"font-size",ba+v);if((u!==null&&s.scrollHeight>u)||(t!==null&&s.scrollWidth>t)){x=ba;}else w=ba;}s.style.fontSize=y;s.style.height=z;if(t!==null)s.style.width=aa;return w+v;}function q(s,t){this._wrap=s;this._attr=t;if(this._attr.sizes){var u=this._attr.sizes;for(var v=1,w=u.length;v<w;v++){if(u[v-1]<=u[v])continue;u.sort(function(y,z){return y-z;});break;}}else if(t.min>t.max){var x=t.min;t.min=t.max;t.max=x;}this.fit();}q.prototype.fit=function(s,t){var u=this._wrap;if(!u.clientWidth){r.push(this);return;}var v=n(u);if(typeof s==="undefined")s=this._attr.width;if(m.test(s)){v.style.width=s+"px";}else if(s!==null&&s!=="auto")v.style.width=s;if(typeof t==="undefined")t=this._attr.height;if(m.test(t)){v.style.height=t+"px";}else if(t!==null&&t!=="auto")v.style.height=t;var w=null;if(!this._attr.wrap)w=v.clientWidth;var x=null;if(this._attr.wrap||t!==null)x=v.clientHeight;var y;if(this._attr.sizes){y=o(v,w,x,"px",this._attr.sizes);}else y=p(v,w,x,"px",this._attr.min,this._attr.max);i.remove(v);k.set(u,"font-size",y);g.removeClass(u,"invisible_elem");};var r=[];q.onNodeInserted=function(){var s=r;r=[];s.forEach(function(t){t.fit();});};e.exports=q;});
__d("WebMessengerEditThreadDialog",["event-extensions","Button","MercuryConstants","ContextualDialog","CSS","DOM","FileInput","FileInputUploader","Input","InputSelection","LayerFadeOnHide","LayerFadeOnShow","MercuryMessages","WebMessengerTemplates","MercuryThreads","URI","WebMessengerSubscriptionsHandler","copyProperties","csx","cx"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Button'),h=b('MercuryConstants'),i=b('ContextualDialog'),j=b('CSS'),k=b('DOM'),l=b('FileInput'),m=b('FileInputUploader'),n=b('Input'),o=b('InputSelection'),p=b('LayerFadeOnHide'),q=b('LayerFadeOnShow'),r=b('MercuryMessages'),s=b('WebMessengerTemplates'),t=b('MercuryThreads').get(),u=b('URI'),v=b('WebMessengerSubscriptionsHandler'),w=b('copyProperties'),x=b('csx'),y=b('cx'),z=':fb:web-messenger:read-view:header:edit-multichat',aa=function(){var ba=s[z].build();this._dialog=new i({position:'below',addedBehaviors:[p,q]},ba.getRoot());this._saveButton=ba.getNode('saveButton');this._pictureInput=ba.getNode('newPicture');this._uploadButton=ba.getNode('uploadButton');this._uploadingThrobber=ba.getNode('uploadingThrobber');this._uploadedFileDetails=ba.getNode('uploadedFileDetails');this._fileNameNode=ba.getNode('fileName');this._cancelImageButton=ba.getNode('cancelImage');this._threadID=null;var ca=ba.getNode('newName');this._uploadedImage=null;if(!this._pictureInput){var da=k.scry(ba.getRoot(),"._8-9")[0];this._pictureInput=k.create('input',{type:'file',className:"_n",name:'attachment[]',multiple:1,tabindex:1});new l(da,this._uploadButton,this._pictureInput);}this._uploader=new m(this._pictureInput);this._uploader.setURI(u('/ajax/mercury/upload.php').setSubdomain('attachments').toString());v.addSubscriptions(this._uploader.subscribe('success',this._onFileUploadSuccess.bind(this)),Event.listen(this._pictureInput,'change',this._onFileUploadChange.bind(this)),Event.listen(this._cancelImageButton,'click',this._resetImageUpload.bind(this)));this._dialog.subscribe('submit',function(){this.save(n.getValue(ca));}.bind(this));this._dialog.subscribe('show',function(){var ea=t.getThreadMetaNow(this._threadID);n.setValue(ca,ea.name);this._resetImageUpload();}.bind(this));this._dialog.subscribe('aftershow',function(){o.set(ca,0,n.getValue(ca).length);}.bind(this));};w(aa.prototype,{toggleShown:function(ba,ca){if(!this._dialog.isShown()){this._dialog.setContext(ba);this._threadID=ca;this._uploadedImage=null;this._dialog.show();}else this._dialog.hide();},save:function(ba){var ca=null,da=t.getThreadMetaNow(this._threadID);if(da)ca=da.name;if((ba||ca)&&(ba!=ca))r.sendMessage(r.constructLogMessageObject(h.MercurySourceType.CHAT_WEB,this._threadID,h.MercuryLogMessageType.THREAD_NAME,{name:ba}),null,h.MercuryAPIArgsSource&&h.MercuryAPIArgsSource.WEBMESSENGER);if(this._uploadedImage)r.sendMessage(r.constructLogMessageObject(h.MercurySourceType.CHAT_WEB,this._threadID,h.MercuryLogMessageType.THREAD_IMAGE,{image:this._uploadedImage}));},_onFileUploadChange:function(event){var ba=n.getValue(event.getTarget());if(ba){g.setEnabled(this._saveButton,false);j.hide(this._uploadButton);j.hide(this._uploadedFileDetails);j.show(this._uploadingThrobber);this._uploader.send();}},_onFileUploadSuccess:function(ba,ca){var da=ca.response.getPayload();this._uploadedImage=da.metadata[0];k.setContent(this._fileNameNode,this._uploadedImage.filename);j.hide(this._uploadingThrobber);j.hide(this._uploadButton);j.show(this._uploadedFileDetails);g.setEnabled(this._saveButton,true);},_resetImageUpload:function(){this._uploadedImage=null;j.hide(this._uploadingThrobber);j.hide(this._uploadedFileDetails);j.show(this._uploadButton);}});e.exports=aa;});
__d("MercuryPresence",["Arbiter","AvailableListConstants","DOM","CSS"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AvailableListConstants'),i=b('DOM'),j=b('CSS'),k={},l={},m={updateOnPresenceChanges:function(r,s){l[s.tagName]=true;k[r]=true;j.addClass(s,'presenceListener_'+r);o(s,n(r));}};function n(r){var s=q(r),t={presenceActive:false,presenceMobile:false};switch(s){case h.ACTIVE:t.presenceActive=true;break;case h.MOBILE:t.presenceMobile=true;break;default:break;}return t;}function o(r,s){for(var t in s)j.conditionClass(r,t,s[t]);}function p(){for(var r in k){var s=n(r);for(var t in l){var u=i.scry(document,t+'.presenceListener_'+r);for(var v=0;v<u.length;v++)o(u[v],s);}}}var q=function(r){return h.OFFLINE;};d(['AvailableList'],function(r){q=r.get;p();});g.subscribe(h.ON_AVAILABILITY_CHANGED,p);e.exports=m;});
__d("WebMessengerDetailViewHeaderControl",["JSXDOM","event-extensions","WebMessengerAddPeopleToConversationDialog","Autosize","MercuryConstants","ContextualDialog","CSS","DOM","WebMessengerEditThreadDialog","HovercardLink","HoverFlyout","LayerFadeOnHide","LayerFadeOnShow","MercuryParticipants","MercuryPresence","ScrollableArea","WebMessengerStateConstants","WebMessengerStateManager","Style","WebMessengerTemplates","MercuryThreadInformer","MercuryThreadMetadataRenderer","MercuryThreads","WebMessengerConstants","WebMessengerEvents","WebMessengerSubscriptionsHandler","copyProperties","csx","cx","tx"],function(a,b,c,d,e,f){var g=b('JSXDOM');b('event-extensions');var h=b('WebMessengerAddPeopleToConversationDialog'),i=b('Autosize'),j=b('MercuryConstants'),k=b('ContextualDialog'),l=b('CSS'),m=b('DOM'),n=b('WebMessengerEditThreadDialog'),o=b('HovercardLink'),p=b('HoverFlyout'),q=b('LayerFadeOnHide'),r=b('LayerFadeOnShow'),s=b('MercuryParticipants'),t=b('MercuryPresence'),u=b('ScrollableArea'),v=b('WebMessengerStateConstants'),w=b('WebMessengerStateManager'),x=b('Style'),y=b('WebMessengerTemplates'),z=b('MercuryThreadInformer'),aa=b('MercuryThreadMetadataRenderer'),ba=b('MercuryThreads').get(),ca=b('WebMessengerConstants'),da=b('WebMessengerEvents'),ea=b('WebMessengerSubscriptionsHandler'),fa=b('copyProperties'),ga=b('csx'),ha=b('cx'),ia=b('tx'),ja=function(oa){this._rootElement=oa;m.empty(this._rootElement);this._renderHeaderBar();};fa(ja.prototype,{hideView:function(){l.hide(this._rootElement);},updateView:function(){l.removeClass(this._rootElement,'isMultichat');l.show(this._rootElement);this._listener&&z.unsubscribe(this._listener);var oa=v;switch(w.getCurrentDetailState()){case oa.DETAIL.RECENT_MESSAGES:case oa.DETAIL.SEARCH_CONTEXT:this.setThreadID(w.getCurrentStateData().thread_id);break;default:this.setThreadID(null);break;}da.detailDOMChanged();},setThreadID:function(oa){this._threadID=oa;if(this._threadID){this._listener=z.listen(this._threadID,this.updateView.bind(this));ea.addSubscriptions(this._listener);}oa&&ba.getThreadMeta(oa,function(pa){if(this._threadID==oa)l.conditionClass(this._rootElement,'isMultichat',!pa.is_canonical&&ba.canReply(oa));}.bind(this));},_renderHeaderBar:function(){this._headerBar=y[':fb:web-messenger:read-view:header'].build();m.appendContent(this._rootElement,this._headerBar.getRoot());var oa=this._headerBar.getNode('editThreadName'),pa=this._headerBar.getNode('addPeopleToThread'),qa=new n();ea.addSubscriptions(Event.listen(this._headerBar.getNode('closeButton'),'click',function(){var ra=fa(w.getCurrentStateData(),{all_people_query:undefined});w.updateDetailState(v.DETAIL.COMPOSE_MAIN,ra);}),Event.listen(oa,'click',function(event){this._threadID&&qa.toggleShown(this._headerBar.getNode('headerName'),this._threadID);return true;}.bind(this)),Event.listen(pa,'click',function(event){this._threadID&&h.show(this._threadID);return true;}.bind(this)),da.subscribe(da.DETAIL_DOM_CHANGED,this.updateHeaderBar.bind(this)));},updateHeaderBar:function(){var oa=this._headerBar.getNode('headerName'),pa=this._headerBar.getNode('headerButtons');oa.style.fontSize='';var qa=g.div({});m.setContent(oa,qa);var ra=w.getCurrentDetailState(),sa=ra==v.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS;l.conditionShow(this._headerBar.getNode('closeButton'),sa);l.conditionClass(oa,'allPeopleResults',sa);var ta,ua;switch(ra){case v.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS:ua=w.getCurrentStateData().all_people_query;ta=m.tx._("People matching {query}",{query:m.create('strong',{},ua)});break;case v.DETAIL.COMPOSE_MAIN:case v.DETAIL.COMPOSE_TYPEAHEAD_RESULTS:ta="New Message";break;case v.DETAIL.SEARCH_SNIPPET:ua=w.getCurrentStateData().message_query;if(ua)ta=ia._("Messages with word: {query}",{query:ua});break;}var va=!ta&&!this._threadID;if(va)ta="No Selection";l.conditionClass(oa,"_3jd",va);if(ta){m.setContent(qa,ta);na(oa,this._threadID,pa);return;}aa.renderAndSeparatedParticipantList(this._threadID,qa,{check_length:false,names_renderer:function(wa){var xa=wa.map(function(za){var ab=wa.length===1?za.name:za.short_name,bb=s.getUserID(za.id);if(bb&&za.href){var cb=m.create('a',{href:za.href},ab);if(wa.length===1)cb.setAttribute('data-hovercard',o.constructEndpoint({id:bb}));return cb;}else return ab;});if(wa.length===1&&wa[0].fbid!==null){var ya=m.create('span');m.setContent(ya,xa[0]);ka(wa[0],ya);xa[0]=ya;}return xa;}.bind(this)});this.renderParticipantListFlyout(qa);this.renderNamedThreadParticipantCount(qa);na(oa,this._threadID,pa);new i(oa,{min:11,max:16,height:100,width:oa.offsetWidth,wrap:false});},renderNamedThreadParticipantCount:function(oa){ba.getThreadMeta(this._threadID,function(pa){if(pa.name){var qa=aa.renderParticipantCount(pa.thread_id,{count:pa.participants.length-1}),ra=m.create('span',{className:"_1us"},ia._("({participants})",{participants:qa}));m.appendContent(oa,ra);}},j.MercuryAPIArgsSource&&j.MercuryAPIArgsSource.WEBMESSENGER);},renderParticipantListFlyout:function(oa){this._dialog&&this._dialog.destroy();delete this._dialog;this._flyout&&this._flyout.destroy();delete this._flyout;var pa=this._threadID;ba.getThreadMeta(this._threadID,function(qa){var ra=qa.participants.filter(function(sa){return sa!==s.user;});if(ra.length<=1)return;s.getMulti(ra,function(sa){if(this._threadID!=pa)return;var ta=0,ua=y[':fb:web-messenger:flyoutlist'].build();for(var va in sa){var wa=sa[va],xa=y[':fb:web-messenger:flyoutlist-profile-item'].build();xa.getNode('profilePhoto').setAttribute('src',wa.image_src);['profilePhotoLink','profileLink'].forEach(function(za){xa.getNode(za).setAttribute('href',wa.href);});m.setContent(xa.getNode('profileLink'),wa.name);ka(wa,xa.getNode('title'));m.setContent(xa.getNode('infoLine'),ma(wa));ta++;m.appendContent(ua.getNode('list'),xa.getRoot());}var ya=ua.getRoot();this._dialog=new k({context:oa,position:'below',addedBehaviors:[q,r]},ya);this._flyout=new p();this._flyout.init(this._dialog);this._flyout.initNode(oa);la(this._flyout,ya,ta);}.bind(this));}.bind(this),j.MercuryAPIArgsSource&&j.MercuryAPIArgsSource.WEBMESSENGER);},destroy:function(){}});function ka(oa,pa){var qa=s.getUserID(oa.id),ra=m.create('span');if(qa){t.updateOnPresenceChanges(qa,ra);if(m.isNode(pa))m.appendContent(pa,ra);}return ra;}function la(oa,pa,qa){if(qa<=ca.MAX_VISIBLE_IN_FLYOUT)return;var ra=u.fromNative(pa,{fade:true});pa.style.height=ca.PARTICIPANTS_FLYOUT_HEIGHT+'px';oa.subscribe('show',function(){ra.showScrollbar(false);});}function ma(oa){var pa=oa.networks||{},qa=Object.keys(pa),ra=qa.length>0,sa=2;if(ra){var ta=qa.slice(0,sa).map(function(ua){return pa[ua];});return ta.join(' \u00b7 ');}return '';}function na(oa,pa,qa){var ra=qa.offsetWidth,sa=m.scry(document.body,"div._2nd");if(sa.length)ra+=sa[0].offsetWidth;var ta=oa.parentNode.offsetWidth;if(ta>ra)x.set(oa,'max-width',(ta-ra)+'px');}e.exports=ja;});
__d("WebMessengerFlexibleArea",["event-extensions","ArbiterMixin","Class","CSS","cx","DOM","Style","throttle","Vector","copyProperties","createArrayFrom"],function(a,b,c,d,e,f){b('event-extensions');var g=b('ArbiterMixin'),h=b('Class'),i=b('CSS'),j=b('cx'),k=b('DOM'),l=b('Style'),m=b('throttle'),n=b('Vector'),o=b('copyProperties'),p=b('createArrayFrom'),q=[];function r(){q.forEach(function(t){t.draw();});}Event.listen(window,'resize',m(r,50));function s(t){this.minFlexAreaHeight=0;this.flexArea=t;this.container=null;this.padding=0;this.sizeToFit=false;q.push(this);}o(s.prototype,g,{setContainer:function(t){this.container=t;return this;},setPadding:function(t){this.padding=t;return this;},setMinFlexAreaHeight:function(t){this.minFlexAreaHeight=t;return this;},setSizeToFit:function(t){this.sizeToFit=t;return this;},draw:function(){if(this.flexArea){var t=this._flexHeight;this.inform('predraw',{old_height:t});var u=n.getViewportDimensions().y-this.padding;u-=n.getElementPosition(this.container||this.flexArea).y;if(this.container){p(this.container.childNodes).forEach(function(v){u-=n.getElementDimensions(v).y;});u+=n.getElementDimensions(this.flexArea).y;}if(this.sizeToFit)u=Math.min(u,this._getNaturalHeight());if(u<this.minFlexAreaHeight)u=this.minFlexAreaHeight;if(isNaN(u)||u<0)u=0;if(u!==t){l.set(this.flexArea,'height',u+'px');this._flexHeight=u;this.inform('height_changed',{height:u,old_height:t});}}return this;},destroy:function(){var t=q.indexOf(this);t>=0&&q.splice(t,1);r();},_getNaturalHeight:function(){var t=this.flexArea.cloneNode(true);i.addClass(t,"_2ys");l.set(t,'height','auto');k.insertAfter(this.flexArea,t);var u=n.getElementDimensions(t).y;k.remove(t);return u;},_getFlexHeight:function(){if(isNaN(this._flexHeight))this._flexHeight=n.getElementDimensions(this.flexArea).y;return this._flexHeight;}});e.exports=s;});
__d("WebMessengerFlexibleScrollArea",["event-extensions","Class","CSS","DOMQuery","ScrollableArea","Style","WebMessengerFlexibleArea","copyProperties","emptyFunction","throttle"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Class'),h=b('CSS'),i=b('DOMQuery'),j=b('ScrollableArea'),k=b('Style'),l=b('WebMessengerFlexibleArea'),m=b('copyProperties'),n=b('emptyFunction'),o=b('throttle');function p(q,r){this._scroll=j.fromNative(q,r);this.parent.construct(this,q);this._scrollBody=i.find(this.flexArea,'.uiScrollableAreaBody');var s=i.scry(this.flexArea,'.uiScrollableAreaShadow');this._shadow=s.length?s[0]:null;this._scrollContent=i.find(this.flexArea,'.uiScrollableAreaContent');this._scrollCallback=n;this._drawSubscription=this.subscribe('height_changed',this.poke.bind(this));this._scrollSub=this._scroll.subscribe('scroll',o(this._onScroll,50,this));}g.extend(p,l);m(p.prototype,{setBottomAligned:function(q){var r=q!==false;if(this._bottomEdgeBias===r)return;h.conditionClass(this.flexArea,'uiScrollableAreaBottomAligned',r);this._bottomEdgeBias=r;if(this._bottomEdgeBias){this.scrollToBottom(false);}else this.scrollToTop(false);this.poke.bind(this).defer();return this;},setInfiniteScrollHandler:function(q,r){if(r){this._infiniteUpwardScrollHandler=q;}else this._infiniteDownScrollHandler=q;return this;},setScrollCallback:function(q){this._scrollCallback=q;return this;},setTabbable:function(q){this._scroll._wrap.setAttribute('tabindex',q?'0':'-1');},poke:function(q,r){var s=this._scrollHeight,t=this._scroll.getScrollTop();this._scrollHeight=this._getScrollHeight();if(typeof s=='undefined'||(r&&!r.old_height)){this._bottomEdgeBias&&this._setShadowHeight();return;}var u=this._scrollHeight-s;if(this._bottomEdgeBias){var v=r?r.height-r.old_height:0;clearTimeout(this._pollTimer);this._pollTimer=this.poke.bind(this).defer(200);var w,x=u-v;if(this._scrollHeight>this._getFlexHeight()){w=t+x;w=w<0?0:w;}else w=0;x>0&&this._setShadowHeight();if(w!==t)this._scroll.setScrollTop(w,false);x<0&&this._setShadowHeight();}else if(u)this._scroll.setScrollTop(t,false);},setScrollTop:function(q,r){this._scroll.setScrollTop(q,r);},getScrollableArea:function(){return this._scroll;},isScrolledToBottom:function(){return this._scroll.isScrolledToBottom();},scrollToBottom:function(q){this._scroll.scrollToBottom(q);if(this._bottomEdgeBias)this._scrollBottom=0;},isScrolledToTop:function(){return this._scroll.getScrollTop()===0;},scrollToTop:function(q){this._scroll.scrollToTop(q);},scrollIntoView:function(q,r){this._scroll.scrollIntoView(q,r);},destroy:function(){this._scrollSub&&this._scrollSub.unsubscribe();this.unsubscribe(this._drawSubscription);clearTimeout(this._pollTimer);this.parent.destroy();this._scroll.destroy();},_getScrollHeight:function(){if(this._bottomEdgeBias){return this._scrollContent.offsetHeight;}else return this._scroll.getScrollHeight();},_setShadowHeight:function(){var q=this._shadowHeight;this._shadowHeight=this._scrollHeight-this._getFlexHeight();if(this._shadowHeight<0)this._shadowHeight=0;if(this._shadowHeight!==q)k.set(this._shadow,'height',this._shadowHeight+'px');},_onScroll:function(){var q=this._scroll.getScrollTop(),r=this._getScrollHeight();if(q<this._getFlexHeight())this._infiniteUpwardScrollHandler&&this._infiniteUpwardScrollHandler();if(q+2*this._getFlexHeight()>r)this._infiniteDownScrollHandler&&this._infiniteDownScrollHandler();this._scrollCallback(this._scroll);}});e.exports=p;});
__d("WebMessengerActionsMenuItem",["event-extensions","CSS","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('CSS'),h=b('WebMessengerStateConstants'),i=b('WebMessengerStateManager'),j=b('WebMessengerTemplates'),k=b('copyProperties');function l(m,n,o){var p=j[':fb:web-messenger:actions-menu-item'].build();p.setNodeContent('title',m);this.node=p.getRoot();this.showFn=o;Event.listen(this.node,'click',function(){var q=i.getCurrentStateData().thread_id;q&&n(q);});}k(l.prototype,{getNode:function(){return this.node;},updateShown:function(m){var n=this.showFn?this.showFn(m):true;g.conditionShow(this.node,n);return n;}});e.exports=l;});
__d("ListInputTargetTracker",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties');function h(){this._index=undefined;this._items=[];}g(h.prototype,{getIndex:function(){return this._index;},setIndex:function(i){this._index=Math.max(0,Math.min(i,this._items.length-1));},getNumItems:function(){return this._items.length;},getItem:function(){if(this._index!==undefined)return this._items[this._index];},setTargetItem:function(i){this.updateIndex(this._items,i);},removeItemAtIndex:function(i){this._items.splice(i,1);},removeItemByValue:function(i){var j=this._items.indexOf(i);this.removeItemAtIndex(j);},moveUp:function(){if(this._index===undefined||this._index===0){if(this._items.length){this._index=this._items.length-1;return true;}}else if(this._index>0){this._index--;return true;}return false;},moveDown:function(){if(this._index===undefined||this._index===this._items.length-1){if(this._items.length){this._index=0;return true;}}else if(this._index<this._items.length-1){this._index++;return true;}return false;},updateIndex:function(i,j){this._items=i||[];if(j){var k=this._items.indexOf(j);if(k>=0){this._index=k;}else if(this._index!==undefined)if(this._items.length>0){this._index=Math.min(this._index,this._items.length-1);}else this._index=undefined;}else this._index=undefined;return this._index;}});e.exports=h;});
__d("WebMessengerShortcuts",["MercuryConstants","Dialog","DialogX","KeyEventController","LayerHideOnEscape","ListInputTargetTracker","Parent","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","MercuryThreads","UserAgent","WebMessengerEvents","cx","ge","tx"],function(a,b,c,d,e,f){var g=b('MercuryConstants'),h=b('Dialog'),i=b('DialogX'),j=b('KeyEventController'),k=b('LayerHideOnEscape'),l=b('ListInputTargetTracker'),m=b('Parent'),n=b('WebMessengerStateConstants'),o=b('WebMessengerStateManager'),p=b('WebMessengerTemplates'),q=b('MercuryThreads').get(),r=b('UserAgent'),s=b('WebMessengerEvents'),t=b('cx'),u=b('ge'),v=b('tx'),w=null,x=null,y={c:{callback:ca,description:"Start a new message",section:'navigation',uses_meta:true},g:{callback:da,description:"Search conversations",section:'searchAndHelp',uses_meta:true},i:{callback:la.curry(g.MessagingTag.INBOX),description:"Go to Inbox",section:'navigation',uses_meta:true},u:{callback:la.curry(g.MessagingTag.OTHER),description:"Go to Other",section:'navigation',uses_meta:true},DELETE:{callback:fa,description:"Archive\/unarchive conversation",otherKeys:['BACKSPACE'],keyName:"Delete",section:'conversation',uses_meta:true},r:{callback:ga,description:"Mark message as read\/unread",section:'conversation',uses_meta:true},UP:{callback:ha,description:"Select next conversation",section:'navigation',uses_meta:false},DOWN:{callback:ia,description:"Select previous conversation",section:'navigation',uses_meta:false},q:{callback:na,description:"Show\/hide keyboard shortcuts",section:'searchAndHelp',uses_meta:true},j:{callback:oa,description:"Mark as spam",section:'conversation',uses_meta:true}},z={registerGeneralShortcuts:function(){x=new l();for(var pa in y){var qa=y[pa],ra=qa.otherKeys||[];ra.push(pa);for(var sa=0;sa<ra.length;sa++)j.registerKey(ra[sa],qa.callback,ba.curry(qa.uses_meta));}},updateThreadlistIndex:function(pa,qa,ra){w=pa;if(x){if(!qa.contains(ra))ra=null;x.updateIndex(qa,ra);}},openSearchThread:function(){var pa=ka(),qa=o.getCurrentMasterState();if(pa&&qa==n.MASTER.SEARCH)w.openSearchThread(pa);},showOrHideShortcuts:na};function aa(){return r.osx()?'CTRL':'ALT';}function ba(pa,event,qa){if(!j.filterEventTypes(event,qa))return false;var ra=event.getTarget();if(!m.byClass(ra,"_ksg"))return false;var sa;if(pa)switch(aa()){case 'CTRL':sa='ctrlKey';break;case 'ALT':sa='altKey';break;}var ta=['ctrlKey','metaKey','altKey','shiftKey'];for(var ua=0;ua<ta.length;ua++)if(ta[ua]!==sa&&event[ta[ua]])return false;return !pa||event[sa];}function ca(){o.updateDetailState(n.DETAIL.COMPOSE_MAIN,{start:true});return false;}function da(){s.focusAndSelectSearch();return false;}function ea(pa){var qa;if(x.getNumItems()>1){var ra=x.getIndex();x.setIndex(ra===0?1:ra-1);qa=ka();}pa();o.updateDetailState(n.DETAIL.RECENT_MESSAGES,{folder:o.getCurrentStateData().folder,thread_id:qa});if(qa)w._manager.scrollIntoView(u(x.getItem()),false);}function fa(){var pa=ka();if(pa){q.getThreadMeta(pa,function(qa){if(qa.folder==g.MessagingTag.SPAM)return;ea(function(){q.changeThreadArchivedStatus(qa.thread_id,!qa.is_archived);});},g.MercuryAPIArgsSource&&g.MercuryAPIArgsSource.WEBMESSENGER);return false;}}function ga(){var pa=ka();if(pa){q.getThreadMeta(pa,function(qa){var ra=!qa.unread_count;q.changeThreadReadStatus(pa,!ra);},g.MercuryAPIArgsSource&&g.MercuryAPIArgsSource.WEBMESSENGER);return false;}}function ha(){if(x)if(x.getIndex()===0){switch(o.getCurrentMasterState()){case n.MASTER.SEARCH:x.moveUp();ja();w._manager.scrollToBottom(false);break;default:w._manager.scrollToTop(false);s.focusSearch();}}else{if(x.getItem()){x.moveUp();}else x.moveDown();ja();}return false;}function ia(){var pa=o.getCurrentMasterState();if(x&&(pa!==n.MASTER.RECENT_THREADS||x.getIndex()<x.getNumItems()-1)){x.moveDown();ja();}return false;}function ja(){var pa=ka();if(pa){var qa=o.getCurrentMasterState();if(qa==n.MASTER.SEARCH){w.updateKeyboardSelection(pa);s.focusSearch();}else o.updateDetailState(n.DETAIL.RECENT_MESSAGES,{thread_id:pa});if(x)if(x.getIndex()===0){w._manager.scrollToTop(false);}else w._manager.scrollIntoView(u(x.getItem()),false);}}function ka(){var pa=x&&x.getItem();if(typeof pa==='string'&&pa.indexOf(':')!==-1)return pa.substr(pa.indexOf(':')+1);return null;}function la(pa){var qa=o.getCurrentMasterState(),ra=qa==n.MASTER.SEARCH?null:o.getCurrentStateData().thread_id;o.updateMasterState(n.MASTER.RECENT_THREADS,{thread_id:ra,folder:pa});}var ma;function na(){if(!ma){var pa={};for(var qa in y){var ra=y[qa];if(!ra.uses_meta)continue;var sa=p[':fb:web-messenger:shortcuts-dialog:row'].build();sa.setNodeContent('meta',aa());if(ra.keyName){sa.setNodeContent('key',ra.keyName);}else sa.setNodeContent('key',qa);sa.setNodeContent('description',ra.description);if(!pa[ra.section])pa[ra.section]=[];pa[ra.section].push(sa.getRoot());}var ta=p[':fb:web-messenger:shortcuts-dialog'].build();for(var ua in pa)ta.setNodeContent(ua,pa[ua]);ma=new i({modal:true,width:h.SIZE.WIDE},ta.getRoot());ma.enableBehavior(k);}if(ma.isShown()){ma.hide();}else ma.show();return false;}function oa(){var pa=ka();if(pa){q.getThreadMeta(pa,function(qa){if(qa.folder==g.MessagingTag.SPAM)return;ea(q.markThreadSpam.curry(pa));},g.MercuryAPIArgsSource&&g.MercuryAPIArgsSource.WEBMESSENGER);return false;}}e.exports=z;});
__d("WebMessengerDetailViewActionsMenuControl",["event-extensions","WebMessengerAddPeopleToConversationDialog","Arbiter","AsyncDialog","AsyncRequest","MercuryConfig","MercuryConstants","CSS","Dialog","DOM","Env","WebMessengerActionsMenuItem","MercuryThreadMuter","MercuryMessages","MercuryParticipants","MercuryServerRequests","WebMessengerShortcuts","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","MercuryThreadInformer","MercuryThreads","Toggler","URI","WebMessengerSubscriptionsHandler","copyProperties","goURI","tx"],function(a,b,c,d,e,f){b('event-extensions');var g=b('WebMessengerAddPeopleToConversationDialog'),h=b('Arbiter'),i=b('AsyncDialog'),j=b('AsyncRequest'),k=b('MercuryConfig'),l=b('MercuryConstants'),m=b('CSS'),n=b('Dialog'),o=b('DOM'),p=b('Env'),q=b('WebMessengerActionsMenuItem'),r=b('MercuryThreadMuter'),s=b('MercuryMessages'),t=b('MercuryParticipants'),u=b('MercuryServerRequests'),v=b('WebMessengerShortcuts'),w=b('WebMessengerStateConstants'),x=b('WebMessengerStateManager'),y=b('WebMessengerTemplates'),z=b('MercuryThreadInformer'),aa=b('MercuryThreads').get(),ba=b('Toggler'),ca=b('URI'),da=b('WebMessengerSubscriptionsHandler'),ea=b('copyProperties'),fa=b('goURI'),ga=b('tx');function ha(){this.node=y[':ui:menu:separator'].render();}ha.prototype.getNode=function(){return this.node;};function ia(qb){this._rootElement=qb;this._menuTemplate=y[':fb:web-messenger:actions-menu'].build();da.addSubscriptions(z.subscribe('threads-updated',function(rb,sb){sb[this._threadID]&&this.updateView();}.bind(this)),Event.listen(this._menuTemplate.getNode('newMessageButton'),'click',function(){x.updateDetailState(w.DETAIL.COMPOSE_MAIN,ea(x.getCurrentStateData(),{start:true,thread_id:undefined}));}));this.initItems();o.setContent(this._rootElement,this._menuTemplate.getRoot());}ea(ia.prototype,{initItems:function(){this.menuItems=[new q("Mark as Read",kb,xa),new q("Mark as Unread",jb,ua(xa)),new q("Open in Chat",oa,pa),new q("Create Group...",ib,sa),new ha(),new q("Forward Messages...",mb),new q("Delete Messages...",lb),new ha(),new q("Add People...",cb,na),new q("Leave Conversation...",db,na),new q("Delete Conversation...",ta),new q("Mute Conversation...",ja.curry(-1),la),new q("Unmute Conversation...",ja.curry(0),ka),new q("Move to Inbox",ra.curry(l.MessagingTag.INBOX),qa.curry(l.MessagingTag.OTHER)),new q("Move to Other",ra.curry(l.MessagingTag.OTHER),qa.curry(l.MessagingTag.INBOX)),new q("Archive",fb,ua(wa)),new q("Unarchive",gb,wa),new q("Report Spam or Abuse...",za,ua(va)),new q("Not Spam",bb,va)];if(ma())this.menuItems=this.menuItems.concat([new ha(),new q('Enable bug reporting',nb,ua(ya)),new q('Disable bug reporting',ob,ya)]);this.menuItems=this.menuItems.concat([new ha(),new q("Keyboard Shortcuts",v.showOrHideShortcuts.bind(v)),new q("Feedback",fa.curry('/help/?page=134259426717336'))]);var qb=this.menuItems.map(function(sb){return sb.getNode();}),rb=o.find(this._menuTemplate.getRoot(),'.uiMenuInner');o.setContent(rb,qb);},hideView:function(){m.hide(this._rootElement);},updateView:function(){this.hideView();var qb;switch(x.getCurrentDetailState()){case w.DETAIL.COMPOSE_MAIN:case w.DETAIL.COMPOSE_TYPEAHEAD_RESULTS:case w.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS:qb=false;this._threadID=null;break;case w.DETAIL.RECENT_MESSAGES:case w.DETAIL.SEARCH_CONTEXT:qb=true;this._threadID=x.getCurrentStateData().thread_id;break;default:qb=true;this._threadID=null;break;}this._threadSubscription&&aa.unsubscribe(this._threadSubscription);if(this._threadID){this._threadSubscription=aa.getThreadMeta(this._threadID,function(rb){var sb=null,tb=false;this.menuItems.forEach(function(ub){if(ub instanceof q){tb|=ub.updateShown(rb);}else if(ub instanceof ha){m.conditionShow(ub.getNode(),tb);if(tb){sb=ub;tb=false;}}});if(!tb&&sb)m.hide(sb.getNode());m.show(this._menuTemplate.getNode('menu'));m.show(this._rootElement);}.bind(this),l.MercuryAPIArgsSource&&l.MercuryAPIArgsSource.WEBMESSENGER);}else if(qb){m.hide(this._menuTemplate.getNode('menu'));m.show(this._rootElement);}},destroy:function(){}});function ja(qb,rb){r.showMuteChangeDialog(qb,rb);}function ka(qb){return k.MuteThreadsOnDesktopGK&&r.isThreadMuted(qb);}function la(qb){return k.MuteThreadsOnDesktopGK&&!r.isThreadMuted(qb);}function ma(){var qb=t.getNow(t.user);return qb&&qb.employee;}function na(qb){return !qb.is_canonical&&qb.is_subscribed;}function oa(qb){h.inform('chat/open-tab',{thread_id:qb});}function pa(qb){var rb=qb.is_canonical&&!qb.is_canonical_user;return qb.is_subscribed&&!rb&&qb.canonical_fbid!=p.user;}function qa(qb,rb){return !rb.is_archived&&rb.folder==qb;}function ra(qb,rb){aa.changeFolder(rb,qb);pb();}function sa(qb){var rb=hb(qb.participants);return rb.length>2;}function ta(qb){var rb=[];rb.push({name:'delete_conversation',label:"Delete Conversation",handler:aa.deleteThread.curry(qb)});rb.push(n.CANCEL);new n().setTitle("Delete This Entire Conversation?").setBody("Once you delete your copy of this conversation, it cannot be undone.").setButtons(rb).show();}function ua(qb){return function(){return !qb.apply(this,arguments);};}function va(qb){return qb.folder===l.MessagingTag.SPAM;}function wa(qb){return qb.is_archived;}function xa(qb){return qb.unread_count>0;}function ya(){return x.getCurrentStateData().bug_reporting_enabled;}function za(qb){var rb=y[':fb:web-messenger:report-dialog'].build(),sb=rb.getRoot(),tb=[n.OK,n.CANCEL];new n().setTitle("Report Spam or Abuse").setBody(sb).setButtons(tb).setHandler(ab.curry(qb,sb)).show();}function ab(qb,rb){var sb=o.find(rb,'.markSpam'),tb=o.scry(rb,'.markSpamMessages')[0];if(sb.checked){aa.markThreadSpam(qb);pb();}else if(tb&&tb.checked){var ub=ea({},x.getCurrentStateData());ea(ub,{message_action:w.MESSAGE_ACTION.REPORT_SPAM});x.updateDetailState(x.getCurrentDetailState(),ub);}else{var vb=o.find(rb,'.reportUsers');if(vb.checked){u.getServerThreadID(qb,function(wb){n.bootstrap('/ajax/messaging/report/',{tid:wb});});}else return false;}}function bb(qb){aa.unmarkThreadSpam(qb);pb();}function cb(qb){g.show(qb);}function db(qb){var rb=[];rb.push({name:'unsubscribe',label:"Leave Conversation",handler:eb.bind(null,qb)});rb.push(n.CANCEL);new n().setTitle("Leave Conversation?").setBody("You will stop receiving messages from this conversation and people will see that you left.").setButtons(rb).show();}function eb(qb){s.sendMessage(s.constructLogMessageObject(l.MercurySourceType.TITAN_WEB,qb,l.MercuryLogMessageType.UNSUBSCRIBE,{}),null,l.MercuryAPIArgsSource&&l.MercuryAPIArgsSource.WEBMESSENGER);return true;}function fb(qb){aa.changeThreadArchivedStatus(qb,true);pb();}function gb(qb){aa.changeThreadArchivedStatus(qb,false);pb();}function hb(qb){var rb=[];for(var sb=0;sb<qb.length;sb++){var tb=qb[sb];if(/^fbid:\d+$/.test(tb))rb.push(tb.substr(5));}return rb;}function ib(qb){aa.getThreadMeta(qb,function(rb){var sb=hb(rb.participants),tb=ca('/ajax/groups/create_get.php').addQueryData({ref:'web_messenger',members:sb,parent_id:'0'});i.send(new j(tb));},l.MercuryAPIArgsSource&&l.MercuryAPIArgsSource.WEBMESSENGER);}function jb(qb){aa.changeThreadReadStatus(qb,false);ba.hide();}function kb(qb){aa.changeThreadReadStatus(qb,true);ba.hide();}function lb(){var qb=ea({},x.getCurrentStateData());ea(qb,{message_action:w.MESSAGE_ACTION.DELETE});x.updateDetailState(x.getCurrentDetailState(),qb);}function mb(){var qb=ea({},x.getCurrentStateData());ea(qb,{message_action:w.MESSAGE_ACTION.FORWARD});x.updateDetailState(x.getCurrentDetailState(),qb);}function nb(){var qb=ea({},x.getCurrentStateData());qb.bug_reporting_enabled=true;ba.hide();x.updateDetailState(x.getCurrentDetailState(),qb);}function ob(){var qb=ea({},x.getCurrentStateData());qb.bug_reporting_enabled=false;ba.hide();x.updateDetailState(x.getCurrentDetailState(),qb);}function pb(){x.updateDetailState(w.DETAIL.RECENT_MESSAGES,{folder:x.getCurrentStateData().folder});}e.exports=ia;});
__d("WebMessengerDetailViewAllPeopleResultsControl",["event-extensions","CSS","DataStore","DOM","ExpandableDataSource","MercuryIDs","Parent","WebMessengerStateConstants","WebMessengerStateManager","Token","WebMessengerEvents","cx","WebMessengerSubscriptionsHandler","copyProperties","WebMessengerTemplates"],function(a,b,c,d,e,f){b('event-extensions');var g=b('CSS'),h=b('DataStore'),i=b('DOM'),j=b('ExpandableDataSource'),k=b('MercuryIDs'),l=b('Parent'),m=b('WebMessengerStateConstants'),n=b('WebMessengerStateManager'),o=b('Token'),p=b('WebMessengerEvents'),q=b('cx'),r=b('WebMessengerSubscriptionsHandler'),s=b('copyProperties'),t=b('WebMessengerTemplates'),u=5,v=5,w=function(ba){this._rootElement=ba;i.empty(this._rootElement);var ca=t[':fb:web-messenger:all-people-results'].build();i.setContent(this._rootElement,ca.getRoot());this._loadingSpinner=ca.getNode('loadingSpinner');this._peopleResults=ca.getNode('results');this._loadMoreButton=ca.getNode('loadMoreButton');this._loadMoreLink=ca.getNode('loadMoreLink');r.addSubscriptions(Event.listen(this._loadMoreLink,'click',function(){g.addClass(this._loadMoreButton,'async_saving');this._peopleDataSource&&this._peopleDataSource.loadMore();}.bind(this)));};s(w.prototype,{hideView:function(){g.hide(this._rootElement);},updateView:function(){var ba=n.getCurrentDetailState();if(ba==m.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS){g.show(this._rootElement);x(this);p.detailDOMChanged();}},destroy:function(){}});function x(ba){g.show(ba._loadingSpinner);g.hide(ba._peopleResults);g.hide(ba._loadMoreButton);var ca=n.getCurrentStateData(),da=ca.all_people_query||'';y(ba);var ea=(ca.participants||[]).map(function(fa){return k.tokenize(fa).value;});ba._peopleDataSource.setExclusions(ea);ba._peopleDataSource.query(da);}function y(ba){if(!ba._peopleDataSource){ba._peopleDataSource=new j({queryEndpoint:'/ajax/mercury/search_people.php'},u,v);ba._peopleDataSource.init();r.addSubscriptions(ba._peopleDataSource.subscribe('respond',z.curry(ba)),Event.listen(ba._rootElement,'click',function(event){var ca=event.getTarget().parentNode;if(g.hasClass(ca,"_4wt"))aa(event.getTarget(),ba._peopleDataSource);}));}}function z(ba,ca,da){var ea=n.getCurrentDetailState(),fa=n.getCurrentStateData();if(ea==m.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS&&fa.all_people_query==da.value){i.empty(ba._peopleResults);g.show(ba._peopleResults);da.results.forEach(function(ga){var ha=i.create('div',{className:'personResult'},ga.detail_markup);h.set(ha,'uid',ga.uid);i.appendContent(ba._peopleResults,ha);});if(da.results.length){g.hide(ba._loadingSpinner);g.conditionShow(ba._loadMoreButton,!ba._peopleDataSource.hasLoadedAllResults());g.conditionClass(ba._loadMoreButton,'async_saving',ba._peopleDataSource.isLoadingMore());}}}function aa(ba,ca){var da=l.byClass(ba,'personResult'),ea=ca.getEntry(h.get(da,'uid')),fa=s(n.getCurrentStateData(),{new_tokens:[new o(ea)],start:false});n.updateDetailState(m.DETAIL.COMPOSE_MAIN,fa);}e.exports=w;});
__d("WebMessengerComposerTypeaheadView",["BucketedTypeaheadView","Class","MercuryConstants","CSS","DataStore","WebMessengerStateConstants","WebMessengerStateManager","copyProperties","cx","tx"],function(a,b,c,d,e,f){var g=b('BucketedTypeaheadView'),h=b('Class'),i=b('MercuryConstants'),j=b('CSS'),k=b('DataStore'),l=b('WebMessengerStateConstants'),m=b('WebMessengerStateManager'),n=b('copyProperties'),o=b('cx'),p=b('tx');function q(u,v){this.parent.construct(this,u,v);var w=i.MercuryTypeaheadConstants;this.typeObjects={};this.typeObjects[w.FRIEND_TYPE]={disabled:true,uid:w.FRIEND_TYPE,type:w.HEADER_TYPE};this.typeObjects[w.THREAD_TYPE]={uid:w.THREAD_TYPE,text:"Group Conversations",type:w.HEADER_TYPE,linkText:"Show More",getLinkHandler:t.curry(this)};this.typeObjects[w.NON_FRIEND_TYPE]={uid:w.NON_FRIEND_TYPE,text:"Other People",type:w.HEADER_TYPE,linkText:"Show All",getLinkHandler:function(){return function(){s(this.parent,this.value);}.bind(this);}.bind(this)};}h.extend(q,g);n(q.prototype,{setTypeahead:function(u){this.parent.setTypeahead(u);var v=k.get(u,'Typeahead');v.subscribe('loading',function(w,x){var y=v.getData();if(this._threadHeader)j.conditionClass(this._threadHeader,"_355",y.isLoadingMore(this.value));}.bind(this));},setNewHeader:function(u,v){if(v.uid===i.MercuryTypeaheadConstants.THREAD_TYPE)this._threadHeader=u;},mouseover:function(event){if(!r(this,event))this.parent.mouseover(event);},mouseup:function(event){if(!r(this,event))this.parent.mouseup(event);},clearSelected:function(){this.index=-1;this.highlight(-1);}});function r(u,event){var v=u.getIndex(event);return v>=0&&v<u.results.length&&u.results[v].type==i.MercuryTypeaheadConstants.HEADER_TYPE;}function s(u,v){var w=n(m.getCurrentStateData(),{all_people_query:v,start:false});m.updateDetailState(l.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS,w);}function t(u){var v=k.get(u.typeahead,'Typeahead'),w=v.getData();if(w.hasLoadedInitialResults(u.value)&&!w.hasLoadedAllResults(u.value))return w.loadMore.bind(w);}e.exports=q;});
__d("MercuryDataSourceHelper",["MercuryConstants","MercuryServerRequests","MercuryThreadMetadataRawRenderer","MercuryThreadMetadataRenderer","WebMessengerConstants"],function(a,b,c,d,e,f){var g=b('MercuryConstants'),h=b('MercuryServerRequests'),i=b('MercuryThreadMetadataRawRenderer'),j=b('MercuryThreadMetadataRenderer'),k=b('WebMessengerConstants'),l={updateMercuryOnFetchComplete:function(m){m.subscribe('fetchComplete',function(n,o){var p={participants:[],threads:[],payload_source:g.MercuryPayloadSource.SERVER_SEARCH};o.response.getPayload().entries.forEach(function(q){if(q.type==k.THREAD_TYPE){p.threads=p.threads.concat(q.mercury_thread);p.participants=p.participants.concat(q.participants_to_render);}});if(p.threads.length){h.handleUpdate(p);o.response.getPayload().entries.forEach(function(q){if(q.mercury_thread)q.text=j.renderThreadNameAndParticipantList(q.mercury_thread.thread_id,q.participants_to_render,q.mercury_thread.participants.length,{last_separator_uses_and:false,names_renderer:i.renderShortNames});});}});}};e.exports=l;});
__d("WebMessengerTypeaheadRenderer",["event-extensions","MercuryConstants","DOM","MercuryTypeaheadRenderer","MercuryServerRequests","WebMessengerTemplates","MercuryThreadMetadataRawRenderer","MercuryThreadMetadataRenderer","MercuryThreads"],function(a,b,c,d,e,f){b('event-extensions');var g=b('MercuryConstants'),h=b('DOM'),i=b('MercuryTypeaheadRenderer'),j=b('MercuryServerRequests'),k=b('WebMessengerTemplates'),l=b('MercuryThreadMetadataRawRenderer'),m=b('MercuryThreadMetadataRenderer'),n=b('MercuryThreads').get();function o(q,r){var s;switch(q.type){case g.MercuryTypeaheadConstants.HEADER_TYPE:s=k[':fb:web-messenger:typeahead-header'].build();i.renderHeader(s,q);if(this.setNewHeader)this.setNewHeader(s.getRoot(),q);break;case g.MercuryTypeaheadConstants.USER_TYPE:s=k[':fb:web-messenger:threadlist-row'].build();i.renderPersonWithBigPhoto(s,q);break;case g.MercuryTypeaheadConstants.THREAD_TYPE:s=k[':fb:web-messenger:threadlist-row'].build();p(s,q);break;default:return h.create('div');}return s.getRoot();}function p(q,r){var s=j.getClientThreadIDNow(r.uid);m.renderParticipantImages(r.participants_to_render,q.getNode('image'));var t=m.renderThreadNameAndParticipantList(s,r.participants_to_render,r.mercury_thread.participants.length,{last_separator_uses_and:false,names_renderer:l.renderShortNames});h.setContent(q.getNode('name'),t);q.getRoot().setAttribute('aria-label',t);n.getThreadMeta(s,function(u){m.renderSnippet(u,q.getNode('snippet'));m.renderTimestamp(q.getNode('timestamp'),u.timestamp_absolute,u.timestamp_relative,u.timestamp);},g.MercuryAPIArgsSource&&g.MercuryAPIArgsSource.WEBMESSENGER);}e.exports=o;});
__d("WebMessengerDetailViewComposeTypeaheadControl",["event-extensions","WebMessengerComposerTypeaheadView","MercuryConstants","CSS","WebMessengerDataSources","DOM","MercuryFolders","FreeformTokenizerBehavior","MercuryDataSourceHelper","MercuryTypeahead","MercuryParticipants","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","MercuryThreads","WebMessengerEvents","WebMessengerSubscriptionsHandler","WebMessengerTypeaheadRenderer","copyProperties","tx"],function(a,b,c,d,e,f){b('event-extensions');var g=b('WebMessengerComposerTypeaheadView'),h=b('MercuryConstants'),i=b('CSS'),j=b('WebMessengerDataSources'),k=b('DOM'),l=b('MercuryFolders'),m=b('FreeformTokenizerBehavior'),n=b('MercuryDataSourceHelper'),o=b('MercuryTypeahead'),p=b('MercuryParticipants'),q=b('WebMessengerStateConstants'),r=b('WebMessengerStateManager'),s=b('WebMessengerTemplates'),t=b('MercuryThreads').get(),u=b('WebMessengerEvents'),v=b('WebMessengerSubscriptionsHandler'),w=b('WebMessengerTypeaheadRenderer'),x=b('copyProperties'),y=b('tx'),z=function(da,ea){this._typeaheadRoot=da;this._resultsRoot=ea;k.empty(this._typeaheadRoot);k.empty(this._resultsRoot);};x(z.prototype,{hideView:function(){i.hide(this._typeaheadRoot);i.hide(this._resultsRoot);},updateView:function(){var da=q;switch(r.getCurrentDetailState()){case da.DETAIL.COMPOSE_MAIN:this.renderComposeTypeahead();i.hide(this._resultsRoot);break;case da.DETAIL.COMPOSE_TYPEAHEAD_RESULTS:this.renderComposeTypeahead();i.show(this._resultsRoot);break;}u.detailDOMChanged();},renderComposeTypeahead:function(){var da=r.getCurrentStateData();i.show(this._typeaheadRoot);i.show(this._resultsRoot);if(!this._initiated){var ea=s[':fb:web-messenger:read-view:compose:typeahead'].build();k.setContent(this._typeaheadRoot,ea.getRoot());var fa=s[':fb:web-messenger:read-view:compose:typeahead:results'].build();k.setContent(this._resultsRoot,fa.getRoot());this._initialResultsLoadingSpinner=fa.getNode('initialResultsLoadingSpinner');this._typeaheadFooter=fa.getNode('typeaheadFooter');this._moreResultsLink=fa.getNode('moreResultsLink');this._typeaheadCaption=fa.getNode('caption');this.buildTypeahead(fa.getNode('results'));k.appendContent(ea.getNode('typeahead'),this._typeahead.getElement());this._initiated=true;}if(da.start){if(!da.participants)this._typeahead.reset();this._typeahead.focus();var ga=this._typeahead.getTypeahead().getCore();ga.getElement().removeAttribute('disabled');}ba(this);},buildTypeahead:function(da){if(this._typeahead)return;var ea=j.WebMessengerComposerDataSource;n.updateMercuryOnFetchComplete(ea);var fa=new o(ea,g);fa.setPlaceholder("Name or email");fa.setViewNodeID(da);fa.setViewOption('renderer',w);v.addSubscriptions(fa.subscribe('tokens-changed',this.onTokensChanged.bind(this)));fa.addTokenizerBehavior({behavior:m,config:{matcher:h.MercuryTypeaheadConstants.VALID_EMAIL}});fa.build();v.addSubscriptions(fa.getTypeahead().subscribe(['respond','focus'],function(){aa(!!fa.getTypeahead().getCore().getValue());}),fa.getTypeahead().subscribe(['reset','blur'],function(){aa(false);}),fa.getTypeahead().subscribe('render',function(ga,ha){ca(this,ha.length);}.bind(this)),fa.getTypeahead().subscribe('reset',function(){ca(this,false);}.bind(this)),fa.getTypeahead().subscribe('query',function(ga,ha){k.setContent(this._moreResultsLink,y._("See more results for {query}",{query:ha.value}));}.bind(this)),Event.listen(this._typeaheadFooter,'mousedown',function(){return false;}),Event.listen(this._moreResultsLink,'click',function(){var ga=this._typeahead.getTypeahead().getCore().getValue(),ha=x(r.getCurrentStateData(),{all_people_query:ga,start:false});r.updateDetailState(q.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS,ha);}.bind(this)),Event.listen(this._typeaheadFooter,'mouseover',function(){this._typeahead.getTypeahead().getView().clearSelected();}.bind(this)));this._typeahead=fa;},onTokensChanged:function(){var da=r.getCurrentDetailState();if(da==q.DETAIL.COMPOSE_MAIN||da==q.DETAIL.COMPOSE_TYPEAHEAD_RESULTS||da==q.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS){var ea=this._typeahead,fa=ea.getTokens(),ga=fa[fa.length-1];if(ga&&ga.getInfo().mercury_thread){var ha=ga.getInfo().mercury_thread.thread_id,ia=l.getFromMeta(t.getThreadMetaNow(ha));r.updateDetailState(q.DETAIL.RECENT_MESSAGES,{thread_id:ha,folder:ia,reuse_composer:true});}else{var ja=fa.map(function(la){if(la.getInfo().type==h.MercuryTypeaheadConstants.USER_TYPE){return 'fbid:'+la.getValue();}else return 'email:'+la.getValue();}),ka=r.getCurrentStateData();if(!ka.start||(ja||[]).length)r.updateDetailState(q.DETAIL.COMPOSE_MAIN,x({},ka,{participants:ja}));}}},destroy:function(){}});function aa(da){var ea=r.getCurrentDetailState(),fa=q;if(ea!=fa.DETAIL.COMPOSE_MAIN&&ea!=fa.DETAIL.COMPOSE_TYPEAHEAD_RESULTS)return;var ga;if(da){ga=fa.DETAIL.COMPOSE_TYPEAHEAD_RESULTS;}else if(ea==fa.DETAIL.COMPOSE_TYPEAHEAD_RESULTS){ga=fa.DETAIL.COMPOSE_MAIN;}else ga=ea;if(ga!=ea){var ha=x(r.getCurrentStateData(),{start:false,new_tokens:undefined});r.updateDetailState(ga,ha);}}function ba(da){var ea=r.getCurrentStateData();if(ea.new_tokens){var fa=da._typeahead.getTypeahead().getCore();fa.reset();ea.new_tokens.forEach(function(ia){da._typeahead.getTokenizer().addToken(ia);});if(ea.new_tokens.length==1){var ga=ea.new_tokens[0],ha=p.getNow('fbid:'+ga.getValue());if(ha&&ha.type==h.MercuryParticipantTypes.PAGE)fa.getElement().setAttribute('disabled','disabled');}}}function ca(da,ea){var fa=da._typeahead.getTypeahead(),ga=fa.getCore().getValue(),ha=fa.getData().hasLoadedInitialResults(ga);i.conditionShow(da._initialResultsLoadingSpinner,!ha);i.conditionShow(da._moreResultsLink,ha&&ea);if(!ea&&ha){k.setContent(da._typeaheadCaption,"No results found");}else k.setContent(da._typeaheadCaption,"Displaying top results");}e.exports=z;});
__d("WebMessengerUnseenMessageNoticeRenderer",["JSXDOM","ContextualLayer","LayerFadeOnHide","cx","tx","event-extensions"],function(a,b,c,d,e,f){var g=b('JSXDOM'),h=b('ContextualLayer'),i=b('LayerFadeOnHide'),j=b('cx'),k=b('tx');b('event-extensions');var l={renderNoticeTooltip:function(n,o){var p=g.div({className:"_40p",children:[m(n),g.i({className:"_40q"})]}),q=new h(o||{},p).enableBehavior(i);return q;}};function m(n){var o=g.div({className:"_40r",children:"You have new messages"});Event.listen(o,'click',n);return o;}e.exports=l;});
__d("WebMessengerMessagesNotice",["event-extensions","copyProperties","LayerDestroyOnHide","WebMessengerUnseenMessageNoticeRenderer","MercuryParticipants"],function(a,b,c,d,e,f){b('event-extensions');var g=b('copyProperties'),h=b('LayerDestroyOnHide'),i=b('WebMessengerUnseenMessageNoticeRenderer'),j=b('MercuryParticipants'),k=function(){this._notice=null;this._noticeContextNode=null;this._active=false;};g(k.prototype,{getActive:function(){return this._active;},showMessageNotice:function(l,m){if(!this._active)return;if(!this._notice)this._notice=i.renderNoticeTooltip(l,{context:this._noticeContextNode,offsetY:2,position:m,alignment:'center'});this._notice.show();},hideMessageNotice:function(){this._notice&&this._notice.hide();},removeMessageNotice:function(){if(this._notice){this._notice.enableBehavior(h).hide();this._notice=null;}},setNoticeContextNode:function(l){this._noticeContextNode=l;},hideView:function(){this._active=false;this.hideMessageNotice();},updateView:function(){this._active=true;},destroy:function(){this._active=false;this.removeMessageNotice();},onlyReceivedFromSelf:function(l){for(var m in l){if(!l.hasOwnProperty(m))continue;for(var n=0,o=l[m].length;n<o;n++)if(l[m][n].author!==j.user)return false;}return true;}});e.exports=k;});
__d("WebMessengerDetailViewUnreadMessagesNotice",["event-extensions","Class","copyProperties","WebMessengerStateManager","throttle","MercuryThreadInformer","MercuryThreads","UserActivity","WebMessengerMessagesNotice","WebMessengerConstants","WebMessengerSubscriptionsHandler"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Class'),h=b('copyProperties'),i=b('WebMessengerStateManager'),j=b('throttle'),k=b('MercuryThreadInformer'),l=b('MercuryThreads').get(),m=b('UserActivity'),n=b('WebMessengerMessagesNotice'),o=b('WebMessengerConstants'),p=b('WebMessengerSubscriptionsHandler'),q=o.MESSAGE_NOTICE_INACTIVITY_THRESHOLD,r=function(t){this.parent.construct(this);this._manager=t;p.addSubscriptions(k.subscribe('thread-read-changed',s.curry(this)));this._manager.setScrollCallback(j(function(u){var v=i.getCurrentStateData().thread_id;if(this.parent.getActive()&&u.isScrolledToBottom()&&m.isActive(5000)&&v){this.removeMessageNotice();l.changeThreadReadStatus(v,true);}}.bind(this),100,null));};g.extend(r,n);h(r.prototype,{updateOnMessagesReceived:function(t,u,v,w){var x=!m.isActive(q);if(!this.parent.getActive())return;if(x||this.parent.onlyReceivedFromSelf(w)){this.removeMessageNotice();this._manager.scrollToBottom(true);}else if(!this._manager.isScrolledToBottom()){var y=v-(u-t);this._manager.setScrollTop(y,false);this.showMessageNotice();}},showMessageNotice:function(){var t=function(){this._manager.scrollToBottom();}.bind(this);this.parent.showMessageNotice(t,'above');}});function s(t,u,v){var w=i.getCurrentStateData().thread_id;if(w&&v[w]&&v[w].mark_as_read)t.removeMessageNotice();}e.exports=r;});
__d("MercuryListUpdateRenderer",["DOM","ge"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('ge'),i={updateList:function(j,k,l,m,n){var o=[];for(var p=0;p<k.length;p++){if(n){var q=n(p);q&&o.push(q);}var r=h(k[p]);if(r&&l(p)){o.push(r);}else o.push(m(p));}g.setContent(j,o);}};e.exports=i;});
__d("MessagingConst",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties'),h={APP_ID:313785040330,XD_MESSAGE:{SANDBOX_READY:'sandbox_ready',SET_CONTENT:'set_content',HTML_SIZE:'html_size',REFRESH_SIZE:'refresh_size'},SHINGLE_SCROLL_TRIGGER:5,EVENTS:{MESSAGE_SENT:'messaging/message_sent'},initConstants:function(i){g(h,i);}};e.exports=h;});
__d("MessagingXD",["event-extensions","DOM","MercuryConstants","MessagingConst","URI","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('DOM'),h=b('MercuryConstants'),i=b('MessagingConst'),j=b('URI'),k=b('copyProperties');function l(m){this._listeners=[Event.listen(window,'message',this._onPostMessage.bind(this))];this._iframes={};this._contentWindows={};this._messageHandler=m;}k(l.prototype,{unload:function(){this._listeners.forEach(function(m){m.remove();});},createIframe:function(m,n,o){var p=new j(o);this._iframes[n]=g.create('iframe',{name:n,frameBorder:0,src:p.toString()});g.appendContent(m,this._iframes[n]);this._contentWindows[n]=this._iframes[n].contentWindow;return this._iframes[n];},sendMessage:function(m,n){var o=Array.prototype.slice.apply(arguments);o[0]=i.APP_ID;var p=this._iframes[m].contentWindow||this._contentWindows[m];p.postMessage(o.join(','),h.Sandbox.ORIGIN);},_onPostMessage:function(event){if(event.origin!==h.Sandbox.ORIGIN||!event.data.split)return;var m=event.data.split(','),n=unescape(m[1]);this._contentWindows[n]=event.source;this._messageHandler(n,m);}});e.exports=l;});
__d("HTMLEmailRenderer",["CSS","MessagingConst","MessagingXD","copyProperties","emptyFunction","tx","MercuryConstants"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('MessagingConst'),i=b('MessagingXD'),j=b('copyProperties'),k=b('emptyFunction'),l=b('tx'),m=b('MercuryConstants');function n(o,p){this._resizeContent=o.resizeContent||k;this._richMap={};this._useFBStyle=p;this._xdc=new i(this.onXDMessage.bind(this));this._maxWidth=0;}j(n.prototype,{onXDMessage:function(o,p){if(p[0]!=h.APP_ID.toString())return;if(this._richMap&&this._richMap[o])if(p[2]==h.XD_MESSAGE.SANDBOX_READY){return this.setIframeContent(o);}else if(p[2]==h.XD_MESSAGE.HTML_SIZE)return this._resizeContent(o,parseInt(p[3],10),parseInt(p[4],10),p[5]=='true',p[6]=='true');},setIframeContent:function(o,p){this._xdc.sendMessage(o,h.XD_MESSAGE.SET_CONTENT,escape(this._richMap[o]),this._useFBStyle?'useFBStyle':'',p?'forceDialogOnWide':'',escape("Show Hidden Text"),escape("Hide"),this._maxWidth);},makeRich:function(o,p,q,r){var s=this._xdc.createIframe(p,o,m.Sandbox.PAGE_URL);g.addClass(s,'xdIframe');this._richMap[o]=q;this._maxWidth=r||0;},updateRichMap:function(o,p){this._richMap[o]=p;},unload:function(){this._xdc.unload();}});e.exports=n;});
__d("WebMessengerThreadMessagesRenderer",["JSXDOM","event-extensions","AsyncRequest","MercuryAttachment","MercuryAttachmentRenderer","MercuryConstants","CSS","DataStore","DOM","HovercardLink","HTMLEmailRenderer","MercuryImageTemplates","MercuryConfig","MercuryMessageRenderer","MercuryMessages","MercuryParticipants","React","Style","WebMessengerTemplates","MercuryThreadMetadataRawRenderer","MercuryThreadMetadataRenderer","Vector","WebMessengerConstants","csx","cx","ge","isRTL","tx"],function(a,b,c,d,e,f){var g=b('JSXDOM');b('event-extensions');var h=b('AsyncRequest'),i=b('MercuryAttachment'),j=b('MercuryAttachmentRenderer'),k=b('MercuryConstants'),l=b('CSS'),m=b('DataStore'),n=b('DOM'),o=b('HovercardLink'),p=b('HTMLEmailRenderer'),q=b('MercuryImageTemplates'),r=b('MercuryConfig'),s=b('MercuryMessageRenderer'),t=b('MercuryMessages'),u=b('MercuryParticipants'),v=b('React'),w=b('Style'),x=b('WebMessengerTemplates'),y=b('MercuryThreadMetadataRawRenderer'),z=b('MercuryThreadMetadataRenderer'),aa=b('Vector'),ba=b('WebMessengerConstants'),ca=b('csx'),da=b('cx'),ea=b('ge'),fa=b('isRTL'),ga=b('tx'),ha=k.MercuryAttachmentType,ia={renderForwardedMessages:function(qa,ra){var sa=ia.calculateMessageGroups(ra),ta=null;sa.forEach(function(ua){var va=ia.renderMessageGroupArray(ua,true);n.appendContent(qa,va.getRoot());ta=ua[ua.length-1];});},calculateMessageGroups:function(qa){var ra=[],sa=null,ta=null;for(var ua=0,va=qa.length;ua<va;ua++){var wa=qa[ua],xa=ia.canAppendMessageToLastGroup(ta,wa);if(!xa){sa=[];ra.push(sa);}sa.push(wa);ta=wa;}return ra;},canAppendMessageToLastGroup:function(qa,ra){var sa=k.MercuryThreadlistConstants.GROUPING_THRESHOLD;if(!qa||ja(qa)||ja(ra)||qa.author!=ra.author||qa.timestamp<ra.timestamp-sa||qa.spoof_warning!==ra.spoof_warning)return false;return true;},renderMessageGroupArray:function(qa,ra,sa){var ta=ia.renderMessageGroup(qa[0],ra,sa);for(var ua=1;ua<qa.length;ua++)ia.appendMessageToGroup(ta,qa[ua]);return ta;},renderMessageGroup:function(qa,ra,sa){var ta=qa.action_type==k.MercuryActionType.LOG_MESSAGE,ua=ta?x[':fb:web-messenger:read-view:log-message'].build():x[':fb:web-messenger:read-view:message-group'].build();ua.getRoot().setAttribute('id',(sa||'wm:')+qa.message_id);if(ta){ia.renderSingleLogMessage(ua,qa);}else u.get(qa.author,function(va){ia.renderSingleMessage(ua,qa,va,ra);});return ua;},appendMessageToGroup:function(qa,ra){var sa=x[':fb:web-messenger:read-view:message'].build();if(ra.is_filtered_content){var ta=x[':fb:web-messenger:read-view:message:filtered'].build();sa.setNodeContent('message',ta.getRoot());}else sa.setNodeContent('message',s.formatMessageBody(ra.body,null,true));var ua=y.renderStatusIndicator(ra.status,ra.error_data,t.resendMessage.bind(t,ra,k.MercuryAPIArgsSource&&k.MercuryAPIArgsSource.WEBMESSENGER));if(ua)sa.setNodeContent('status',ua);var va=sa.getRoot();m.set(va,'MessageRenderer:messageID',ra.message_id);l.addClass(sa.getNode('message'),fa(ra.body)?'direction_rtl':'direction_ltr');n.appendContent(qa.getNode('bodyDiv'),va);u.get(u.user,function(wa){if(wa.employee)n.setContent(sa.getNode('bugReporting'),x[':fb:web-messenger:bug-reporting'].render());});},getMessageIDsFromMessageGroup:function(qa){var ra=n.scry(qa,"._53"),sa=[];if(ra.length){var ta=ra[0];for(var ua=0;ua<ta.childNodes.length;ua++)sa.push(m.get(ta.childNodes[ua],'MessageRenderer:messageID'));}return sa;},renderSingleLogMessage:function(qa,ra){var sa=qa.getNode('attachment');s.renderLogMessage(qa.getNode('icon'),qa.getNode('message'),sa,ra);if(ra.log_message_data.image)l.addClass(sa.firstChild,"_1_vi");z.renderTimestamp(qa.getNode('timestamp'),ra.timestamp_absolute,ra.timestamp_relative,ra.timestamp);},renderMessageSeparator:function(qa){var ra=x[':fb:mercury:timestamp'].render();ra.removeAttribute('title');var sa=qa.timestamp_absolute;if(!sa)sa=s.renderDate(new Date(qa.timestamp));if(t.isFirstMessage(qa))if(qa.timestamp_time_passed===k.MercuryTimePassed.TODAY){sa="Conversation started today";}else sa=ga._("Conversation started {timestamp}",{timestamp:sa});n.setContent(ra,sa);l.show(ra);return n.create('li',{className:"_2n3"},ra);},renderMessageSeparatorForIndex:function(qa,ra){var sa=qa[ra][0];if(ra){var ta=sa.timestamp,ua=qa[ra-1],va=ua[ua.length-1].timestamp,wa=ba.READ_VIEW_SEPARATOR_TIME_LIMIT;if(ta-va<wa)return false;}return ia.renderMessageSeparator(sa);},renderRawAttachments:function(qa,ra){var sa=i.convertRaw(ra);ia.renderAttachments(qa,sa);},renderAttachments:function(qa,ra,sa){pa(ra);var ta=[];for(var ua=0;ua<ra.length;ua++){var va=ra[ua],wa=va.attach_type;if(wa==ha.ERROR){n.appendContent(qa,j.renderError(va));}else if(wa==ha.FILE&&!va.preview_url)if(va.metadata&&va.metadata.type==k.MercuryAttachmentAudioClip){var xa=j.renderAudioClip(va,ba.AUDIO_CLIP_MIN_WIDTH,ba.AUDIO_CLIP_MAX_WIDTH);if(xa){var ya=g.div({});n.appendContent(qa,ya);v.renderComponent(xa,ya);}else n.appendContent(qa,j.renderExtendedFileLink(va));}else n.appendContent(qa,j.renderExtendedFileLink(va));var za=null;if(wa==ha.SHARE&&va.share_xhp){za=j.renderShareXHP(va,sa);}else if(va.preview_url){ta.push(va);if(ua==ra.length-1||!ra[ua+1].preview_url)n.appendContent(qa,ia._renderMultiplePreviews(ta,ta.length));}else if(wa==ha.SHARE)za=j.renderShareLink(va);if(za)n.appendContent(qa,za);}},renderThumbnails:function(qa,ra){n.appendContent(qa,ia._renderMultiplePreviews(null,ra));},_renderMultiplePreviews:function(qa,ra){var sa=g.div({className:"_ksb"});if(!ra){return sa;}else if(ra===1){l.addClass(sa,"_1_vi");l.addClass(sa,"_1_vj");}else{var ta=g.table({cellpadding:"0",cellspacing:"0",className:"_1_vk"});n.appendContent(sa,ta);if(ra===2||ra===4){l.addClass(ta,"_1_vl");}else l.addClass(ta,"_1_vm");}var ua;if(ra>9){ua=4;}else if(ra===2||ra===4){ua=2;}else if(ra>2){ua=3;}else ua=1;var va=ra===1?0:(408/ua)-8,wa,xa,ya='&numPreviews='+ra;for(var za=0;za<ra;++za){if(ra>1&&za%ua===0){wa=g.tr({});n.appendContent(ta,wa);}if(qa){xa=j.renderPreview(qa[za],va,ya);}else xa=j.renderPreview(null,va);if(ra===1){n.appendContent(sa,xa);}else n.appendContent(wa,g.td({children:xa}));}return sa;},renderSingleMessage:function(qa,ra,sa,ta){qa.setNodeProperty('bodyDiv','id',ra.message_id);if(ra.html_body){var ua=qa.getNode('fbml');Event.listen(ua,'click',function(){new h().setURI('/ajax/messaging/async.php').setReadOnly(true).setMethod('GET').setData({action:'htmlDialog',mid:ra.message_id}).send();return false;});l.show(ua);var va=qa.getNode('bodyDiv'),wa=g.div({className:"_5xl"}),xa=g.div({className:"_5xm",children:wa});n.setContent(va,xa);m.set(xa,'MessageRenderer:messageID',ra.message_id);var ya=new p({resizeContent:ka}),za=function(){ya.makeRich(ra.message_id,wa,ra.html_body);};za.defer();if(ra.status!==undefined){var ab=qa.getNode('metadata'),bb=y.renderStatusIndicator(ra.status,ra.error_data,t.resendMessage.bind(t,ra));bb&&n.appendContent(ab,bb);}}else ia.appendMessageToGroup(qa,ra);var cb;if(sa.href){cb=n.create('a',{href:sa.href},sa.name);var db=u.getUserID(sa.id);if(db)cb.setAttribute('data-hovercard',o.constructEndpoint({id:db}));}else cb=sa.name;qa.setNodeContent('authorName',cb);var eb=qa.getNode('image');l.removeClass(eb,'MercuryThreadImage');var fb=q[':fb:mercury:thread-image:single:medium'].render();fb.setAttribute('src',sa.image_src);if(sa.href)fb=n.create('a',{href:sa.href},fb);n.setContent(eb,fb);var gb=Date.format(r['24h_times']?'H:i':'g:ia',Math.floor(ra.timestamp/1000));z.renderTimestamp(qa.getNode('timestamp'),ra.timestamp_absolute,gb,ra.timestamp);qa.getNode('mapHovercard').removeAttribute('href');if(ra.coordinates){l.hide(qa.getNode('tooltipForSource'));z.renderMessageLocation(qa.getNode('mapHovercard'),qa.getNode('locationIcon'),ra.coordinates);}else{qa.getNode('mapHovercard').removeAttribute('data-hovercard');z.renderMessageSourceTags(qa.getNode('tooltipForSource'),qa.getNode('sourceIcon'),ra.source_tags||[],ra.author_email);z.renderSpoofWarning(qa.getNode('spoofWarning'),ra.spoof_warning,sa);}if(ra.subject)qa.setNodeContent('subject',ra.subject);if(ra.has_attachment){var hb=qa.getNode('attachments');if(ra.attachments&&ra.attachments.length===0){var ib=0;if(ra.photo_fbids)ib+=ra.photo_fbids.length;if(ra.raw_attachments&&ra.raw_attachments.length>0){var jb=[];ra.raw_attachments.forEach(function(mb){if(i.getAttachTypeByMime(mb.filetype)===k.MercuryAttachmentContentType.PHOTO){ib++;}else jb.push(mb);});ia.renderRawAttachments(hb,jb);}ia.renderThumbnails(hb,ib);}else if(ra.attachments!==null&&ra.attachments.length>0){ia.renderAttachments(hb,ra.attachments,ra.message_id);}else if(ra.raw_attachments!=null&&ra.raw_attachments.length>0)ia.renderRawAttachments(hb,ra.raw_attachments);}if(ra.forward_count){var kb=qa.getNode('forwards'),lb=t.getMessagesFromIDs(ra.forward_message_ids);if(lb)ia.renderForwardedMessages(kb,lb);}}};function ja(qa){return qa.action_type==k.MercuryActionType.LOG_MESSAGE||qa.has_attachment||qa.forward_count||qa.html_body||(qa.body&&qa.body.length>k.MercuryThreadlistConstants.MAX_CHARS_BEFORE_BREAK);}function ka(qa,ra,sa){var ta=ea(qa),ua=n.find(ta,'iframe'),va=n.find(ua,"^._5xm"),wa=va.firstChild;w.set(ua,'width',ra+'px');w.set(ua,'height',(sa+1)+'px');ua.setAttribute('scrolling','no');var xa=ta&&aa.getElementDimensions(ta).x/ra;if(xa&&xa<1){w.set(va,'height',Math.round(xa*(sa+1))+'px');var ya=ua.style,za=['transform','WebkitTransform','msTransform','MozTransform','OTransform'],ab;while(ab=za.shift())if(typeof ya[ab]!=='undefined'){w.set(ua,ab,'scale('+xa+','+xa+')');return;}w.set(wa,'zoom',xa);}}function la(qa){return qa.attach_type==ha.SHARE;}function ma(qa){return qa.attach_type==ha.FILE;}function na(qa){return qa.preview_url;}function oa(qa){return qa.attach_type==ha.ERROR;}function pa(qa){var ra=[la,na,ma,oa];qa.sort(function(sa,ta){for(var ua=0;ua<ra.length;ua+=1){var va=ra[ua],wa=va(sa),xa=va(ta);if(wa&&!xa){return -1;}else if(wa&&xa){return 0;}else if(!wa&&xa)return 1;}return 0;});}e.exports=ia;});
__d("WebMessengerMessagesSelection",["CSS","csx","DOM","getObjectValues","WebMessengerThreadMessagesRenderer"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('csx'),i=b('DOM'),j=b('getObjectValues'),k=b('WebMessengerThreadMessagesRenderer'),l={};function m(p,q){var r=p,s=q;if(r==s)return 0;while(true){r=r.nextSibling;s=s.nextSibling;if(!r||s==p){return 1;}else if(!s||r==q)return -1;}}function n(p,q){var r=p.id,s=i.scry(p,"._yh input")[0];if(q){l[r]=p;g.addClass(p,'selected');s.checked=true;}else{delete l[r];g.removeClass(p,'selected');s.checked=false;}}var o={clear:function(){for(var p in l)n(l[p],false);},selectClick:function(p){n(p,!(p.id in l));},getSelectedMessageIDs:function(){var p=j(l);p.sort(m);var q=[];p.forEach(function(r){q=q.concat(k.getMessageIDsFromMessageGroup(r));});return q;}};e.exports=o;});
__d("WebMessengerInfoBoxRenderer",["event-extensions","cx","DOM","WebMessengerSubscriptionsHandler"],function(a,b,c,d,e,f){b('event-extensions');var g=b('cx'),h=b('DOM'),i=b('WebMessengerSubscriptionsHandler'),j={render:function(k,l){var m=h.create('div',{className:"_4rk"},k),n=h.create('div',{}),o=true;l.forEach(function(p){if(!o){var q=h.create('span',{className:"_4rl"},'\u00b7');h.appendContent(n,q);}o=false;var r=h.create('a',{},p.text);if(p.handler)i.addSubscriptions(Event.listen(r,'click',p.handler));h.appendContent(n,r);});return h.create('div',{className:"_4rh"},[m,n]);}};e.exports=j;});
__d("WebMessengerDetailViewRecentMessagesControl",["event-extensions","Animation","ChatTabIndicatorLine","MercuryConstants","CSS","WebMessengerDetailViewUnreadMessagesNotice","DOM","MercuryListUpdateRenderer","MercuryConfig","MercuryParticipants","MercuryMessages","WebMessengerMessagesSelection","WebMessengerStateConstants","WebMessengerStateManager","Style","WebMessengerTemplates","MercuryThreadInformer","WebMessengerThreadMessagesRenderer","MercuryThreads","UserActivity","WebMessengerConstants","WebMessengerInfoBoxRenderer","WebMessengerSubscriptionsHandler","copyProperties","ge","tx"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Animation'),h=b('ChatTabIndicatorLine'),i=b('MercuryConstants'),j=b('CSS'),k=b('WebMessengerDetailViewUnreadMessagesNotice'),l=b('DOM'),m=b('MercuryListUpdateRenderer'),n=b('MercuryConfig'),o=b('MercuryParticipants'),p=b('MercuryMessages'),q=b('WebMessengerMessagesSelection'),r=b('WebMessengerStateConstants'),s=b('WebMessengerStateManager'),t=b('Style'),u=b('WebMessengerTemplates'),v=b('MercuryThreadInformer'),w=b('WebMessengerThreadMessagesRenderer'),x=b('MercuryThreads').get(),y=b('UserActivity'),z=b('WebMessengerConstants'),aa=b('WebMessengerInfoBoxRenderer'),ba=b('WebMessengerSubscriptionsHandler'),ca=b('copyProperties'),da=b('ge'),ea=b('tx'),fa=function(wa,xa,ya,za,ab,bb,cb){this._manager=wa;this._rootElement=xa;this._loadingSpinner=ya;this._noSelectedConversation=za;this._newMessageLink=ab;this._showUnreadLink=bb;l.empty(this._rootElement);this._pagerExponent=-1;var db=u[':fb:web-messenger:read-view:recent-messages'].build();l.setContent(this._rootElement,db.getRoot());this._selectedConversationView=db.getRoot();this._messageList=db.getNode('messagelist');this._loadMoreButton=db.getNode('loadMoreButton');this._loadMoreLink=db.getNode('loadMoreLink');this._loadMoreCount=db.getNode('loadMoreCount');this._loadingMoreCount=db.getNode('loadingMoreCount');this._indicatorNode=db.getNode('typingIndicator');this._unseenMessagesNotice=new k(this._manager);this._unseenMessagesNotice.setNoticeContextNode(cb);this._active=false;this._state=null;this._threadID=null;this._bugReportingEnabled=false;this._currentCountMap={};this._olderMessageID={};this._loadMessagesInFlight={};ba.addSubscriptions(Event.listen(this._messageList,'click',function(event){if(this._selectionEnabled){var eb=null,fb='webMessengerMessageGroup';for(var gb=event.getTarget();gb;gb=gb.parentNode)if(j.hasClass(gb,fb))eb=gb;eb&&q.selectClick(eb);}}.bind(this)),Event.listen(this._loadMoreLink,'click',pa.curry(this)),v.subscribe('messages-reordered',function(eb,fb){var gb=this._threadID&&fb[this._threadID];if(gb)la(this);}.bind(this)),v.subscribe('messages-updated',function(eb,fb){var gb=this._threadID&&fb[this._threadID];if(gb)var hb=Object.keys(gb),ib=hb.length&&gb[hb[0]];if(gb&&ib)la(this,fb[this._threadID]);}.bind(this)),v.subscribe('messages-received',function(eb,fb){if(this._threadID&&fb[this._threadID])oa(this,fb);}.bind(this)),v.subscribe('thread-read-changed',function(eb,fb){if(fb[this._threadID])ta(this,fb[this._threadID]);}.bind(this)),this._manager.subscribe('scrolledNearTop',function(){this._active&&pa(this);}.bind(this)));};ca(fa.prototype,{hideView:function(){this._active=false;j.hide(this._rootElement);j.hide(this._loadingSpinner);j.hide(this._noSelectedConversation);this._unseenMessagesNotice.hideView();this._manager._flexArea.setBottomAligned(false);},updateView:function(){this._unseenMessagesNotice.updateView();this._active=true;this._manager._flexArea.setBottomAligned(true);j.show(this._rootElement);var wa=ha(this);ia(this);q.clear();if(wa){ja(this);}else ra(this);},destroy:function(){ga(this);this._unseenMessagesNotice.destroy();this._typingIndicator&&this._typingIndicator.destroy();}});function ga(wa){wa._messagesSubscription&&p.unsubscribe(wa._messagesSubscription.subscriber_id,wa._messagesSubscription.thread_id);wa._messagesSubscription=null;}function ha(wa){var xa=s.getCurrentStateData();if(!wa._threadID||wa._threadID!=xa.thread_id)return true;return false;}function ia(wa){var xa=s.getCurrentStateData();wa._state=s.getCurrentDetailState();wa._threadID=xa.thread_id;wa._selectionEnabled=!!xa.message_action;wa._bugReportingEnabled=xa.bug_reporting_enabled;j.conditionClass(wa._messageList,'selectionEnabled',wa._selectionEnabled);j.conditionClass(wa._messageList,'bugReportingEnabled',wa._bugReportingEnabled);}function ja(wa){l.empty(wa._messageList);j.show(wa._loadingSpinner);j.hide(wa._loadMoreButton);ga(wa);wa._pagerExponent=-1;wa._typingIndicator&&wa._typingIndicator.destroy();delete wa._typingIndicator;if(wa._threadID){j.show(wa._selectedConversationView);j.hide(wa._noSelectedConversation);if(!wa._olderMessageID[wa._threadID]){ka(wa);}else la(wa);wa._manager.scrollToBottom(false);}else{va(wa);j.hide(wa._selectedConversationView);j.show(wa._noSelectedConversation);j.hide(wa._loadingSpinner);}}function ka(wa){wa._loadMessagesInFlight[wa._threadID]=true;wa._currentCountMap[wa._threadID]=z.INITIAL_MESSAGES_LIMIT+1;j.hide(wa._loadMoreButton);var xa=p.getThreadMessagesRangeImmediately(wa._threadID,0,wa._currentCountMap[wa._threadID],ma.curry(wa),i.MercuryAPIArgsSource&&i.MercuryAPIArgsSource.WEBMESSENGER);if(xa){wa._messagesSubscription={subscriber_id:xa,thread_id:wa._threadID};}else la(wa);}function la(wa,xa){if(!wa._threadID||!wa._olderMessageID[wa._threadID])return;var ya=p.getThreadMessagesSinceTimestamp(wa._threadID,ua(wa._olderMessageID[wa._threadID]));if(ya.length>wa._currentCountMap[wa._threadID])wa._currentCountMap[wa._threadID]=ya.length;na(wa,ya,xa);}function ma(wa,xa){wa._loadMessagesInFlight[wa._threadID]=false;if(xa&&xa.length){var ya=xa[0].timestamp,za=wa._olderMessageID[wa._threadID]?ua(wa._olderMessageID[wa._threadID]):null;if(!za||ya<za)wa._olderMessageID[wa._threadID]=xa[0].message_id;}}function na(wa,xa,ya){j.hide(wa._loadingSpinner);j.conditionShow(wa._loadMoreButton,!p.hasLoadedAllMessages(wa._threadID));var za=x.getThreadMetaNow(wa._threadID);if(za){var ab=za.message_count-xa.length;ab=(ab<0)?0:ab;l.setContent(wa._loadMoreCount,ab);l.setContent(wa._loadingMoreCount,ab);}var bb=function(jb){var kb,lb=da('wm:'+jb);if(lb)kb=w.getMessageIDsFromMessageGroup(lb);return kb||[];},cb=[],db=w.calculateMessageGroups(xa),eb={},fb=[];db.forEach(function(jb){var kb=jb[0].message_id,lb=false;if(ya){lb=jb.some(function(nb){return nb.message_id in ya;});if(!lb){cb=bb(kb);lb=cb.some(function(nb){return nb in ya;});}}if(!lb){cb=bb(kb);if(jb.length==cb.length){for(var mb=0;mb<jb.length;mb++)if(jb[mb].message_id!=cb[mb]){lb=true;break;}}else lb=true;}if(lb)eb[kb]=1;fb.push('wm:'+kb);});var gb=function(jb){return !eb[db[jb][0].message_id];},hb=function(jb){var kb=db[jb],lb=w.renderMessageGroupArray(kb);if(jb==fb.length-1)wa._messageGroup=lb;return lb.getRoot();},ib=function(jb){return w.renderMessageSeparatorForIndex(db,jb);};m.updateList(wa._messageList,fb,gb,hb,ib);wa._lastMessage=xa[xa.length-1];qa(wa).setLastMessage(wa._lastMessage);ra(wa);wa._manager.poke();}function oa(wa,xa){var ya=xa[wa._threadID],za=wa._manager._flexArea.getScrollableArea(),ab=za.getScrollHeight();ya.forEach(function(db){db.timestamp_relative=Date.format(n['24h_times']?'H:i':'g:ia',db.timestamp/1000);var eb=w.canAppendMessageToLastGroup(wa._lastMessage,db);if(!eb){wa._messageGroup=w.renderMessageGroup(db);var fb=db.timestamp,gb=wa._lastMessage?wa._lastMessage.timestamp:0,hb=z.READ_VIEW_SEPARATOR_TIME_LIMIT;if(!gb||fb-gb>=hb){var ib=w.renderMessageSeparator(db);l.appendContent(wa._messageList,ib);}l.appendContent(wa._messageList,wa._messageGroup.getRoot());}else w.appendMessageToGroup(wa._messageGroup,db);if(db.author!=o.user)j.addClass(wa._messageGroup.getRoot(),'unreadHighlight');wa._lastMessage=db;});wa._manager._flexArea.poke();var bb=za.getScrollHeight(),cb=za.getScrollTop();wa._unseenMessagesNotice.updateOnMessagesReceived(ab,bb,cb,xa);qa(wa).setLastMessage(wa._lastMessage);if(wa._manager.isScrolledToBottom())ra(wa);}function pa(wa){j.addClass(wa._loadMoreButton,'async_saving');if(wa._loadMessagesInFlight[wa._threadID])return;wa._loadMessagesInFlight[wa._threadID]=true;wa._pagerExponent=Math.min(wa._pagerExponent+1,z.EXPONENTIAL_PAGER_MAX_CYCLES);var xa=Math.pow(2,wa._pagerExponent),ya=wa._currentCountMap[wa._threadID]+(xa*i.MercuryThreadlistConstants.WEBMESSENGER_MORE_MESSAGES_COUNT);ga(wa);var za=p.getThreadMessagesRangeImmediately(wa._threadID,0,ya,function(ab){j.removeClass(wa._loadMoreButton,'async_saving');wa._currentCountMap[wa._threadID]=ya;ma(wa,ab);wa._loadMessagesInFlight[wa._threadID]=false;},i.MercuryAPIArgsSource&&i.MercuryAPIArgsSource.WEBMESSENGER);if(za)wa._messagesSubscription={subscriber_id:za,thread_id:wa._threadID};}function qa(wa){if(!wa._typingIndicator)wa._typingIndicator=new h(wa._threadID,wa._indicatorNode,wa._manager._flexArea);return wa._typingIndicator;}function ra(wa){if(y.isActive(5000)){sa(wa);}else y.subscribeOnce(sa.curry(wa));}function sa(wa){if(!wa._threadID||!wa._active)return;x.changeThreadReadStatus(wa._threadID,true);var xa=l.scry(wa._messageList,'.unreadHighlight');xa.forEach(function(ya){j.removeClass(ya,'unreadHighlight');j.addClass(ya,'unreadFading');new g(ya).from('background','#eceff5').to('background','#fff').from('borderColor','#d6d6d6').to('borderColor','#fff').ease(g.ease.both).duration(1500).ondone(function(){j.removeClass(ya,'unreadFading');t.set(ya,'background','');t.set(ya,'borderColor','');}).go();});}function ta(wa,xa){if(!xa.mark_as_read)return;var ya=l.scry(wa._messageList,'.unreadHighlight');for(var za=0;za<ya.length;za++){var ab=ya[za],bb=w.getMessageIDsFromMessageGroup(ab),cb=p.getMessagesFromIDs(bb);if(cb[cb.length-1].timestamp<xa.timestamp)j.removeClass(ab,'unreadHighlight');}}function ua(wa){var xa=p.getMessagesFromIDs([wa])[0];return xa?xa.timestamp:0;}function va(wa){if(wa._builtNoSelectionBox)return;var xa=function(){var za=s.getCurrentStateData(),ab=ca({},za);s.updateDetailState(r.DETAIL.COMPOSE_MAIN,ca(ab,{start:true,thread_id:undefined}));},ya=function(){var za=s.getCurrentStateData(),ab=ca({},za);s.updateMasterState(r.MASTER.RECENT_THREADS,ca(ab,{folder:i.MessagingTag.INBOX,filter:i.MessagingTag.UNREAD}));};l.setContent(wa._noSelectedConversation,aa.render("No Conversation Selected",[{text:"New Message",handler:xa},{text:"Show Unread",handler:ya}]));wa._builtNoSelectionBox=true;}e.exports=fa;});
__d("MercurySearchContextResults",["MercuryConstants","KeyedCallbackManager","RangedCallbackManager","MercuryServerDispatcher","MercuryServerRequests","WebMessengerConstants"],function(a,b,c,d,e,f){var g=b('MercuryConstants'),h=b('KeyedCallbackManager'),i=b('RangedCallbackManager'),j=b('MercuryServerDispatcher'),k=b('MercuryServerRequests'),l=b('WebMessengerConstants'),m=new h(),n=g.MercuryThreadlistConstants.WEBMESSENGER_SEARCH_SNIPPET_COUNT,o=l.MORE_SEARCH_CONTEXT_COUNT,p={getSearchContext:function(t,u,v){if(t){var w=m.executeOrEnqueue(t,function(z){var aa=r(z,t);v(aa);}),x=m.getUnavailableResources(w);if(x.length){var y=k.getServerThreadIDNow(u);s({message_id:t,thread_id:y,limit:n+1});}return w;}},getMoreSearchContext:function(t,u,v,w){if(t){var x=m.getResource(t);if(x){var y=v==l.MORE_SEARCH_CONTEXT_UP?x.up_message_ids:x.down_message_ids,z=y.getCurrentArraySize()+o,aa=y.executeOrEnqueue(0,z,function(){var da=r(x,t);w(da);}),ba=y.getUnavailableResources(aa);if(ba.length){var ca=k.getServerThreadIDNow(u);s({message_id:t,thread_id:ca,limit:z,direction:v});}return aa;}}},handleUpdate:function(t){if(t.mercury_payload)k.handleUpdate(t.mercury_payload);var u=t.search_context||{};for(var v in u){var w=u[v],x=w.thread_id,y=k.getClientThreadIDNow(x),z=!m.getResource(v),aa=z?{thread_id:y,up_message_ids:new i(),down_message_ids:new i()}:m.getResource(v),ba=z?n+1:o;if(w.up_message_ids&&(aa.up_message_ids.getCurrentArraySize()===0||w.up_message_ids.length>=aa.up_message_ids.getCurrentArraySize()))q(aa.up_message_ids,w.up_message_ids,ba);if(w.down_message_ids&&(aa.down_message_ids.getCurrentArraySize()===0||w.down_message_ids.length>=aa.down_message_ids.getCurrentArraySize()))q(aa.down_message_ids,w.down_message_ids,ba);if(z)m.setResource(v,aa);}},unsubscribe:function(t,u,v){if(u){var w=m.getResource(u);if(w){if(v==l.MORE_SEARCH_CONTEXT_UP){w.up_message_ids.unsubscribe(t);}else w.down_message_ids.unsubscribe(t);}else m.unsubscribe(t);}}};function q(t,u,v){var w=t.getCurrentArraySize(),x=u.length<w+v;if(u.length){t.removeAllResources();t.addResourcesWithoutSorting(u,0);}if(x)t.setReachedEndOfArray();}function r(t,u){var v=t.up_message_ids.hasReachedEndOfArray(),w=t.up_message_ids.getAllResources();if(!v)w.pop();var x=t.down_message_ids.hasReachedEndOfArray(),y=t.down_message_ids.getAllResources();if(!x)y.pop();return {thread_id:t.thread_id,message_id:u,up_message_ids:w,up_exhausted:v,down_message_ids:y,down_exhausted:x};}function s(t){t.client=g.MercuryAPIArgsSource&&g.MercuryAPIArgsSource.WEBMESSENGER;j.trySend('/ajax/mercury/search_context.php',t);}j.registerEndpoints({'/ajax/mercury/search_context.php':{mode:j.IMMEDIATE,handler:p.handleUpdate}});e.exports=p;});
__d("MercurySearchSnippetResults",["MercuryConstants","RangedCallbackManager","MercuryServerDispatcher","MercuryServerRequests"],function(a,b,c,d,e,f){var g=b('MercuryConstants'),h=b('RangedCallbackManager'),i=b('MercuryServerDispatcher'),j=b('MercuryServerRequests'),k={},l=null,m=g.MercuryThreadlistConstants.WEBMESSENGER_SEARCH_SNIPPET_COUNT,n=g.MercuryThreadlistConstants.WEBMESSENGER_SEARCH_SNIPPET_LIMIT,o=g.MercuryThreadlistConstants.WEBMESSENGER_SEARCH_SNIPPET_MORE,p={getSearchSnippets:function(aa,ba){v(aa,n,0,ba);},countSnippetsMatchingQueryInThread:function(aa,ba,ca){var da=y(aa,ba);return da.num_total_snippets;},findIndexOfSnippet:function(aa,ba,ca,da){var ea=y(aa,ba),fa=ea.snippets.getAllResources();for(var ga=0;ga<fa.length;ga++)if(ca===fa[ga].message_id)return ga;},findSnippetAtIndex:function(aa,ba,ca,da){s(aa,ba,ca);u(aa,ba,ca,da);},getMoreSearchSnippets:function(aa,ba){var ca=x(aa),da=ca.getCurrentArraySize();v(aa,o,da,ba);},getMoreSearchSnippetsForThreadAfterIndex:function(aa,ba,ca,da){s(aa,ba,ca);var ea=y(aa,ba),fa=ea.snippets.getAllResources();if(ca<fa.length-1){var ga=ea.num_total_snippets-fa.length;da(fa,ga);return;}t(aa,ba,da);},handleUpdate:function(aa){if(aa.mercury_payload)j.handleUpdate(aa.mercury_payload);var ba=aa.search_snippets||{};Object.keys(ba).filter(function(qa){return !!ba[qa];}).forEach(function(qa){Object.keys(ba[qa]).forEach(function(ra){ba[qa][ra].snippets.forEach(function(sa){sa.matched_keywords=q(sa.matched_keywords);});});});for(var ca in ba){var da,ea,fa,ga=ba[ca]||{},ha=!!aa.thread_id,ia=[];for(var ja in ga){var ka=ga[ja],la=j.getClientThreadIDNow(ja),ma,na;if(!ha){na=new h();na.addResourcesWithoutSorting(ka.snippets,0);ma={num_total_snippets:ka.num_total_snippets,snippets:na};ia.push({thread_id:la,matched_thread:ma});}else{ma=y(ca,la);if(ma){na=ma.snippets;fa=aa.offset;da=na.getCurrentArraySize();if(fa==da)na.addResourcesWithoutSorting(ka.snippets,da);}}}if(!ha){var oa=x(ca);da=oa.getCurrentArraySize();fa=aa.offset;ea=aa.limit;if(fa==da){var pa=ia.length<ea;!pa&&ia.pop();oa.addResourcesWithoutSorting(ia,da);pa&&oa.setReachedEndOfArray();}}}}};function q(aa){if(aa instanceof Array){var ba={};for(var ca=0;ca<aa.length;ca++)ba[ca.toString()]=aa[ca];return ba;}else return aa;}function r(){if(l){if(l.thread_id){var aa=y(l.query,l.thread_id);if(aa)aa.snippets.unsubscribe(l.subscriber_id);}else{var ba=x(l.query);ba.unsubscribe(l.subscriber_id);}l=null;}}function s(aa,ba,ca){}function t(aa,ba,ca){if(aa){r();var da=y(aa,ba);if(da){var ea=da.snippets,fa=ea.getCurrentArraySize(),ga=da.num_total_snippets-fa;if(ga>0){var ha=ga>o?o:ga,ia=ea.executeOrEnqueue(0,fa+ha,function(la){var ma=da.num_total_snippets-ea.getCurrentArraySize();ca(la,ma);}),ja=ea.getUnavailableResources(ia);if(ja.length){l={query:aa,thread_id:ba,subscriber_id:ia};var ka=j.getServerThreadIDNow(ba);z({query:aa,thread_id:ka,snippetOffset:fa,snippetLimit:ha});}}}}}function u(aa,ba,ca,da){var ea=w(aa,ba);if(ca<ea.length){da(ea[ca].message_id);return;}t(aa,ba,function(fa,ga){u(aa,ba,ca,da);});}function v(aa,ba,ca,da){if(aa){r();var ea=x(aa),fa=ca+ba,ga=ea.executeOrEnqueue(0,fa,function(ia){var ja={};for(var ka=0;ka<ia.length;ka++){var la=ia[ka];ja[la.thread_id]={num_total_snippets:la.matched_thread.num_total_snippets,snippets:la.matched_thread.snippets.getAllResources()};}da(ja,ea.hasReachedEndOfArray());}),ha=ea.getUnavailableResources(ga);if(ha.length){l={query:aa,thread_id:null,subscriber_id:ga};z({query:aa,offset:ca,limit:ba+1,snippetLimit:m});}}}function w(aa,ba){var ca=y(aa,ba),da=ca.snippets;return da.getAllResources();}function x(aa){if(!k[aa])k[aa]=new h();return k[aa];}function y(aa,ba){var ca=x(aa);if(ca){var da=ca.getAllResources();for(var ea=0;ea<da.length;ea++)if(da[ea].thread_id==ba)return da[ea].matched_thread;}return null;}function z(aa){aa.client=g.MercuryAPIArgsSource&&g.MercuryAPIArgsSource.WEBMESSENGER;i.trySend('/ajax/mercury/search_snippets.php',aa);}i.registerEndpoints({'/ajax/mercury/search_snippets.php':{mode:i.IMMEDIATE,handler:p.handleUpdate}});e.exports=p;});
__d("WebMessengerDetailViewSearchContextControl",["event-extensions","CSS","DOM","MercuryMessages","WebMessengerMessagesSelection","MercurySearchContextResults","MercurySearchSnippetResults","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","WebMessengerThreadMessagesRenderer","WebMessengerConstants","WebMessengerSubscriptionsHandler","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('CSS'),h=b('DOM'),i=b('MercuryMessages'),j=b('WebMessengerMessagesSelection'),k=b('MercurySearchContextResults'),l=b('MercurySearchSnippetResults'),m=b('WebMessengerStateConstants'),n=b('WebMessengerStateManager'),o=b('WebMessengerTemplates'),p=b('WebMessengerThreadMessagesRenderer'),q=b('WebMessengerConstants'),r=b('WebMessengerSubscriptionsHandler'),s=b('copyProperties'),t=function(da,ea){this._manager=da;this._rootElement=ea;h.empty(this._rootElement);var fa=o[':fb:web-messenger:read-view:search-context'].build();h.setContent(this._rootElement,fa.getRoot());this._messagelistRoot=fa.getRoot();this._loadingSpinner=fa.getNode('loadingSpinner');this._messageList=fa.getNode('messagelist');this._loadMoreButton=fa.getNode('loadMoreButton');this._loadMoreLink=fa.getNode('loadMoreLink');this._downMoreButton=fa.getNode('downMoreButton');this._downMoreLink=fa.getNode('downMoreLink');this._snippetPaginationControlBox=fa.getNode('snippetPaginationControlBox');this._nextSnippet=fa.getNode('nextSnippet');this._previousSnippet=fa.getNode('previousSnippet');this._backToSnippetsButton=fa.getNode('backToSnippetsButton');this._snippetCountDescription=fa.getNode('snippetCountDescription');this._paginationBoxCloseButton=fa.getNode('paginationBoxCloseButton');this._state=null;this._threadID=null;this._messageID=null;r.addSubscriptions(Event.listen(this._messagelistRoot,'click',function(event){if(this._selectionEnabled){var ga=null,ha='webMessengerMessageGroup';for(var ia=event.getTarget();ia;ia=ia.parentNode)if(g.hasClass(ia,ha))ga=ia;ga&&j.selectClick(ga);}}.bind(this)),Event.listen(this._loadMoreLink,'click',function(){g.addClass(this._loadMoreButton,'async_saving');ba(this,q.MORE_SEARCH_CONTEXT_UP);}.bind(this)),Event.listen(this._downMoreLink,'click',function(){g.addClass(this._downMoreButton,'async_saving');ba(this,q.MORE_SEARCH_CONTEXT_DOWN);}.bind(this)),Event.listen(this._nextSnippet,'click',u.curry(this,1)),Event.listen(this._previousSnippet,'click',u.curry(this,-1)),Event.listen(this._backToSnippetsButton,'click',function(){var ga=n.getCurrentStateData(),ha=m.DETAIL.SEARCH_SNIPPET,ia={folder:ga.folder,message_query:ga.message_query,query:ga.query};n.updateDetailState(ha,ia);}),Event.listen(this._paginationBoxCloseButton,'click',function(){n.updateDetailState(m.DETAIL.RECENT_MESSAGES,{thread_id:n.getCurrentStateData().thread_id});}.bind(this)));};s(t.prototype,{hideView:function(){g.hide(this._rootElement);},updateView:function(){g.show(this._rootElement);var da=x(this);y(this);j.clear();if(da)aa(this);},destroy:function(){w(this);}});function u(da,ea){var fa=n.getCurrentStateData(),ga=l.findIndexOfSnippet(da._messageQuery,fa.thread_id,fa.message_id),ha=ga+ea;g.hide(da._messageList);g.hide(da._loadMoreButton);g.hide(da._downMoreButton);g.show(da._loadingSpinner);l.findSnippetAtIndex(da._messageQuery,fa.thread_id,ha,function(ia){g.show(da._messageList);v(fa,ia);});}function v(da,ea){var fa={folder:da.folder,message_id:ea,message_query:da.message_query,query:da.query,thread_id:da.thread_id};n.updateDetailState(n.getCurrentDetailState(),fa);}function w(da){da._searchContextSubscription&&k.unsubscribe(da._searchContextSubscription.subscriber_id,da._searchContextSubscription.message_id,da._searchContextSubscription.direction);da._searchThreadsSubscription=null;}function x(da){var ea=n.getCurrentStateData();if(da._threadID!=ea.thread_id)return true;if(da._messageQuery!=ea.message_query)return true;if(da._messageID!=ea.message_id)return true;return false;}function y(da){var ea=n.getCurrentStateData();da._state=n.getCurrentDetailState();da._threadID=ea.thread_id;da._messageQuery=ea.message_query;da._messageID=ea.message_id;da._selectionEnabled=!!ea.message_action;g.conditionClass(da._messageList,'selectionEnabled',da._selectionEnabled);g.conditionClass(da._messageList,'bugReportingEnabled',ea.bug_reporting_enabled);}function z(da,ea){h.setAttributes(da,{disabled:ea});var fa=h.find(da,'^label');g.conditionClass(fa,'uiButtonDisabled',ea);}function aa(da){var ea=h.create('strong',{},da._messageQuery),fa=l.countSnippetsMatchingQueryInThread(da._messageQuery,da._threadID),ga=l.findIndexOfSnippet(da._messageQuery,da._threadID,da._messageID),ha=ga+1,ia=h.tx._("{index} of {count} results for {query}",{index:ha,count:fa,query:ea});h.setContent(da._snippetCountDescription,ia);z(da._previousSnippet,ga===0);z(da._nextSnippet,ga===fa-1);h.empty(da._messageList);g.show(da._loadingSpinner);g.hide(da._loadMoreButton);g.hide(da._downMoreButton);w(da);if(da._threadID&&da._messageID){var ja=k.getSearchContext(da._messageID,da._threadID,function(ka){g.hide(da._loadingSpinner);ca(da,ka);});if(ja)da._searchContextSubscription={subscriber_id:ja,message_id:da._messageID};}}function ba(da,ea){w(da);if(da._threadID&&da._messageID){var fa=k.getMoreSearchContext(da._messageID,da._threadID,ea,function(ga){if(ea==q.MORE_SEARCH_CONTEXT_UP){g.removeClass(da._loadMoreButton,'async_saving');}else g.removeClass(da._downMoreButton,'async_saving');ca(da,ga);});if(fa)da._searchContextSubscription={subscriber_id:fa,message_id:da._messageID,direction:ea};}}function ca(da,ea){g.conditionShow(da._loadMoreButton,!ea.up_exhausted);g.conditionShow(da._downMoreButton,!ea.down_exhausted);var fa=ea.up_message_ids.concat([ea.message_id],ea.down_message_ids),ga=i.getMessagesFromIDs(fa);h.empty(da._messageList);var ha=p.calculateMessageGroups(ga);ha.forEach(function(ia,ja){var ka=p.renderMessageSeparatorForIndex(ha,ja);if(ka)h.appendContent(da._messageList,ka);var la=p.renderMessageGroupArray(ia,false,'context:').getRoot(),ma=ia.some(function(na){return na.message_id==ea.message_id;});if(ma)g.addClass(la,'selectedHighlight');h.appendContent(da._messageList,la);});}e.exports=t;});
__d("WebMessengerSearchSnippetsRenderer",["event-extensions","CSS","DOM","MercuryImageTemplates","MercuryMessageRenderer","MercuryParticipants","MercurySearchSnippetResults","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","MercuryThreadMetadataRenderer","cx","tx"],function(a,b,c,d,e,f){b('event-extensions');var g=b('CSS'),h=b('DOM'),i=b('MercuryImageTemplates'),j=b('MercuryMessageRenderer'),k=b('MercuryParticipants'),l=b('MercurySearchSnippetResults'),m=b('WebMessengerStateConstants'),n=b('WebMessengerStateManager'),o=b('WebMessengerTemplates'),p=b('MercuryThreadMetadataRenderer'),q=b('cx'),r=b('tx'),s={renderMultipleSnippetBlocks:function(w,x,y){y=y||{};var z=true;for(var aa in y){z=false;var ba=o[':fb:web-messenger:read-view:search-snippets-block'].build();h.appendContent(w,ba.getRoot());s.renderSingleSnippetBlock(ba,x,aa,y[aa]);}if(z){var ca="No results",da=h.create('div',{className:"_2n4"},ca);h.setContent(w,da);}},renderSingleSnippetBlock:function(w,x,y,z){var aa=w.getNode('searchThreadName'),ba=h.create('h3');h.setContent(aa,ba);p.renderAndSeparatedParticipantList(y,ba);var ca=w.getNode('snippetList'),da=z.snippets;s.renderMultipleSnippets(ca,x,y,da);var ea=w.getNode('moreSnippetsLink'),fa=z.num_total_snippets-da.length;t(w,z.num_total_snippets,fa);if(fa===0)return;var ga=da.length-1,ha=function(ia,ja){ga=ia.length-1;h.empty(ca);this.renderMultipleSnippets(ca,x,y,ia);t(w,z.num_total_snippets,ja);}.bind(this);Event.listen(ea,'click',function(){l.getMoreSearchSnippetsForThreadAfterIndex(x,y,ga,ha);return false;});},renderMultipleSnippets:function(w,x,y,z){(z||[]).forEach(function(aa){var ba=o[':fb:web-messenger:read-view:search-snippet'].build();h.appendContent(w,ba.getRoot());k.get(aa.author,function(ca){s.renderSingleSnippet(ba,x,y,aa,ca);});});},renderSingleSnippet:function(w,x,y,z,aa){w.setNodeProperty('bodyDiv','id','snippet:'+z.message_id);var ba=z.matched_keywords||undefined,ca=j.formatMessageBody(z.body,ba);w.setNodeContent('body',ca);var da=w.getNode('image');g.removeClass(da,'MercuryThreadImage');g.addClass(da,'MercuryMediumThreadImage');var ea=i[':fb:mercury:thread-image:single:medium'].render();ea.setAttribute('src',aa.image_src);if(aa.href)ea=h.create('a',{href:aa.href},ea);h.setContent(da,ea);var fa=aa.short_name;w.setNodeContent('shortName',h.tx._("{name}: ",{name:fa}));p.renderTimestamp(w.getNode('timestamp'),z.timestamp_absolute,z.timestamp_relative,z.timestamp);var ga=w.getNode('seeContext');Event.listen(ga,'click',function(){var ha=n.getCurrentStateData();n.updateDetailState(m.DETAIL.SEARCH_CONTEXT,{message_query:x,query:ha.query,thread_id:y,message_id:z.message_id});return false;});}};function t(w,x,y){var z=w.getNode('totalSnippetsCount'),aa=w.getNode('moreSnippetsLink');g.conditionShow(aa,y>0);if(y>0){var ba=v(y);h.setContent(aa,ba);}h.setContent(z,u(x));}function u(w){if(w==1){return "1 result in total";}else return r._("{count} results in total",{count:w});}function v(w){if(w==1){return "Show 1 more result";}else return r._("Show {count} more results",{count:w});}e.exports=s;});
__d("WebMessengerDetailViewSearchSnippetsControl",["event-extensions","CSS","DOM","MercurySearchSnippetResults","WebMessengerSearchSnippetsRenderer","WebMessengerStateManager","WebMessengerTemplates","WebMessengerSubscriptionsHandler","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('CSS'),h=b('DOM'),i=b('MercurySearchSnippetResults'),j=b('WebMessengerSearchSnippetsRenderer'),k=b('WebMessengerStateManager'),l=b('WebMessengerTemplates'),m=b('WebMessengerSubscriptionsHandler'),n=b('copyProperties'),o=function(t,u){this._manager=t;this._rootElement=u;h.empty(this._rootElement);var v=l[':fb:web-messenger:read-view:search-snippets'].build();h.setContent(this._rootElement,v.getRoot());this._loadingSpinner=v.getNode('loadingSpinner');this._messageList=v.getNode('messagelist');this._downMoreButton=v.getNode('downMoreButton');this._downMoreLink=v.getNode('downMoreLink');this._state=null;this._messageQuery=null;g.hide(this._downMoreButton);m.addSubscriptions(Event.listen(this._downMoreLink,'click',function(){g.addClass(this._downMoreButton,'async_saving');s(this);}.bind(this)));};n(o.prototype,{hideView:function(){g.hide(this._rootElement);},updateView:function(){g.show(this._rootElement);var t=p(this);q(this);if(t)r(this);},destroy:function(){}});function p(t){var u=k.getCurrentStateData();if(t._messageQuery!=u.message_query)return true;return false;}function q(t){var u=k.getCurrentStateData();t._messageQuery=u.message_query;}function r(t){g.hide(t._downMoreButton);h.empty(t._messageList);if(t._messageQuery){g.show(t._loadingSpinner);i.getSearchSnippets(t._messageQuery,function(u,v){g.hide(t._loadingSpinner);j.renderMultipleSnippetBlocks(t._messageList,t._messageQuery,u);g.conditionShow(t._downMoreButton,!v);});}}function s(t){if(t._messageQuery)i.getMoreSearchSnippets(t._messageQuery,function(u,v){g.removeClass(t._downMoreButton,'async_saving');h.empty(t._messageList);j.renderMultipleSnippetBlocks(t._messageList,t._messageQuery,u);g.conditionShow(t._downMoreButton,!v);});}e.exports=o;});
__d("Ellipsizer",["CSS","DOM","Style","UserAgent","cx"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DOM'),i=b('Style'),j=b('UserAgent'),k=b('cx'),l=1.3;function m(n){this.elements=[];n.forEach(function(o){g.addClass(o,"_6qy");this.elements.push({node:o});}.bind(this));return this;}m.prototype._analyzeElements=function(){var n;this.elements.forEach(function(o){n=o.node;while(n.children.length===1)n=n.children[0];if(n===o.node)i.set(n,'width','');j.ie()&&i.set(n,'position','absolute');o.width=n.offsetWidth;j.ie()&&i.set(n,'position','');});this.elements.sort(function(o,p){return o.width-p.width;});};m.prototype.confineWithin=function(n){this._analyzeElements();var o=n;this.elements.forEach(function(p,q){var r=Math.floor(o/(this.elements.length-q));if(p.width<=r||p.width<=0||r<=0||(p.width<=r*l&&o>=r*l)){g.removeClass(p.node,"_6s5");i.set(p.node,'width','');o-=p.width;if(p.titleSet){p.node.setAttribute('title','');p.titleSet=false;}}else{g.addClass(p.node,"_6s5");i.set(p.node,'width',r+'px');o-=r;if(!p.titleSet&&!p.node.getAttribute('title')){p.node.setAttribute('title',h.getText(p.node));p.titleSet=true;}}}.bind(this));};e.exports=m;});
__d("WebMessengerForwardedMessages",["event-extensions","CSS","DOM","MercuryMessages","WebMessengerThreadMessagesRenderer","WebMessengerEvents","WebMessengerSubscriptionsHandler","copyProperties","tx"],function(a,b,c,d,e,f){b('event-extensions');var g=b('CSS'),h=b('DOM'),i=b('MercuryMessages'),j=b('WebMessengerThreadMessagesRenderer'),k=b('WebMessengerEvents'),l=b('WebMessengerSubscriptionsHandler'),m=b('copyProperties'),n=b('tx');function o(p,q,r,s){this._parent=p;this._title=q;this._shelf=r;this._closeButton=s;this._forwardedMessages=[];l.addSubscriptions(Event.listen(this._closeButton,'click',this.clear.bind(this)));}m(o.prototype,{setForwardedMessages:function(p){this._forwardedMessages=p;this._render();},clear:function(){this._forwardedMessages=[];this._render();},getForwardedMessages:function(){return this._forwardedMessages||[];},_render:function(){h.empty(this._shelf);var p=this._forwardedMessages.length;if(p){var q=(p===1)?"1 forwarded message":n._("{num} forwarded messages",{num:p});h.setContent(this._title,q);j.renderForwardedMessages(this._shelf,i.getMessagesFromIDs(this._forwardedMessages));}g.conditionShow(this._parent,p);k.detailDOMChanged();}});e.exports=o;});
__d("WebMessengerDetailViewBottomShelfControl",["event-extensions","Arbiter","AsyncDialog","AsyncRequest","Button","MercuryConstants","CSS","DOM","Ellipsizer","MercuryFolders","Input","Keys","Locale","MercuryConfig","MercuryFileUploader","MercuryPhotoUploader","MercuryShareLinkUploader","MercuryMessages","MessagesEmoticonView","PageTransitions","WebMessengerPermalinks","WebMessengerPreferences","Run","WebMessengerStateConstants","WebMessengerStateManager","Style","WebMessengerTemplates","TextAreaControl","MercuryThreadInformer","MercuryThreads","VaultBoxURI","Vector","WebMessengerEvents","WebMessengerForwardedMessages","WebMessengerSubscriptionsHandler","copyProperties","csx","tx"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('AsyncDialog'),i=b('AsyncRequest'),j=b('Button'),k=b('MercuryConstants'),l=b('CSS'),m=b('DOM'),n=b('Ellipsizer'),o=b('MercuryFolders'),p=b('Input'),q=b('Keys'),r=b('Locale'),s=b('MercuryConfig'),t=b('MercuryFileUploader'),u=b('MercuryPhotoUploader'),v=b('MercuryShareLinkUploader'),w=b('MercuryMessages'),x=b('MessagesEmoticonView'),y=b('PageTransitions'),z=b('WebMessengerPermalinks'),aa=b('WebMessengerPreferences'),ba=b('Run'),ca=b('WebMessengerStateConstants'),da=b('WebMessengerStateManager'),ea=b('Style'),fa=b('WebMessengerTemplates'),ga=b('TextAreaControl'),ha=b('MercuryThreadInformer'),ia=b('MercuryThreads').get(),ja=b('VaultBoxURI'),ka=b('Vector'),la=b('WebMessengerEvents'),ma=b('WebMessengerForwardedMessages'),na=b('WebMessengerSubscriptionsHandler'),oa=b('copyProperties'),pa=b('csx'),qa=b('csx'),ra=b('tx'),sa="_1rh";function ta(tb,ub){this._manager=tb;this._rootElement=ub;this._sendOnEnterDefault=aa.sendOnEnter;m.empty(this._rootElement);var vb=fa[':fb:web-messenger:read-view:bottom-shelf'].build();m.setContent(this._rootElement,vb.getRoot());this._bottomShelfToolbar=vb.getNode('toolbar');this._bottomShelfComposer=vb.getNode('composer');this._bottomShelfButtons=vb.getNode('buttons');this._autogrowContainer=vb.getNode('autogrowContainer');this._composerBox=vb.getNode('composerTextarea');this._composerGrid=vb.getNode('composerGrid');this._sendContainer=vb.getNode('sendContainer');this._replyButton=vb.getNode('replyButton');this._uploadingWarning=vb.getNode('uploadingWarning');this._replyButtonLabel=m.find(this._sendContainer,"._1ri");this._sendOnEnterButton=vb.getNode('sendOnEnterButton');this._loadingIndicator=vb.getNode('loadingIndicator');this._cannotReplyAlert=vb.getNode('noReplyMessage');this._ariaOwns=this._composerBox.getAttribute('aria-owns');na.addSubscriptions(Event.listen(this._autogrowContainer,'click',this.focusComposer.bind(this)),la.subscribe(la.UPDATE_SELECTION,sb.curry(this)),la.subscribe(la.FOCUS_COMPOSER,this.focusComposer.bind(this)));this._emoteWrapper=vb.getNode('emoteWrapper');this._emoticonsPanel=new x(vb.getNode('emoticons'),this._composerBox);this._messageSent=false;this._fileUploader=new t(vb.getNode('attachmentShelf'),vb.getNode('attachButtonForm'),vb.getNode('fileInput'),vb.getNode('attachID'));this._forwardedMessages=new ma(vb.getNode('forwardedMessages'),vb.getNode('forwardedMessagesTitle'),vb.getNode('forwardedMessagesShelf'),vb.getNode('forwardedMessagesCloseButton'));this._shareLinkUploader=new v(vb.getNode('shareStage'),vb.getNode('shareStageContent'),vb.getNode('shareStageLoadingIndicator'),vb.getNode('shareStageCloseButton'),this._composerBox);d(['TypingIndicator'],function(xb){this._typingIndicator=new xb(null,this._composerBox,'web-messenger',null,null);rb(this);}.bind(this));if(this._composerGrid){this._photoUploader=new u(this._composerGrid,vb.getNode('photoButton'),na,vb.getNode('composer'));na.addSubscriptions(this._photoUploader.subscribe('dom-updated',la.detailDOMChanged.bind(la)));}var wb=m.scry(this._bottomShelfToolbar,"._6q-");wb.push(vb.getNode('sendOnEnterButtonLabel'));this._ellipsizer=new n(wb);na.addSubscriptions(this._fileUploader.subscribe('all-uploads-completed',function(){if(this._blockedOnUpload){gb(this,false);eb(this);}}.bind(this)),this._fileUploader.subscribe('upload-canceled',gb.curry(this,false)),this._fileUploader.subscribe('dom-updated',la.detailDOMChanged.bind(la)));if(this._photoUploader)na.addSubscriptions(this._photoUploader.subscribe('all-uploads-completed',function(){if(this._blockedOnUpload){gb(this,false);eb(this);}}.bind(this)));this._confirmationSubscription=da.registerConfirmationBeforeStateUpdate(function(xb,yb,zb){if(nb(this)&&ua(this,yb,zb)){this._stateUpdateConfirmed=true;return "You haven't sent your message.";}return false;}.bind(this));ob(this);na.addSubscriptions(g.subscribe('page_transition',function(xb,yb){if(z.isWebMessengerURI(yb.uri))ob(this);}.bind(this)),this._shareLinkUploader.subscribe('link-detected',la.detailDOMChanged.bind(la)),this._shareLinkUploader.subscribe('closed',this.focusComposer.bind(this)));ga.getInstance(this._composerBox).subscribe('resize',function(){la.detailDOMChanged();}.bind(this));qb(this);na.addSubscriptions(Event.listen(this._replyButtonLabel,'click',eb.curry(this)),Event.listen(this._replyButton,'keydown',wa.curry(this)),Event.listen(this._composerBox,'keydown',wa.curry(this)),Event.listen(this._sendOnEnterButton,'click',ya.curry(this)),Event.listen(vb.getNode('cancelButton'),'click',hb),Event.listen(vb.getNode('deleteButton'),'click',ib.curry(this)),Event.listen(vb.getNode('forwardButton'),'click',mb.curry(this)),Event.listen(vb.getNode('reportSpamButton'),'click',kb.curry(this)),la.subscribe(la.DETAIL_DOM_CHANGED,xa.curry(this)));na.addSubscriptions(ha.subscribe('threads-updated',function(xb,yb){yb[this._threadID]&&this.updateView();}.bind(this)));}oa(ta.prototype,{hideView:function(){l.hide(this._rootElement);},updateView:function(){var tb=da.getCurrentDetailState();l.show(this._rootElement);var ub=da.getCurrentStateData();ua(this,tb,ub)&&fb(this);l.hide(this._bottomShelfComposer);l.removeClass(this._bottomShelfComposer,'invisible_elem');l.hide(this._bottomShelfButtons);l.show(this._sendOnEnterButton);l.hide(this._cannotReplyAlert);ab(this,this._sendOnEnterDefault);switch(tb){case ca.DETAIL.RECENT_MESSAGES:case ca.DETAIL.SEARCH_CONTEXT:this._threadID=ub.thread_id;if(ub.message_action==ca.MESSAGE_ACTION.DELETE||ub.message_action==ca.MESSAGE_ACTION.FORWARD||ub.message_action==ca.MESSAGE_ACTION.REPORT_SPAM){pb(this,ub.message_action);}else if(this._threadID)ia.getThreadMeta(this._threadID,function(vb){if(ia.canReply(this._threadID)){l.show(this._bottomShelfComposer);qb(this);}else l.show(this._cannotReplyAlert);va(this,vb);}.bind(this));break;case ca.DETAIL.COMPOSE_MAIN:this._threadID=null;l.show(this._bottomShelfComposer);qb(this);l.hide(this._sendOnEnterButton);ab(this,false);va(this,null);break;default:this._threadID=null;break;}rb(this);la.detailDOMChanged();this._state=tb;},focusComposer:function(){this._composerBox.focus();},submitReply:function(){eb(this);},destroy:function(){this._emoticonsPanel&&this._emoticonsPanel.destroy();this._fileUploader.destroy();da.unregisterConfirmationBeforeStateUpdate(this._confirmationSubscription);}});function ua(tb,ub,vb){switch(ub){case ca.DETAIL.RECENT_MESSAGES:case ca.DETAIL.SEARCH_CONTEXT:return !vb.reuse_composer&&(tb._threadID!=vb.thread_id||tb._state!=ub);case ca.DETAIL.COMPOSE_MAIN:return vb.start;case ca.DETAIL.SEARCH_SNIPPET:return true;}return false;}function va(tb,ub){var vb,wb;if(!ub){vb="Send";wb="Write a message...";}else if(ub.participants&&ub.participants.length<=2){vb="Reply";wb="Write a reply...";}else{vb="Reply All";wb="Write a reply...";}if(tb._composerBox.getAttribute('placeholder')!=wb)p.setPlaceholder(tb._composerBox,wb);j.setLabel(tb._replyButton,vb);db(tb);}function wa(tb,event){if(event.getModifiers().any)return;var ub=false;switch(event.keyCode){case q.SPACE:ub=event.getTarget()===tb._replyButton;break;case q.RETURN:var vb=!l.hasClass(tb._bottomShelfComposer,sa),wb=event.getTarget()===tb._replyButton;ub=wb||vb;break;case q.UP:case q.DOWN:var xb=da.getCurrentDetailState();if(tb._composerBox.value||xb!=ca.DETAIL.RECENT_MESSAGES)event.stop();break;}if(ub){eb(tb);tb.focusComposer();return false;}}function xa(tb){qb(tb);bb(tb);}function ya(tb){za(tb);var ub=!tb._sendOnEnterDefault;tb.focusComposer();tb._sendOnEnterDefault=ub;aa.sendOnEnter=ub;var vb={action:'setPreferences',send_on_enter:ub};new i('/ajax/messaging/async.php').setData(vb).send();}function za(tb){l.toggleClass(tb._bottomShelfComposer,sa);db(tb,true);la.detailDOMChanged();}function ab(tb,ub){if(ub==l.hasClass(tb._bottomShelfComposer,sa))za(tb);}function bb(tb){var ub;if(l.hasClass(tb._bottomShelfComposer,sa)){ub=cb(tb);}else ub=0;var vb=ka.getElementDimensions(tb._bottomShelfToolbar).x;tb._ellipsizer.confineWithin(vb-ub-102);}function cb(tb){return ka.getElementDimensions(tb._replyButtonLabel).x+20;}function db(tb,ub){var vb='',wb='';if(!l.hasClass(tb._bottomShelfComposer,sa)){wb=cb(tb)+'px';vb='-1';}l.conditionClass(tb._sendContainer,'transition',ub);tb._replyButton.setAttribute('tabindex',vb);ea.set(tb._sendContainer,r.isRTL()?'right':'left',wb);}function eb(tb){if(tb._fileUploader.isUploading()){gb(tb,true);return;}var ub=da.getCurrentStateData(),vb=w.constructUserGeneratedMessageObject(p.getValue(tb._composerBox),k.MercurySourceType.TITAN_WEB,ub.thread_id,ub.participants),wb=tb._fileUploader.getAttachments();if(wb&&wb.length){vb.has_attachment=true;vb.raw_attachments=wb;}if(tb._photoUploader&&tb._photoUploader.getSelectedFBIDs().length){vb.has_attachment=true;vb.photo_fbids=tb._photoUploader.getSelectedFBIDs();}if(tb._shareLinkUploader.getAttachData()){vb.has_attachment=true;vb.content_attachment=tb._shareLinkUploader.getAttachData();}vb.forward_message_ids=tb._forwardedMessages.getForwardedMessages();vb.forward_count=vb.forward_message_ids.length;var xb=p.isEmpty(tb._composerBox);if((xb&&!vb.has_attachment&&!vb.forward_count)||(!vb.thread_id&&!vb.specific_to_list.length))return;vb.force_sms=true;l.show(tb._loadingIndicator);l.hide(tb._replyButtonLabel);tb._composerBox.setAttribute('disabled','disabled');tb._sendSubscription=w.sendMessage(vb,function(yb){fb(tb);tb._messageSent=true;var zb=o.getFromMeta(ia.getThreadMetaNow(yb));da.updateDetailState(ca.DETAIL.RECENT_MESSAGES,{thread_id:yb,folder:zb});tb._messageSent=false;},k.MercuryAPIArgsSource&&k.MercuryAPIArgsSource.WEBMESSENGER);}function fb(tb){p.reset(tb._composerBox);qb(tb);tb._typingIndicator&&tb._typingIndicator.resetState();tb._fileUploader.removeAttachments();tb._forwardedMessages.clear();tb._shareLinkUploader.clear();if(tb._photoUploader&&tb._photoUploader.getSelectedFBIDs().length)tb._photoUploader.clear();l.hide(tb._loadingIndicator);l.show(tb._replyButtonLabel);tb._composerBox.removeAttribute('disabled');if(tb._sendSubscription){w.unsubscribeSend(tb._sendSubscription);tb._sendSubscription=null;}gb(tb,false);}function gb(tb,ub){l.conditionShow(tb._uploadingWarning,ub);tb._blockedOnUpload=ub;}function hb(){var tb=da.getCurrentDetailState(),ub=da.getCurrentStateData();delete ub.message_action;da.updateDetailState(tb,ub);}function ib(tb){var ub=tb._manager.getSelectedMessageIDs().length;h.send(new i('/ajax/mercury/delete_messages_dialog.php').setData({count:ub}),function(vb){vb.subscribe('confirm',jb.curry(tb,vb));});}function jb(tb,ub){var vb=tb._manager.getSelectedMessageIDs();w.deleteMessages(tb._threadID,vb);ub.hide();var wb=da.getCurrentStateData();if(wb.message_action){var xb=oa({},wb);delete xb.message_action;da.updateDetailState(da.getCurrentDetailState(),xb);}}function kb(tb){var ub=tb._manager.getSelectedMessageIDs().length;h.send(new i('/ajax/mercury/mark_spam_messages_dialog.php').setData({count:ub}),function(vb){vb.subscribe('confirm',lb.curry(tb,vb));});}function lb(tb,ub){var vb=tb._manager.getSelectedMessageIDs();w.markMessagesSpam(tb._threadID,vb);ub.hide();var wb=da.getCurrentStateData();if(wb.message_action){var xb=oa({},wb);delete xb.message_action;da.updateDetailState(da.getCurrentDetailState(),xb);}}function mb(tb){var ub=tb._manager.getSelectedMessageIDs();if(ub.length){da.updateDetailState(ca.DETAIL.COMPOSE_MAIN,{start:true});tb._forwardedMessages.setForwardedMessages(ub);}}function nb(tb){if(tb._messageSent)return false;if(!p.isEmpty(tb._composerBox))return true;var ub=tb._fileUploader.getAttachments();if((ub&&ub.length)||tb._shareLinkUploader.getAttachData()||(tb._photoUploader&&tb._photoUploader.getSelectedFBIDs().length))return true;var vb=da.getCurrentStateData(),wb=da.getCurrentDetailState(),xb=wb==ca.DETAIL.COMPOSE_MAIN||wb==ca.DETAIL.COMPOSE_TYPEAHEAD_RESULTS||wb==ca.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS;if(xb&&!vb.start&&(vb.participants||[]).length)return true;if(tb._forwardedMessages.getForwardedMessages().length)return true;return false;}function ob(tb){ba.onBeforeUnload(function(){if(tb._stateUpdateConfirmed){tb._stateUpdateConfirmed=false;return;}var ub=y.getNextURI(),vb=z.processURI(ub),wb=!vb||ua(tb,vb.detail_state,vb.data);if(!ub.getQueryData().hasOwnProperty('theater')&&!ja.isVaultBoxURI(ub)&&nb(tb)&&wb)return "You haven't sent your message.";},true);}function pb(tb,ub){l.show(tb._bottomShelfComposer);l.addClass(tb._bottomShelfComposer,'invisible_elem');l.conditionClass(tb._bottomShelfButtons,'delete',ub==ca.MESSAGE_ACTION.DELETE);l.conditionClass(tb._bottomShelfButtons,'forward',ub==ca.MESSAGE_ACTION.FORWARD);l.conditionClass(tb._bottomShelfButtons,'report_spam',ub==ca.MESSAGE_ACTION.REPORT_SPAM);l.show(tb._bottomShelfButtons);}function qb(tb){ea.set(tb._emoteWrapper,r.isRTL()?'right':'left',(tb._composerBox.clientWidth+22)+'px');}function rb(tb){if(tb._typingIndicator){var ub=tb._threadID,vb=null;if(ub){vb=ia.getCanonicalUserInThread(ub);var wb=s.chat_multi_typ_send,xb=ia.getThreadMetaNow(ub);if((!wb||!xb||xb.is_canonical)&&!vb)ub=null;}tb._typingIndicator.setUserAndThread(vb,ub);}}function sb(tb,ub,vb){if(m.contains(tb._ariaOwns,vb))tb._composerBox.setAttribute('aria-activedescendant',vb);}e.exports=ta;});
__d("WebMessengerThreadIsMutedTabSheet",["event-extensions","ArbiterMixin","DOM","WebMessengerTemplates","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('ArbiterMixin'),h=b('DOM'),i=b('WebMessengerTemplates'),j=b('copyProperties');function k(l,m){this._rootElement=l;this._sheetView=m;}j(k.prototype,g,{render:function(){var l=i[':fb:web-messenger:read-view:message-mute-sheet'].build();h.setContent(l.getNode('text'),h.tx._("Conversation is muted."));h.setContent(this._rootElement,l.getRoot());Event.listen(l.getNode('unmuteButton'),'click',function(){this.inform('clicked',null);}.bind(this));},isPermanent:function(){return false;},getType:function(){return 'wb-thread-is-muted';},open:function(){this._sheetView.open(this);},close:function(){this._sheetView.close(this);}});e.exports=k;});
__d("WebMessengerDetailViewSheetControl",["MercuryConfig","copyProperties","DOM","WebMessengerStateManager","MercurySheetView","WebMessengerTemplates","MercuryThreadInformer","MercuryThreadMuter","MercuryThreads","WebMessengerThreadIsMutedTabSheet","WebMessengerSubscriptionsHandler"],function(a,b,c,d,e,f){var g=b('MercuryConfig'),h=b('copyProperties'),i=b('DOM'),j=b('WebMessengerStateManager'),k=b('MercurySheetView'),l=b('WebMessengerTemplates'),m=b('MercuryThreadInformer'),n=b('MercuryThreadMuter'),o=b('MercuryThreads').get(),p=b('WebMessengerThreadIsMutedTabSheet'),q=b('WebMessengerSubscriptionsHandler'),r=function(s){this._template=l[':fb:web-messenger:tab-sheet-container'].build();this._rootElement=this._template.getNode('sheet');this._threadID=j.getCurrentStateData().thread_id;this._sheetView=new k(this._threadID,this._rootElement,s);this._threadIsMutedTabSheet=new p(this._rootElement,this._sheetView);this._muteSetting=undefined;i.setContent(s,this._template.getRoot());this._threadIsMutedClickSub=this._threadIsMutedTabSheet.subscribe('clicked',function(){n.showMuteChangeDialog(0,this._threadID);}.bind(this));q.addSubscriptions(m.subscribe('threads-updated',function(t,u){if(this._threadID&&u[this._threadID])this.updateTabSheet(false);}.bind(this)));this.updateTabSheet(true);};h(r.prototype,{updateView:function(){var s=j.getCurrentStateData().thread_id;if(this._threadID!=s){this._threadID=s;this.updateTabSheet(true);}},updateTabSheet:function(s){if(!this._threadID||!g.MuteThreadsOnDesktopGK)return;o.getThreadMeta(this._threadID,function(t){var u=n.getThreadMuteSettingForUser(t);if(u!=this._muteSetting||s){if(u){this._threadIsMutedTabSheet.open();}else this._threadIsMutedTabSheet.close();this._muteSetting=u;}}.bind(this));},destroy:function(){this._threadIsMutedClickSub&&this._threadIsMutedClickSub.unsubscribe();}});e.exports=r;});
__d("WebMessengerDetailViewControlManager",["event-extensions","ArbiterMixin","CSS","WebMessengerDetailViewHeaderControl","DOM","WebMessengerFlexibleScrollArea","copyProperties","WebMessengerDetailViewActionsMenuControl","WebMessengerDetailViewAllPeopleResultsControl","WebMessengerDetailViewComposeTypeaheadControl","WebMessengerDetailViewRecentMessagesControl","WebMessengerDetailViewSearchContextControl","WebMessengerDetailViewSearchSnippetsControl","WebMessengerDetailViewBottomShelfControl","WebMessengerMessagesSelection","Parent","WebMessengerDetailViewSheetControl","WebMessengerStateManager","WebMessengerStateConstants","Style","UserAgent","WebMessengerEvents","WebMessengerSubscriptionsHandler","WebMessengerTemplates"],function(a,b,c,d,e,f){b('event-extensions');var g=b('ArbiterMixin'),h=b('CSS'),i=b('WebMessengerDetailViewHeaderControl'),j=b('DOM'),k=b('WebMessengerFlexibleScrollArea'),l=b('copyProperties'),m=b('WebMessengerDetailViewActionsMenuControl'),n=b('WebMessengerDetailViewAllPeopleResultsControl'),o=b('WebMessengerDetailViewComposeTypeaheadControl'),p=b('WebMessengerDetailViewRecentMessagesControl'),q=b('WebMessengerDetailViewSearchContextControl'),r=b('WebMessengerDetailViewSearchSnippetsControl'),s=b('WebMessengerDetailViewBottomShelfControl'),t=b('WebMessengerMessagesSelection'),u=b('Parent'),v=b('WebMessengerDetailViewSheetControl'),w=b('WebMessengerStateManager'),x=b('WebMessengerStateConstants'),y=b('Style'),z=b('UserAgent'),aa=b('WebMessengerEvents'),ba=b('WebMessengerSubscriptionsHandler'),ca=b('WebMessengerTemplates'),da=function(ea){this._rootElement=ea;j.empty(this._rootElement);var fa=ca[':fb:web-messenger:read-view'].build();j.setContent(this._rootElement,fa.getRoot());this._readContainer=fa.getNode('readContainer');this._headerControl=new i(fa.getNode('detailViewHeader'));this._actionsMenuControl=new m(fa.getNode('detailViewActionsMenu'));this._allPeopleResultsControl=new n(fa.getNode('detailViewAllPeopleResults'));this._composeTypeaheadControl=new o(fa.getNode('detailViewComposeTypeahead'),fa.getNode('detailViewComposeTypeaheadResults'));this._searchContextControl=new q(this,fa.getNode('detailViewSearchContext'));this._searchSnippetsControl=new r(this,fa.getNode('detailViewSearchSnippets'));this._sheetControl=new v(fa.getNode('detailViewSheetTab'));var ga=fa.getNode('detailViewBottomShelf');this._bottomShelfControl=new s(this,ga);this._detailViewScroller=fa.getNode('readMessagesScroller');ba.addSubscriptions(Event.listen(this._detailViewScroller,'click',function(ia){if(u.byTag(ia.getTarget(),'a')||j.getSelection())return;this._bottomShelfControl.focusComposer();}.bind(this)));var ha={fade:!!z.osx(),persistent:true};this._flexArea=new k(this._detailViewScroller,ha).setBottomAligned(false).setInfiniteScrollHandler(this.inform.bind(this,'scrolledNearTop'),true).setContainer(this._rootElement).setMinFlexAreaHeight(200).draw();ba.addSubscriptions(aa.subscribe(aa.DETAIL_DOM_CHANGED,this._flexArea.draw.bind(this._flexArea)),aa.subscribe(aa.SUBMIT_REPLY,this._bottomShelfControl.submitReply.bind(this._bottomShelfControl)),w.subscribe(x.STATE_CHANGE_EVENT,this.updateOnStateChange.bind(this)));this._recentMessagesControl=new p(this,fa.getNode('detailViewRecentMessages'),fa.getNode('loadingSpinner'),fa.getNode('noSelectedConversation'),fa.getNode('newMessageLink'),fa.getNode('showUnreadLink'),ga);this._stateData={};this._resizeNodes=[this._rootElement,this._detailViewScroller,j.find(this._detailViewScroller,'div.uiScrollableAreaBody')];};l(da.prototype,g,{updateOnStateChange:function(){var ea=w.getCurrentDetailState(),fa=this._stateData;this._stateData=w.getCurrentStateData();this._flexArea.setTabbable(ea!==x.DETAIL.COMPOSE_MAIN);this._allPeopleResultsControl.hideView();this._composeTypeaheadControl.hideView();this._recentMessagesControl.hideView();this._searchContextControl.hideView();this._searchSnippetsControl.hideView();h.removeClass(this._readContainer,'blankComposeState');h.conditionClass(this._readContainer,'blankComposeState',ea===x.DETAIL.COMPOSE_MAIN);this._bottomShelfControl.updateView();this._actionsMenuControl.updateView();this._headerControl.updateView();switch(ea){case x.DETAIL.RECENT_MESSAGES:this._recentMessagesControl.updateView();this._sheetControl.updateView();break;case x.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS:this._allPeopleResultsControl.updateView();case x.DETAIL.COMPOSE_MAIN:case x.DETAIL.COMPOSE_TYPEAHEAD_RESULTS:this._composeTypeaheadControl.updateView();break;case x.DETAIL.SEARCH_SNIPPET:this._searchSnippetsControl.updateView();break;case x.DETAIL.SEARCH_CONTEXT:this._searchContextControl.updateView();break;}switch(ea){case x.DETAIL.RECENT_MESSAGES:case x.DETAIL.SEARCH_CONTEXT:if(fa.thread_id!=this._stateData.thread_id)this._bottomShelfControl.focusComposer();break;}},hideAll:function(){this._headerControl.hideView();this._actionsMenuControl.hideView();this._allPeopleResultsControl.hideView();this._composeTypeaheadControl.hideView();this._recentMessagesControl.hideView();this._searchContextControl.hideView();this._searchSnippetsControl.hideView();this._bottomShelfControl.hideView();},getSelectedMessageIDs:function(){var ea=w.getCurrentDetailState();switch(ea){case x.DETAIL.RECENT_MESSAGES:case x.DETAIL.SEARCH_CONTEXT:return t.getSelectedMessageIDs();}return [];},scrollIntoView:function(ea){this._flexArea&&this._flexArea.scrollIntoView(ea);},setScrollTop:function(ea,fa){this._flexArea&&this._flexArea.setScrollTop(ea,fa);},isScrolledToBottom:function(){return this._flexArea&&this._flexArea.isScrolledToBottom();},scrollToBottom:function(ea){this._flexArea&&this._flexArea.scrollToBottom(ea);},draw:function(){this._flexArea&&this._flexArea.draw();},poke:function(){this._flexArea&&this._flexArea.poke();},setScrollCallback:function(ea){this._flexArea&&this._flexArea.setScrollCallback(ea);},resizeTo:function(ea){this._resizeNodes.forEach(function(fa){y.set(fa,'width',ea+'px');});aa.detailDOMChanged();},destroy:function(){this._headerControl.destroy();this._actionsMenuControl.destroy();this._allPeopleResultsControl.destroy();this._composeTypeaheadControl.destroy();this._recentMessagesControl.destroy();this._searchContextControl.destroy();this._searchSnippetsControl.destroy();this._bottomShelfControl.destroy();this._flexArea.destroy();this._sheetControl.destroy();}});e.exports=da;});
__d("WebMessengerAuxMenu",["event-extensions","copyProperties","MenuXSelectable","MenuXSelectableItem","PopoverMenuOverlappingBorder","Popover","PopoverMenu"],function(a,b,c,d,e,f){b('event-extensions');var g=b('copyProperties'),h=b('MenuXSelectable'),i=b('MenuXSelectableItem'),j=b('PopoverMenuOverlappingBorder'),k=b('Popover'),l=b('PopoverMenu');function m(n,o){this._menu=new h(null,o,[],{});var p=new k(n.parentNode,n,null,{alignh:'right'});new l(p,n,this._menu,[j]);}g(m.prototype,{addOption:function(n,o){var p=new i({markup:n,title:''});p.setOnClickHandler(o);this._menu.addItem(p);return p;},destroy:function(){}});e.exports=m;});
__d("MessagingFilteringNux",["Arbiter","AsyncRequest","LayerDestroyOnHide","LayerHideOnTransition","MercuryConfig","WebMessengerPermalinks"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('LayerDestroyOnHide'),j=b('LayerHideOnTransition'),k=b('MercuryConfig'),l=b('WebMessengerPermalinks'),m=null,n,o={ACCEPTED_EVENT:'filtering/accepted',DIALOG_REGISTERED_EVENT:'filtering/dialog-registered',tryShow:function(p){g.subscribe(o.DIALOG_REGISTERED_EVENT,function(){if(!m)return;m.setContext(p);m.show();m=null;},g.SUBSCRIBE_ALL);},registerDialog:function(p){m=p.disableBehavior(i).disableBehavior(j);n=g.subscribe('page_transition',function(q,r){if(!l.isWebMessengerURI(r.uri)){p&&p.destroy();n.unsubscribe();}},g.SUBSCRIBE_NEW);if(p)p.subscribe('confirm',function(){k.filtering_active=true;new h('/ajax/web_messenger/dismiss_filtering_nux.php').send();p.hide();g.inform(o.ACCEPTED_EVENT,{});});g.inform(o.DIALOG_REGISTERED_EVENT,{},g.BEHAVIOR_PERSISTENT);}};e.exports=o;});
__d("WebMessengerTabbedFolderControl",["event-extensions","CSS","DOM","WebMessengerTemplates","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('CSS'),h=b('DOM'),i=b('WebMessengerTemplates'),j=b('copyProperties');function k(l,m,n){this._template=i[':fb:web-messenger:master-view:tab-bar:folder'].build();this._template.setNodeContent('folderLabel',l);this._listener=Event.listen(this._template.getNode('link'),'click',n);m.push(this._template.getRoot());}j(k.prototype,{getCountBadge:function(){return this._template.getNode('count');},setSelected:function(l){g.conditionClass(this._template.getRoot(),'selectedFolder',l);},getElement:function(){this._template.getRoot();},destroy:function(){this._listener.remove();}});e.exports=k;});
__d("WebMessengerEditFilteringSettingDialog",["event-extensions","AsyncDialog","AsyncRequest","MercuryConstants","DOM","csx"],function(a,b,c,d,e,f){b('event-extensions');var g=b('AsyncDialog'),h=b('AsyncRequest'),i=b('MercuryConstants'),j=b('DOM'),k=b('csx'),l='/ajax/mercury/edit_filtering_type.php',m='/ajax/mercury/change_filtering_type.php',n={show:function(){var o=function(q){var r=q.getRoot(),s=j.find(r,"._cq6").checked,t=j.find(r,"._cq7").checked,u='';if(s){u=i.MessagingFilteringType.MODERATE;}else if(t)u=i.MessagingFilteringType.STRICT;new h(m).setData({filtering_type:u}).send();q.hide();},p=function(q){q.subscribe('confirm',o.curry(q));q.show();};g.send(new h(l),p);}};e.exports=n;});
__d("WebMessengerMasterViewTabBarControl",["JSXDOM","event-extensions","Arbiter","MercuryConstants","CSS","DOM","Ellipsizer","JSLogger","WebMessengerMenuFolderControl","MercuryConfig","MercuryFilters","MercuryFolders","MessagingFilteringNux","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTabbedFolderControl","WebMessengerTemplates","MercuryThreadInformer","MercuryUnreadState","WebMessengerEditFilteringSettingDialog","WebMessengerEvents","WebMessengerSubscriptionsHandler","copyProperties","csx","tx"],function(a,b,c,d,e,f){var g=b('JSXDOM');b('event-extensions');var h=b('Arbiter'),i=b('MercuryConstants'),j=b('CSS'),k=b('DOM'),l=b('Ellipsizer'),m=b('JSLogger'),n=b('WebMessengerMenuFolderControl'),o=b('MercuryConfig'),p=b('MercuryFilters'),q=b('MercuryFolders'),r=b('MessagingFilteringNux'),s=b('WebMessengerStateConstants'),t=b('WebMessengerStateManager'),u=b('WebMessengerTabbedFolderControl'),v=b('WebMessengerTemplates'),w=b('MercuryThreadInformer'),x=b('MercuryUnreadState'),y=b('WebMessengerEditFilteringSettingDialog'),z=b('WebMessengerEvents'),aa=b('WebMessengerSubscriptionsHandler'),ba=b('copyProperties'),ca=b('csx'),da=b('tx'),ea=m.create('web_messenger_folders'),fa=function(ma,na,oa){this._manager=ma;this._rootElement=na;this._rootTopContentElement=oa;k.empty(this._rootElement);var pa=v[':fb:web-messenger:master-view:tab-bar'].build(),qa=v[':fb:web-messenger:master-view:top-content'].build();k.setContent(this._rootElement,pa.getRoot());k.setContent(this._rootTopContentElement,qa.getRoot());this._tabList=pa.getRoot();this._moreMenu=pa.getNode('moreMenu');this._topContentCont=qa.getRoot();this._topContent=qa.getNode('masterViewTopContentHolder');this._closeButton=qa.getNode('masterViewTopContentCloseButton');this._closeButtonCont=qa.getNode('masterViewTopContentCloseCont');this._state=null;this._folder=null;this._filter=null;this._query=null;this._threadID=null;this._folders=q.getSupportedFolders();this._foldersToHeader={};this._filters=p.getSupportedFilters();this._filtersToHeader={};this._otherMarkAllRead=k.create('a',{},"Mark all as Read");this._unreadMarkAllRead=k.create('a',{},"Mark all as Read");this._otherEditSettings=k.create('a',{},"Edit Preferences");var ra=[];this._filters.forEach(function(ua){var va=ka.curry(this,i.MessagingTag.INBOX,ua);switch(ua){case i.MessagingTag.UNREAD:this._filtersToHeader[ua]=this._filtersToHeader[ua]||new n("Unread",this._moreMenu,va);break;}}.bind(this));this._folders.forEach(function(ua){var va=ka.curry(this,ua,p.ALL);switch(ua){case i.MessagingTag.INBOX:this._foldersToHeader[ua]=this._foldersToHeader[ua]||new u("Inbox",ra,va);break;case i.MessagingTag.OTHER:this._foldersToHeader[ua]=this._foldersToHeader[ua]||new u("Other",ra,va);break;case i.MessagingTag.ACTION_ARCHIVED:this._foldersToHeader[ua]=this._foldersToHeader[ua]||new n("Archived",this._moreMenu,va);break;case i.MessagingTag.SPAM:this._foldersToHeader[ua]=this._foldersToHeader[ua]||new n("Spam",this._moreMenu,va);break;}}.bind(this));k.prependContent(this._tabList,ra);var sa=k.scry(this._tabList,"._6xt");sa.push(pa.getNode('moreMenuLabel'));this._ellipsizer=new l(sa);ga(this);var ta=ka.curry(this,i.MessagingTag.INBOX,p.ALL);h.subscribe(r.ACCEPTED_EVENT,ja.curry(this));aa.addSubscriptions(w.subscribe('unread-updated',la.curry(this)),Event.listen(this._otherMarkAllRead,'click',function(){x.markFolderAsRead(i.MessagingTag.OTHER);}),Event.listen(this._unreadMarkAllRead,'click',function(){x.markFolderAsRead(i.MessagingTag.INBOX);}),Event.listen(this._otherEditSettings,'click',function(){y.show();}),Event.listen(this._closeButton,'click',ta));};ba(fa.prototype,{updateView:function(){var ma=ia(this);ha(this);if(ma)ja(this);ga(this);},getOtherFolderLabel:function(){var ma=i.MessagingTag.OTHER,na=this._foldersToHeader[ma];if(!na||!na._template)return null;return na._template.getNode('folderLabel');},destroy:function(){for(var ma in this._foldersToHeader)this._foldersToHeader[ma]&&this._foldersToHeader[ma].destroy();for(var na in this._filtersToHeader)this._filtersToHeader[na]&&this._filtersToHeader[na].destroy();}});function ga(ma){var na=85;k.scry(ma._tabList,"._1r").forEach(function(oa){na+=oa.offsetWidth;});ma._ellipsizer.confineWithin(ma._rootElement.offsetWidth-na);}function ha(ma){var na=t.getCurrentStateData();ma._state=t.getCurrentMasterState();ma._folder=na.folder;ma._filter=na.filter;ma._query=na.query;}function ia(ma){if(!ma._state||!ma._folder)return true;var na=t.getCurrentStateData();if(ma._folder!=na.folder)return true;if(ma._filter!=na.filter)return true;return false;}function ja(ma){var na=false,oa;ma._folders.forEach(function(pa){var qa=ma._filter==i.MessagingTag.UNREAD,ra=pa==ma._folder&&(ma._filter==p.ALL||qa),sa,ta;switch(pa){case i.MessagingTag.INBOX:if(qa){var ua=g.strong({children:"Unread"}),va=g.strong({children:"Inbox"}),wa=da._("{unread} messages in {inbox}",{unread:ua,inbox:va});sa=g.div({children:[wa,' \u00b7 ',ma._unreadMarkAllRead]});ta=true;}break;case i.MessagingTag.OTHER:var xa='';if(o.filtering_active)xa=g.span({children:[ma._otherEditSettings,' \u00b7 ']});sa=g.div({children:[g.p({children:[g.strong({children:"Tip:"+' '})," See a message from someone you know? Just reply or click Move to Inbox. "]}),xa,ma._otherMarkAllRead]});r.tryShow(ma.getOtherFolderLabel());break;}if(ra){oa=pa;j.conditionShow(ma._closeButtonCont,ta);}else ma._foldersToHeader[pa].setSelected(false);if(ra&&sa){na=true;k.setContent(ma._topContent,sa);}});ma._filters.forEach(function(pa){var qa=ma._folder==i.MessagingTag.INBOX&&pa==ma._filter;ma._filtersToHeader[pa].setSelected(qa);});oa&&ma._foldersToHeader[oa].setSelected(true);j.conditionShow(ma._topContentCont,na);la(ma);ma._manager.draw();}function ka(ma,na,oa){var pa=ma._state==s.MASTER.SEARCH;if(pa||ma._folder!=na||ma._filter!=oa){if(na==i.MessagingTag.OTHER)ea.bump('other_inbox_access_from_web_messenger');var qa=ba({},t.getCurrentStateData()),ra=t.getCurrentDetailState();if(ra!==s.DETAIL.SEARCH_SNIPPET&&ra!==s.DETAIL.SEARCH_CONTEXT)delete qa.query;t.updateMasterState(s.MASTER.RECENT_THREADS,ba(qa,{folder:na,filter:oa}));}z.focusComposer();}function la(ma){for(var na in ma._foldersToHeader){if(na==i.MessagingTag.ACTION_ARCHIVED)continue;var oa=x.exceedsMaxCount(na)?i.MercuryThreadlistConstants.MAX_UNREAD_COUNT+'+':x.getUnreadCount(na),pa=[ma._foldersToHeader[na].getCountBadge()];if(na==i.MessagingTag.INBOX)ma._filters.forEach(function(qa){pa.push(ma._filtersToHeader[qa].getCountBadge());});pa.forEach(function(qa){if(oa)k.setContent(qa,k.tx._("({unread_count})",{unread_count:oa}));j.conditionShow(qa,oa);});}ga(ma);}e.exports=fa;});
__d("MercuryLocalThreadResults",["Env","escapeRegex","MercuryFolders","MercuryOrderedThreadlist","MercuryIDs","MercuryParticipants","MercuryThreads","TypeaheadUtil"],function(a,b,c,d,e,f){var g=b('Env'),h=b('escapeRegex'),i=b('MercuryFolders'),j=b('MercuryOrderedThreadlist'),k=b('MercuryIDs'),l=b('MercuryParticipants'),m=b('MercuryThreads').get(),n=b('TypeaheadUtil'),o={findMatchingThreadsFromIds:function(v,w){return w.filter(function(x){var y=m.getThreadMetaNow(x);return p(y,v);});},findMatchingThreads:function(v){var w=[];i.getSupportedFolders().forEach(function(x){w=w.concat(j.getThreadlistUntilTimestamp(0,x));}.bind(this));return this.findMatchingThreadsFromIds(v,w);}};function p(v,w){var x=s(v.participants),y=q(w),z=null;l.getMulti(x,function(aa){z=x.map(function(ba){return aa[ba];});});if(!z)return false;return u(y,function(aa){var ba=t(z,function(da){return da&&da.name&&r(aa,q(da.name));}),ca=v.name&&r(aa,q(v.name));return ba||ca;});}function q(v){return v.split(/\s+/).filter(function(w){return w.trim().length>0;});}function r(v,w){var x=new RegExp('\\b'+h(v),'i');return t(w,function(y){var z=n.parse(y).flatValue;return x.test(z);});}function s(v){if(v.length===1&&k.tokenize(v[0]).value===g.user)return v;return v.filter(function(w){var x=k.tokenize(w).value;return x!==g.user;});}function t(v,w){for(var x=0;x<v.length;x++)if(w(v[x]))return true;return false;}function u(v,w){for(var x=0;x<v.length;x++)if(!w(v[x]))return false;return true;}e.exports=o;});
__d("MercurySearchThreadResults",["MercuryConstants","KeyedCallbackManager","RangedCallbackManager","MercuryServerDispatcher","MercuryServerRequests"],function(a,b,c,d,e,f){var g=b('MercuryConstants'),h=b('KeyedCallbackManager'),i=b('RangedCallbackManager'),j=b('MercuryServerDispatcher'),k=b('MercuryServerRequests'),l=new h(),m=g.MercuryThreadlistConstants.WEBMESSENGER_THREAD_COUNT,n=g.MercuryThreadlistConstants.WEBMESSENGER_MORE_COUNT,o={getThreadlist:function(r,s){if(r){var t=l.executeOrEnqueue(r,function(w){var x=w.getAllResources(),y=w.hasReachedEndOfArray();s(x,y);}),u=l.getUnavailableResources(t),v=g.MercuryAPIArgsSource&&g.MercuryAPIArgsSource.WEBMESSENGER;if(u.length)q({client:v,query:r,offset:0,limit:m+1});return t;}},isExhausted:function(r){var s=l.getResource(r);return s?s.hasReachedEndOfArray():false;},getCachedThreadlist:function(r){var s=l.getResource(r);return s?s.getAllResources():null;},cacheThreadlist:function(r,s){l.getResource(r);var t=new i();t.addResourcesWithoutSorting(s,0);t.setReachedEndOfArray();l.setResource(r,t);},getMoreThreadlist:function(r,s){if(r){var t=l.getResource(r);if(t){var u=t.getCurrentArraySize(),v=n,w=t.executeOrEnqueue(0,u+v,function(){var y=t.getAllResources(),z=t.hasReachedEndOfArray();s(y,z);}),x=t.getUnavailableResources(w);if(x.length)q({query:r,offset:u,limit:v+1});return w;}}},handleUpdate:function(r){if(r.mercury_payload)k.handleUpdate(r.mercury_payload);var s=r.search_threads||{};for(var t in s){var u=s[t]||[],v=u.map(k.getClientThreadIDNow),w=l.getResource(t);if(w){p(w,v,n+1);}else{w=new i();p(w,v,m+1);l.setResource(t,w);}}},unsubscribe:function(r,s){if(s){var t=l.getResource(s);if(t){t.unsubscribe(r);}else l.unsubscribe(r);}},setInitialCount:function(r){m=r;}};function p(r,s,t){var u=r.getCurrentArraySize(),v=s.length<t;if(!v)s.pop();r.addResourcesWithoutSorting(s,u);if(v)r.setReachedEndOfArray();}function q(r){r.client=g.MercuryAPIArgsSource&&g.MercuryAPIArgsSource.WEBMESSENGER;j.trySend('/ajax/mercury/search_threads.php',r);}j.registerEndpoints({'/ajax/mercury/search_threads.php':{mode:j.IMMEDIATE,handler:o.handleUpdate}});e.exports=o;});
__d("MercurySearchThreadsStrategy",["WebMessengerConstants","MercuryLocalThreadResults","MercurySearchThreadResults","copyProperties","createObjectFrom"],function(a,b,c,d,e,f){var g=b('WebMessengerConstants'),h=b('MercuryLocalThreadResults'),i=b('MercurySearchThreadResults'),j=b('copyProperties'),k=b('createObjectFrom'),l=null,m=null,n=g.SEARCH_THREAD_DELAY,o={clearTimer:function(){l=null;clearTimeout(m);m=null;},search:function(r,s,t,u){if(r!=l){l=r;clearTimeout(m);m=null;}var v=h.findMatchingThreads(r),w=i.getCachedThreadlist(r);if(w){var x=q(v,w);s(x);t([],i.isExhausted(r));u(null,r);return;}var y=p(r),z=q(v,y.thread_ids);if(y.from_exhausted_remote_results){i.cacheThreadlist(r,z);s(z);t([],true);u(null,r);return;}s(z);m=setTimeout(function(){var aa=i.getThreadlist(r,t);u(aa,r);},n);}};function p(r){var s='',t=[];for(var u=r.length-1;u>0;u--){var v=r.slice(0,u),w=i.getCachedThreadlist(v);if(!w)continue;if(i.isExhausted(v)){return {from_exhausted_remote_results:true,thread_ids:h.findMatchingThreadsFromIds(r,w)};}else if(s.length===0){s=v;t=h.findMatchingThreadsFromIds(r,w);}}return {from_exhausted_remote_results:false,thread_ids:t};}function q(r,s){return Object.keys(j(k(r),k(s)));}e.exports=o;});
__d("WebMessengerMasterViewSearchInputControl",["event-extensions","CSS","DOM","Input","Keys","MercurySearchThreadsStrategy","WebMessengerShortcuts","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","WebMessengerSubscriptionsHandler","WebMessengerEvents","copyProperties","cx"],function(a,b,c,d,e,f){b('event-extensions');var g=b('CSS'),h=b('DOM'),i=b('Input'),j=b('Keys'),k=b('MercurySearchThreadsStrategy'),l=b('WebMessengerShortcuts'),m=b('WebMessengerStateConstants'),n=b('WebMessengerStateManager'),o=b('WebMessengerTemplates'),p=b('WebMessengerSubscriptionsHandler'),q=b('WebMessengerEvents'),r=b('copyProperties'),s=b('cx'),t=function(ba,ca){this._manager=ba;this._rootElement=ca;h.empty(this._rootElement);var da=o[':fb:web-messenger:master-view:search-input'].build();h.replace(this._rootElement,da.getRoot());this._searchBox=da.getRoot();this._searchInput=da.getNode('searchInput');this._searchClear=da.getNode('searchClear');this._searchButton=h.find(this._searchBox,'button');this._state=null;this._query=null;this._folder=null;this._threadID=null;this._ariaOwns=this._searchInput.getAttribute('aria-owns');p.addSubscriptions(q.subscribe(q.UPDATE_SELECTION,aa.curry(this)),Event.listen(this._searchButton,'click',function(){var ea=i.getValue(this._searchInput);if(ea)y(this,ea);}.bind(this)),Event.listen(this._searchClear,'click',x.curry(this)),Event.listen(this._searchInput,'keyup',function(event){var ea=i.getValue(this._searchInput);if(event.keyCode==j.ESC){x(this);}else if(event.keyCode==j.RETURN&&ea){l.openSearchThread();}else if(ea){z(this,ea);}else if(ea!==n.getCurrentStateData().query){x(this);this.focus();}return false;}.bind(this)),Event.listen(this._searchInput,'focus',function(ea){this._focused=true;}.bind(this)),Event.listen(this._searchInput,'blur',function(ea){this._focused=false;}.bind(this)));};r(t.prototype,{updateView:function(){var ba=v(this);u(this);if(ba)w(this);},focusAndSelectSearch:function(){y(this,i.getValue(this._searchInput));this._manager.scrollToTop(false);this.focus();this._searchInput.select();},focus:function(){(function(){if(!this._focused){this._searchInput.focus();this._searchInput.value=this._searchInput.value;}}).bind(this).defer();},destroy:function(){}});function u(ba){var ca=n.getCurrentStateData();ba._state=n.getCurrentMasterState();ba._folder=ca.folder;if(ba._state!=m.MASTER.SEARCH){ba._query=null;}else ba._query=ca.query;}function v(ba){if(!ba._state||!ba._folder)return true;var ca=n.getCurrentMasterState(),da=n.getCurrentStateData();if(ba._folder!=da.folder)return true;if(ca!=ba._state)return true;if(ca==m.MASTER.SEARCH&&ba._query!=da.query)return true;return false;}function w(ba){if(ba._state==m.MASTER.SEARCH){var ca=ba._query||'';if(i.getValue(ba._searchInput)!=ca)i.setValue(ba._searchInput,ca);ba.focus();}else{i.reset(ba._searchInput);ba._searchInput.blur();}g.conditionClass(ba._searchBox,"_47",!i.isEmpty(ba._searchInput));}function x(ba){k.clearTimer();var ca=n.getCurrentStateData();ca.no_uri=true;delete ca.query;n.updateMasterState(m.MASTER.RECENT_THREADS,ca);}function y(ba,ca){var da=n.getCurrentMasterState();if(da!=m.MASTER.SEARCH)ba._threadID=n.getCurrentStateData().thread_id;if(ca)n.updateDetailState(m.DETAIL.SEARCH_SNIPPET,{query:ca,message_query:ca});}function z(ba,ca){var da=n.getCurrentStateData();if(ca!==da.query){var ea=n.getCurrentMasterState();if(ea!=m.MASTER.SEARCH)ba._threadID=da.thread_id;if(ca)n.updateMasterState(m.MASTER.SEARCH,{all_people_query:da.all_people_query,message_query:da.message_query,message_id:da.message_id,query:ca,thread_id:da.thread_id});}}function aa(ba,ca,da){if(h.contains(ba._ariaOwns,da))ba._searchInput.setAttribute('aria-activedescendant',da);}e.exports=t;});
__d("MercuryLogger",["JSLogger","MercuryServerRequests","MercuryThreads"],function(a,b,c,d,e,f){var g=b('JSLogger'),h=b('MercuryServerRequests'),i=b('MercuryThreads').get(),j=g.create('messaging_impressions');function k(event,o){j.log(event,o);}function l(o,p){var q=i.getThreadMetaNow(o),r=h.getServerThreadIDNow(o);if(q&&r){var event=p?'thread_search':'thread',s={is_single_thread:q.is_canonical_user,is_subscribed:q.is_subscribed,query:p||null,thread_id:r};k(event,s);}}function m(o,p){var q={};p.forEach(function(r){var s=h.getServerThreadIDNow(r),t=i.getThreadMetaNow(r);if(t&&s){var u={is_single_thread:t.is_canonical_user,thread_id:s,folder:t.folder,participants:t.participants,canonical_fbid:t.canonical_fbid};q[s]=u;}});k('threadlist',{folder:o,threads:q});}var n={logThread:function(o){l(o);},logThreadlist:function(o,p){m(o,p);},logThreadFromSearch:function(o,p){l(p,o);},logThreadlistFromSearch:function(o,p){k('threadlist_search',{folder:p,query:o});}};e.exports=n;});
__d("WebMessengerThreadlistRenderer",["event-extensions","MercuryConstants","CSS","DOM","MercuryListUpdateRenderer","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","MercuryThreadMetadataRawRenderer","MercuryThreadMetadataRenderer","MercuryThreads","Tooltip","WebMessengerPermalinks","cx","tx"],function(a,b,c,d,e,f){b('event-extensions');var g=b('MercuryConstants'),h=b('CSS'),i=b('DOM'),j=b('MercuryListUpdateRenderer'),k=b('WebMessengerStateConstants'),l=b('WebMessengerStateManager'),m=b('WebMessengerTemplates'),n=b('MercuryThreadMetadataRawRenderer'),o=b('MercuryThreadMetadataRenderer'),p=b('MercuryThreads').get(),q=b('Tooltip'),r=b('WebMessengerPermalinks'),s=b('cx'),t=b('tx'),u={renderThreadsFromIDs:function(w,x,y,z,aa,ba){z=z||function(ca){return ca;};aa=aa||{};j.updateList(w,x.map(z),function(ca){return !aa[x[ca]]&&x[ca]!=y;},function(ca){var da=x[ca],ea=m[':fb:web-messenger:threadlist-row'].build();ea.getRoot().setAttribute('id',z(da));Event.listen(ea.getNode('threadLink'),'click',function(fa){if(fa.getModifiers().any)return true;var ga=l.getCurrentMasterState(),ha={thread_id:da};if(ga===k.MASTER.SEARCH)ha.query=l.getCurrentStateData().query;l.updateDetailState(k.DETAIL.RECENT_MESSAGES,ha);return false;});if(da==y)h.addClass(ea.getRoot(),"_kv");p.getThreadMeta(da,function(fa){o.renderCoreThreadlist(fa,ea,v.curry(ba),{show_unread_count:false,names_renderer:n.renderShortNames},true);},g.MercuryAPIArgsSource&&g.MercuryAPIArgsSource.WEBMESSENGER);return ea.getRoot();});}};function v(w,x,y){var z=x.getNode('readToggler'),aa=x.getNode('archiveButton');x.getNode('threadLink').setAttribute('href',r.getURI(w,k.DETAIL.RECENT_MESSAGES,{thread_id:y.thread_id}).toString());if(y.unread_count>0){h.addClass(x.getRoot(),"_kx");i.setContent(x.getNode('newCount'),i.tx._("{num} new",{num:y.unread_count}));h.addClass(z,"_ky");q.set(z,"Mark as Read",'above','right');}else{h.addClass(z,"_kz");q.set(z,"Mark as Unread",'above','right');}Event.listen(z,'click',function(event){p.changeThreadReadStatus(y.thread_id,h.hasClass(z,"_ky"));return false;});var ba=l.getCurrentStateData().folder;if(ba==g.MessagingTag.SPAM){h.hide(aa);}else{var ca=true;if(ba==g.MessagingTag.ACTION_ARCHIVED){ca=false;q.set(aa,"Unarchive",'above','right');h.addClass(aa,"_2s2");}else{q.set(aa,"Archive",'above','right');h.addClass(aa,"_l9");}Event.listen(aa,'click',function(event){p.changeThreadArchivedStatus(y.thread_id,ca);var da=l.getCurrentStateData();if(da.thread_id==y.thread_id)l.updateDetailState(k.DETAIL.RECENT_MESSAGES,{folder:da.folder});return false;});}}e.exports=u;});
__d("WebMessengerMasterViewUnseenMessagesNotice",["event-extensions","Class","MercuryConstants","copyProperties","WebMessengerStateManager","MercuryThreadInformer","throttle","MercuryUnseenState","UserActivity","WebMessengerSubscriptionsHandler","WebMessengerMessagesNotice","WebMessengerConstants"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Class'),h=b('MercuryConstants'),i=b('copyProperties'),j=b('WebMessengerStateManager'),k=b('MercuryThreadInformer'),l=b('throttle'),m=b('MercuryUnseenState'),n=b('UserActivity'),o=b('WebMessengerSubscriptionsHandler'),p=b('WebMessengerMessagesNotice'),q=b('WebMessengerConstants'),r=q.THREADLIST_SCROLLTOP_OFFSET,s=q.MESSAGE_NOTICE_INACTIVITY_THRESHOLD,t=function(y){this.parent.construct(this);this._manager=y;o.addSubscriptions(k.subscribe('messages-received',function(z,aa){var ba=!n.isActive(s),ca=!this.isScrolledWithinTopThreshold();if(!this.parent.getActive()||w(aa)||!v(aa))return;if(this.parent.onlyReceivedFromSelf(aa))return;if(ba){this.removeMessageNotice();this._manager.scrollToTop();}else if(ca)this.showMessageNotice();}.bind(this)),k.subscribe('unseen-updated',u.curry(this)));this._manager.setScrollCallback(l(function(z){if(this.parent.getActive()&&z.getScrollTop()<=q.THREADLIST_TOP_OFFSET&&n.isActive(s)&&x()){this.removeMessageNotice();m.markAsSeen();}}.bind(this),100,null));};g.extend(t,p);i(t.prototype,{isScrolledWithinTopThreshold:function(){return this._manager.getScrollTop()<=r;},showMessageNotice:function(){if(!x())return;var y=function(){this._manager.scrollToTop();}.bind(this);this.parent.showMessageNotice(y,'below');}});function u(y){if(m.getUnseenCount()===0)y.removeMessageNotice();}function v(y){for(var z in y)for(var aa=0;aa<y[z].length;aa++)if(y[z][aa].folder==h.MessagingTag.INBOX)return true;return false;}function w(y){var z=j.getCurrentStateData().thread_id,aa=true;for(var ba in y)if(y.hasOwnProperty(ba))if(ba!==z){aa=false;break;}return x()&&aa;}function x(){var y=j.getCurrentStateData().folder;return y===h.MessagingTag.INBOX;}e.exports=t;});
__d("WebMessengerMasterViewRecentThreadsControl",["event-extensions","function-extensions","MercuryConstants","CSS","DOM","MercuryLogger","MercuryFilters","MercuryFolders","MercuryOrderedThreadlist","MercuryServerRequests","WebMessengerShortcuts","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","MercuryThreadInformer","WebMessengerThreadlistRenderer","MercuryThreads","MercuryUnseenState","UserActivity","WebMessengerConstants","WebMessengerEvents","WebMessengerInfoBoxRenderer","WebMessengerSubscriptionsHandler","WebMessengerMasterViewUnseenMessagesNotice","copyProperties","createObjectFrom","cx","ge","tx"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('MercuryConstants'),h=b('CSS'),i=b('DOM'),j=b('MercuryLogger'),k=b('MercuryFilters'),l=b('MercuryFolders'),m=b('MercuryOrderedThreadlist'),n=b('MercuryServerRequests'),o=b('WebMessengerShortcuts'),p=b('WebMessengerStateConstants'),q=b('WebMessengerStateManager'),r=b('WebMessengerTemplates'),s=b('MercuryThreadInformer'),t=b('WebMessengerThreadlistRenderer'),u=b('MercuryThreads').get(),v=b('MercuryUnseenState'),w=b('UserActivity'),x=b('WebMessengerConstants'),y=b('WebMessengerEvents'),z=b('WebMessengerInfoBoxRenderer'),aa=b('WebMessengerSubscriptionsHandler'),ba=b('WebMessengerMasterViewUnseenMessagesNotice'),ca=b('copyProperties'),da=b('createObjectFrom'),ea=b('cx'),fa=b('ge'),ga=b('tx'),ha='recent:',ia=function(db,eb,fb,gb){this._manager=db;this._rootElement=eb;this._infoBox=fb;i.empty(this._rootElement);this._pagerExponent=-1;var hb=r[':fb:web-messenger:threadlist'].build();i.setContent(this._rootElement,hb.getRoot());this._loadingSpinner=hb.getNode('loadingSpinner');this._threadlistRows=hb.getNode('threadlistRows');this._loadMoreButton=hb.getNode('loadMoreButton');this._loadMoreLink=hb.getNode('loadMoreLink');this._active=false;this._state=null;this._folder=null;this._filter=null;this._selection=null;this._threadIDs=[];this._unreadThreadIDs=[];this._folders=l.getSupportedFolders();this._filters=k.getSupportedFilters();this._olderTimestamp={};this._currentCountMap={};this._folders.forEach(function(ib){this._currentCountMap[ib]={};this._filters.concat([k.ALL]).forEach(function(jb){this._currentCountMap[ib][jb]=g.MercuryThreadlistConstants.WEBMESSENGER_THREAD_COUNT+1;}.bind(this));}.bind(this));this._unseenMessagesNotice=new ba(this._manager);this._unseenMessagesNotice.setNoticeContextNode(gb);aa.addSubscriptions(s.subscribe('threadlist-updated',function(ib,jb){va(this,da(jb));}.bind(this)),n.subscribe('model-update-completed',function(){ab(this);}.bind(this)),Event.listen(this._loadMoreLink,'click',function(){ua(this);}.bind(this)),this._manager.subscribe('scrolledNearBottom',function(){this._active&&ua(this);}.bind(this)));};ca(ia.prototype,{updateView:function(){this._active=true;this._unseenMessagesNotice.updateView();h.show(this._rootElement);var db=ka(this),eb=la(this),fb=this._folder,gb=this._selection;ma(this);if(eb)na(this,gb);if(db){ta(this);}else oa(this);ab(this);if(fb!=this._folder)j.logThreadlist(this._folder,this._threadIDs);if(this._selection&&gb!=this._selection)j.logThread(this._selection);},hideView:function(){this._active=false;this._unseenMessagesNotice.hideView();h.hide(this._rootElement);},destroy:function(){ja(this);this._unseenMessagesNotice.destroy();}});function ja(db){db._threadlistSubscription&&m.unsubscribe(db._threadlistSubscription.subscriber_id,db._threadlistSubscription.folder,db._threadlistSubscription.filter);db._threadlistSubscription=null;}function ka(db){var eb=q.getCurrentStateData();if((db._folder!=eb.folder)||(db._filter!=eb.filter))return true;return false;}function la(db){var eb=q.getCurrentStateData();if(db._selection!=eb.thread_id)return true;return false;}function ma(db){var eb=q.getCurrentStateData();db._state=q.getCurrentMasterState();if((db._folder!=eb.folder)||(db._filter!=eb.filter))db._pageExponent=-1;db._folder=eb.folder;db._filter=eb.filter;db._selection=eb.thread_id;}function na(db,eb){var fb=fa(za(eb));if(fb){h.removeClass(fb,"_kv");fb.removeAttribute('aria-selected');}var gb=fa(za(db._selection));if(gb){h.addClass(gb,"_kv");gb.setAttribute('aria-selected','true');}y.updateSelection(gb&&gb.id);}function oa(db){if(db._active)o.updateThreadlistIndex(db,db._threadIDs.map(za),za(db._selection));}function pa(db){h.addClass(db._manager.getFlexAreaElement(),"_3j6");h.addClass(db._manager.getFlexAreaElement(),"_3j7");}function qa(db){h.removeClass(db._manager.getFlexAreaElement(),"_3j6");h.removeClass(db._manager.getFlexAreaElement(),"_3j7");}function ra(db){h.hide(db._threadlistRows);qa(db);}function sa(db){if(db._threadIDs.length){h.show(db._threadlistRows);qa(db);}else{h.hide(db._threadlistRows);pa(db);}}function ta(db){h.show(db._loadingSpinner);h.hide(db._infoBox);ra(db);h.hide(db._loadMoreButton);ja(db);var eb=m.getFilteredThreadlist(g.MercuryThreadlistConstants.RECENT_THREAD_OFFSET,db._currentCountMap[db._folder][db._filter],db._folder,db._filter,function(fb,gb){h.hide(db._loadingSpinner);wa(db,fb,gb);sa(db);oa(db);db._manager.poke();db._manager.forceFireScrollCallbacks();},null,g.MercuryAPIArgsSource&&g.MercuryAPIArgsSource.WEBMESSENGER);if(eb)db._threadlistSubscription={subscriber_id:eb,folder:db._folder,filter:db._filter};}function ua(db){if(db._requestInFlight||h.hasClass(db._loadMoreButton,'hidden_elem'))return;db._requestInFlight=true;h.addClass(db._loadMoreButton,'async_saving');db._pagerExponent=Math.min(db._pagerExponent+1,x.EXPONENTIAL_PAGER_MAX_CYCLES);var eb=Math.pow(2,db._pagerExponent),fb=db._currentCountMap[db._folder][db._filter]+eb*(g.MercuryThreadlistConstants.WEBMESSENGER_MORE_COUNT);ja(db);var gb=m.getFilteredThreadlist(g.MercuryThreadlistConstants.RECENT_THREAD_OFFSET,fb,db._folder,db._filter,function(hb,ib){h.removeClass(db._loadMoreButton,'async_saving');db._currentCountMap[db._folder][db._filter]=fb;wa(db,hb,ib);oa(db);db._manager.poke();db._requestInFlight=false;},null,g.MercuryAPIArgsSource&&g.MercuryAPIArgsSource.WEBMESSENGER);if(gb)db._threadlistSubscription={subscriber_id:gb,folder:db._folder,filter:db._filter};}function va(db,eb){if(!db._folder||!db._olderTimestamp[db._folder])return;var fb=m.getThreadlistUntilTimestamp(db._olderTimestamp[db._folder],db._folder,db._filter);if(db._filter==g.MessagingTag.UNREAD){fb=ya(db,fb);}else db._unreadThreadIDs=[];if(fb.length>db._currentCountMap[db._folder][db._filter])db._currentCountMap[db._folder][db._filter]=fb.length;db._threadIDs=fb;sa(db);t.renderThreadsFromIDs(db._threadlistRows,fb,db._selection,za,eb,p.MASTER.RECENT_THREADS);oa(db);db._manager.poke();}function wa(db,eb,fb){var gb=(eb.length==db._currentCountMap[db._folder][db._filter]);if(gb)eb.pop();if(eb.length){var hb=eb[eb.length-1];u.getThreadMeta(hb,function(ib){db._olderTimestamp[db._folder]=ib.timestamp;},g.MercuryAPIArgsSource&&g.MercuryAPIArgsSource.WEBMESSENGER);}if(db._filter==g.MessagingTag.UNREAD){db._unreadThreadIDs=eb;}else db.unreadThreadIDs=[];h.conditionShow(db._loadMoreButton,gb);db._threadIDs=eb;t.renderThreadsFromIDs(db._threadlistRows,eb,db._selection,za,null,p.MASTER.RECENT_THREADS);fb=fb&&eb.length===0;fb&&xa(db);h.conditionShow(db._infoBox,fb);}function xa(db){if(db._builtErrorMessage)return;i.setContent(db._infoBox,z.render("Could Not Load Conversations",[{text:"Try Again",handler:ta.bind(null,db)}]));db._builtErrorMessage=true;}function ya(db,eb){eb.forEach(function(fb){if(db._unreadThreadIDs.indexOf(fb)<0)db._unreadThreadIDs.push(fb);});db._unreadThreadIDs.sort(function(fb,gb){var hb=u.getThreadMetaNow(fb).timestamp,ib=u.getThreadMetaNow(gb).timestamp;return ib-hb;});db._unreadThreadIDs=db._unreadThreadIDs.filter(function(fb){var gb=u.getThreadMetaNow(fb);return l.getFromMeta(gb)==db._folder;});return db._unreadThreadIDs;}function za(db){if(db)return ha+db;return null;}function ab(db){if(!cb(db))return;if(w.isActive(5000)){bb(db);}else w.subscribeOnce(bb.curry(db));}function bb(db){if(cb(db))v.markAsSeen();}function cb(db){return db._active&&db._folder==g.MessagingTag.INBOX&&db._unseenMessagesNotice.isScrolledWithinTopThreshold();}e.exports=ia;});
__d("MercurySearchThreadResultOrderer",["MercuryConstants","MercuryThreads","createObjectFrom"],function(a,b,c,d,e,f){var g=b('MercuryConstants'),h=b('MercuryThreads').get(),i=b('createObjectFrom'),j={separateCanonicalThreadsInFolder:function(p,q){var r=[],s=[];p.forEach(function(t){var u=h.getThreadMetaNow(t);if(u.folder===q&&u.is_canonical){r.push(t);}else s.push(t);});return {canonical_in_folder:r.sort(l),remaining:s};},orderResults:function(p,q,r,s){var t=o(q,r),u=t.sort(k.curry(s));return o(p,u);}};function k(p,q,r){var s=h.getThreadMetaNow(q),t=h.getThreadMetaNow(r),u=m(s),v=m(t);if(u!==v)return n(u,p)>n(v,p)?-1:1;if(s.is_canonical!==t.is_canonical)return s.is_canonical?-1:1;return l(q,r);}function l(p,q){var r=h.getThreadMetaNow(p),s=h.getThreadMetaNow(q);return r.timestamp>s.timestamp?-1:1;}function m(p){return p.is_archived?g.MessagingTag.ACTION_ARCHIVED:p.folder;}function n(p,q){if(p===q)return 5;var r={};r[g.MessagingTag.INBOX]=4;r[g.MessagingTag.ACTION_ARCHIVED]=3;r[g.MessagingTag.OTHER]=2;r[g.MessagingTag.SPAM]=1;return r[p];}function o(p,q){var r=i(p),s=q.filter(function(t){return !(t in r);});return p.concat(s);}e.exports=j;});
__d("WebMessengerMasterViewSearchThreadsControl",["event-extensions","CSS","DOM","MercuryFolders","MercuryLogger","MercuryOrderedThreadlist","MercurySearchThreadResultOrderer","MercurySearchThreadResults","MercurySearchThreadsStrategy","WebMessengerShortcuts","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","MercuryThreadInformer","WebMessengerThreadlistRenderer","MercuryThreads","WebMessengerEvents","WebMessengerSubscriptionsHandler","copyProperties","createObjectFrom","csx","cx","ge"],function(a,b,c,d,e,f){b('event-extensions');var g=b('CSS'),h=b('DOM'),i=b('MercuryFolders'),j=b('MercuryLogger'),k=b('MercuryOrderedThreadlist'),l=b('MercurySearchThreadResultOrderer'),m=b('MercurySearchThreadResults'),n=b('MercurySearchThreadsStrategy'),o=b('WebMessengerShortcuts'),p=b('WebMessengerStateConstants'),q=b('WebMessengerStateManager'),r=b('WebMessengerTemplates'),s=b('MercuryThreadInformer'),t=b('WebMessengerThreadlistRenderer'),u=b('MercuryThreads').get(),v=b('WebMessengerEvents'),w=b('WebMessengerSubscriptionsHandler'),x=b('copyProperties'),y=b('createObjectFrom'),z=b('csx'),aa=b('cx'),ba=b('ge'),ca='search:',da='search-indicator',ea=function(ab,bb,cb,db){this._manager=ab;this._rootElement=bb;this._noMessagesIndicator=db;h.empty(this._rootElement);var eb=r[':fb:web-messenger:thread-search'].build();h.setContent(this._rootElement,eb.getRoot());this._loadingSpinner=eb.getNode('loadingSpinner');this._threadlistRows=eb.getNode('threadlistRows');this._loadMoreButton=eb.getNode('loadMoreButton');this._loadMoreLink=eb.getNode('loadMoreLink');var fb=r[':fb:web-messenger:master-view-snippets-link'].build();this._threadSearchResultDescription=fb.getNode('threadSearchResultDescription');this._searchMessagesIndicator=fb.getRoot();this._searchMessagesIndicator.setAttribute('id',ca+da);h.replace(cb,this._searchMessagesIndicator);this._snippetSearchLink=fb.getNode('snippetSearchLink');this._snippetSearchLinkText=fb.getNode('snippetSearchLinkText');this._active=false;this._detailState=null;this._query=null;this._folder=null;this._selection=null;this._keyboardSelection=null;this._threadIDs=[];this._oldestTimestamps=ga();this._namesChangedSinceLastRedraw=false;this._remoteResultsCompleted=true;w.addSubscriptions(s.subscribe('threadlist-updated',function(gb,hb){sa(this,y(hb));}.bind(this)),s.subscribe('messages-received',function(){this._namesChangedSinceLastRedraw=true;}.bind(this)),Event.listen(this._loadMoreLink,'click',function(){ra(this);}.bind(this)));};x(ea.prototype,{updateView:function(){this._active=true;g.show(this._rootElement);g.hide(this._loadingSpinner);var ab=ha(this),bb=ia(this),cb=this._folder,db=this._query,eb=this._selection;ja(this);if(bb||ab){var fb=this._keyboardSelection;switch(this._detailState){case p.DETAIL.RECENT_MESSAGES:this._keyboardSelection=this._selection;break;case p.DETAIL.SEARCH_SNIPPET:case p.DETAIL.SEARCH_CONTEXT:this._keyboardSelection=da;}ka(this,fb);}if(ab){pa(this);}else{la(this,false);qa(this);}if(db!=this._query||cb!=this._folder)j.logThreadlistFromSearch(this._query,this._folder);if(this._selection&&eb!=this._selection)j.logThreadFromSearch(this._query,this._selection);},hideView:function(){this._active=false;g.hide(this._rootElement);ta(this,false);qa(this);},openSearchThread:function(ab){if(ab==da){za(this);}else q.updateDetailState(p.DETAIL.RECENT_MESSAGES,{query:this._query,thread_id:ab});},updateKeyboardSelection:function(ab){var bb=this._keyboardSelection;this._keyboardSelection=ab;ka(this,bb);},destroy:function(){fa(this);}});function fa(ab){ab._searchThreadsSubscription&&m.unsubscribe(ab._searchThreadsSubscription.subscriber_id,ab._searchThreadsSubscription.query);ab._searchThreadsSubscription=null;}function ga(){var ab={};i.getSupportedFolders().forEach(function(bb){var cb=k.getThreadlistUntilTimestamp(0,bb);ab[bb]=cb.length>0?u.getThreadMetaNow(cb[cb.length-1]).timestamp:Infinity;}.bind(this));return ab;}function ha(ab){var bb=ab._namesChangedSinceLastRedraw;ab._namesChangedSinceLastRedraw=false;if(bb)return true;if(!ab._remoteResultsCompleted)return true;var cb=ga(),db=ab._oldestTimestamps;ab._oldestTimestamps=cb;var eb=q.getCurrentStateData();if(ab._query!==eb.query||ab._folder!==eb.folder)return true;for(var fb in db)if(db[fb]>cb[fb])return true;return false;}function ia(ab){var bb=q.getCurrentStateData();if(ab._selection!=bb.thread_id)return true;return false;}function ja(ab){var bb=q.getCurrentStateData();ab._detailState=q.getCurrentDetailState();ab._query=bb.query;ab._folder=bb.folder;ab._selection=bb.thread_id;}function ka(ab,bb){var cb=ba(xa(bb));if(cb){g.removeClass(cb,"_kv");cb.removeAttribute('aria-selected');}var db=ba(xa(ab._keyboardSelection));if(db){g.addClass(db,"_kv");db.setAttribute('aria-selected',true);}v.updateSelection(db&&db.id);}function la(ab,bb){if(ab._keyboardSelection&&ab._keyboardSelection!=da&&ab._threadIDs.indexOf(ab._keyboardSelection)<0)ab._keyboardSelection=null;if(!ab._keyboardSelection)if(ab._threadIDs.length){ab._keyboardSelection=ab._threadIDs[0];}else if(!bb){ab._keyboardSelection=da;ka(ab);}var cb=ab._threadIDs.slice(0);cb.push(da);if(ab._active)o.updateThreadlistIndex(ab,cb.map(xa),xa(ab._keyboardSelection));}function ma(ab){var bb=h.scry(ab._threadlistRows,"._l5");bb.filter(function(cb){return h.getText(cb)!==q.getCurrentStateData().folder;}).forEach(g.show.bind(g));}function na(ab){var bb=h.scry(ab._threadlistRows,"._l5");bb.forEach(g.hide.bind(g));}function oa(ab){ma(ab);ab._manager.draw();}function pa(ab){g.show(ab._loadingSpinner);ta(ab,false);g.hide(ab._threadlistRows);g.hide(ab._loadMoreButton);na(ab);fa(ab);if(ab._query){var bb=[],cb=[];ab._remoteResultsCompleted=false;n.search(ab._query,function(db){var eb=l.separateCanonicalThreadsInFolder(db,q.getCurrentStateData().folder);bb=eb.canonical_in_folder;cb=eb.remaining;ya(ab);g.show(ab._threadlistRows);va(ab,bb);oa(ab);},function(db,eb){ab._remoteResultsCompleted=true;var fb=l.orderResults(bb,cb,db,q.getCurrentStateData().folder);if(fb.length>0){g.conditionShow(ab._loadMoreButton,!eb);wa(ab,fb);}else ua(ab);g.hide(ab._loadingSpinner);oa(ab);},function(db,eb){if(db)ab._searchThreadsSubscription={subscriber_id:db,query:eb};});}else{n.clearTimer();g.hide(ab._loadingSpinner);h.empty(ab._threadlistRows);g.show(ab._threadlistRows);ab._threadIDs=[];}qa(ab);}function qa(ab){var bb=!!ab._query&&ab._active,cb=bb^g.shown(ab._searchMessagesIndicator);g.conditionShow(ab._searchMessagesIndicator,bb);ab._manager.sizeToFit(bb);cb&&ab._manager.draw();}function ra(ab){fa(ab);g.addClass(ab._loadMoreButton,'async_saving');var bb=m.getMoreThreadlist(ab._query,function(cb,db){g.removeClass(ab._loadMoreButton,'async_saving');g.conditionShow(ab._loadMoreButton,!db);wa(ab,cb);ab._manager.poke();});if(bb)ab._searchThreadsSubscription={subscriber_id:bb,query:ab._query};}function sa(ab,bb){if(ab._threadIDs.length){t.renderThreadsFromIDs(ab._threadlistRows,ab._threadIDs,ab._keyboardSelection,xa,bb,p.MASTER.SEARCH);ab._manager.poke();}}function ta(ab,bb){bb=bb&&ab._active;g.conditionClass(ab._searchMessagesIndicator,"_33x",bb!==false);g.conditionShow(ab._noMessagesIndicator,bb!==false);}function ua(ab){ab._threadIDs=[];la(ab,false);var bb=h.tx._("No people or conversations named {query}",{query:ab._query}),cb=h.create('div',{},bb);h.setContent(ab._noMessagesIndicator,cb);ta(ab,true);}function va(ab,bb){wa(ab,bb,true);}function wa(ab,bb,cb){ab._threadIDs=bb;la(ab,cb);t.renderThreadsFromIDs(ab._threadlistRows,bb,ab._keyboardSelection,xa,null,p.MASTER.SEARCH);v.updateSelection(ab._keyboardSelection);if(ab._keyboardSelection==da)ka(ab);}function xa(ab){if(ab)return ca+ab;return null;}function ya(ab){var bb=h.tx._("Showing results for name: {query}",{query:ab._query});h.setContent(ab._threadSearchResultDescription,bb);w.addSubscriptions(Event.listen(ab._snippetSearchLink,'click',function(){ab.updateKeyboardSelection(da);za(ab);}));}function za(ab){if(ab._query){q.updateDetailState(p.DETAIL.SEARCH_SNIPPET,{query:ab._query,message_query:ab._query});v.focusSearch();}}e.exports=ea;});
__d("WebMessengerMasterViewControlManager",["event-extensions","ArbiterMixin","DOM","WebMessengerFlexibleScrollArea","WebMessengerMasterViewTabBarControl","WebMessengerMasterViewSearchInputControl","WebMessengerMasterViewRecentThreadsControl","WebMessengerMasterViewSearchThreadsControl","WebMessengerStateManager","WebMessengerStateConstants","Style","WebMessengerTemplates","WebMessengerEvents","WebMessengerSubscriptionsHandler","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('ArbiterMixin'),h=b('DOM'),i=b('WebMessengerFlexibleScrollArea'),j=b('WebMessengerMasterViewTabBarControl'),k=b('WebMessengerMasterViewSearchInputControl'),l=b('WebMessengerMasterViewRecentThreadsControl'),m=b('WebMessengerMasterViewSearchThreadsControl'),n=b('WebMessengerStateManager'),o=b('WebMessengerStateConstants'),p=b('Style'),q=b('WebMessengerTemplates'),r=b('WebMessengerEvents'),s=b('WebMessengerSubscriptionsHandler'),t=b('copyProperties'),u=function(v){this._rootElement=v;h.empty(this._rootElement);var w=q[':fb:web-messenger:master-view'].build();h.setContent(this._rootElement,w.getRoot());this._tabBarControl=new j(this,w.getNode('masterViewTabBar'),w.getNode('masterViewTopContent'));this._searchInputControl=new k(this,w.getNode('masterViewSearchInput'));this._searchThreadsControl=new m(this,w.getNode('masterViewSearchThreads'),w.getNode('searchMessagesIndicator'),w.getNode('noMessages'));this._threadlistRowsWrapper=w.getNode('threadlistRowsWrapper');this._flexArea&&this._flexArea.destroy();var x={fade:true,persistent:true};this._flexArea=new i(this._threadlistRowsWrapper,x).setInfiniteScrollHandler(this.inform.bind(this,'scrolledNearBottom')).setContainer(this._rootElement).setMinFlexAreaHeight(40).draw();this._recentThreadsControl=new l(this,w.getNode('masterViewRecentThreads'),w.getNode('masterInfoBox'),w.getNode('masterViewTabBar'));s.addSubscriptions(r.subscribe(r.FOCUS_AND_SELECT_SEARCH,this._searchInputControl.focusAndSelectSearch.bind(this._searchInputControl)),r.subscribe(r.FOCUS_SEARCH,this._searchInputControl.focus.bind(this._searchInputControl)),r.subscribe(r.MASTER_DOM_CHANGED,function(){this._tabBarControl.updateView();this._flexArea&&this._flexArea.draw();}.bind(this)),n.subscribe(o.STATE_CHANGE_EVENT,this.updateOnStateChange.bind(this)));this._resizeNodes=[this._rootElement,this._threadlistRowsWrapper,h.find(this._threadlistRowsWrapper,'div.uiScrollableAreaBody')];};t(u.prototype,g,{updateOnStateChange:function(){var v=n.getCurrentMasterState();this._tabBarControl.updateView();this._searchInputControl.updateView();switch(v){case o.MASTER.RECENT_THREADS:this._searchThreadsControl.hideView();this._recentThreadsControl.updateView();break;case o.MASTER.SEARCH:this._recentThreadsControl.hideView();this._searchThreadsControl.updateView();break;}},scrollIntoView:function(v,w){this._flexArea&&this._flexArea.scrollIntoView(v,w);},scrollToBottom:function(v){this._flexArea&&this._flexArea.scrollToBottom(v);},scrollToTop:function(v){this._flexArea&&this._flexArea.scrollToTop(v);},isScrolledToTop:function(){return this._flexArea&&this._flexArea.isScrolledToTop();},getScrollTop:function(){return this._flexArea.getScrollableArea().getScrollTop();},draw:function(){this._flexArea&&this._flexArea.draw();},poke:function(){this._flexArea&&this._flexArea.poke();},sizeToFit:function(v){this._flexArea&&this._flexArea.setSizeToFit(v);},setScrollCallback:function(v){this._flexArea&&this._flexArea.setScrollCallback(v);},forceFireScrollCallbacks:function(){this._flexArea&&this._flexArea._onScroll();},getFlexAreaElement:function(){return this._flexArea.flexArea;},resizeTo:function(v){this._resizeNodes.forEach(function(w){p.set(w,'width',v+'px');});r.masterDOMChanged();},destroy:function(){this._tabBarControl.destroy();this._recentThreadsControl.destroy();this._searchThreadsControl.destroy();this._flexArea.destroy();}});e.exports=u;});
__d("WebMessengerPageTitleRenderer",["MercuryConstants","DocumentTitle","MercuryParticipants","WebMessengerStateConstants","WebMessengerStateManager","MercuryThreadMetadataRenderer","MercuryThreads","tx"],function(a,b,c,d,e,f){var g=b('MercuryConstants'),h=b('DocumentTitle'),i=b('MercuryParticipants'),j=b('WebMessengerStateConstants'),k=b('WebMessengerStateManager'),l=b('MercuryThreadMetadataRenderer'),m=b('MercuryThreads').get(),n=b('tx'),o={updateTitleForState:function(r,s,t){this.withTitleForState(r,s,t||function(u){var v=k.getCurrentDetailState(),w=k.getCurrentStateData();if(r===v&&s===w)h.set(u);});},withTitleForState:function(r,s,t){switch(r){case j.DETAIL.RECENT_MESSAGES:p(s.thread_id,t);break;default:q(t);break;}}};function p(r,s){if(!r){q(s);return;}m.getThreadMeta(r,function(t){if(t.name){s(n._("{conversation_name} - Messages",{conversation_name:t.name}));return;}i.getMulti(t.participants,function(u){var v=l.renderParticipantList(r,u,u[i.user]?t.participants.length-1:t.participants.length,{abbr_mode:true,last_separator_uses_and:true,names_renderer:function(w){var x=[],y=Object.keys(w);if(y.length===1&&y[0]===i.user){x.push(w[y[0]].name);}else for(var z=0,aa=y.length;z<aa;z++)if(y[z]!==i.user)x.push(w[y[z]].name);return x;}});s(n._("{conversation_name} - Messages",{conversation_name:v}));});},g.MercuryAPIArgsSource&&g.MercuryAPIArgsSource.WEBMESSENGER);}function q(r){r("Messages");}e.exports=o;});
__d("WebMessengerPageTitleControl",["WebMessengerPageTitleRenderer","WebMessengerStateManager","WebMessengerStateConstants","WebMessengerSubscriptionsHandler"],function(a,b,c,d,e,f){var g=b('WebMessengerPageTitleRenderer'),h=b('WebMessengerStateManager'),i=b('WebMessengerStateConstants'),j=b('WebMessengerSubscriptionsHandler'),k=function(){j.addSubscriptions(h.subscribe(i.STATE_CHANGE_EVENT,function(){g.updateTitleForState(h.getCurrentDetailState(),h.getCurrentStateData());}));};e.exports=k;});
__d("WebMessengerThreadMessagesAgent",["MercuryConstants","MercuryMessages","MercuryOrderedThreadlist","MercuryThreadInformer","MercuryThreads","WebMessengerConstants","copyProperties"],function(a,b,c,d,e,f){var g=b('MercuryConstants'),h=b('MercuryMessages'),i=b('MercuryOrderedThreadlist'),j=b('MercuryThreadInformer'),k=b('MercuryThreads').get(),l=b('WebMessengerConstants'),m=b('copyProperties'),n=21,o=false,p='n_inbox_n_unreads',q=l.THREADLIST_MAX_READ_PRELOAD_NUM||3,r=l.THREADLIST_MAX_UNREAD_PRELOAD_NUM||3,s=function(){this._active=true;this._iterative=o;this._strategy=p;this._requestInFlight=false;this._requestIsQueued=false;this._pendingThreadIds={};this._processedThreadIds={};this._threadInformerSubscriptions=[];this._threadInformerSubscriptions.push(j.subscribe('threadlist-updated',t.curry(this)));};m(s.prototype,{turnOn:function(){this._active=true;},turnOff:function(){this._active=false;},destroy:function(){this._threadInformerSubscriptions.forEach(j.unsubscribe);this._threadInformerSubscriptions=[];}});function t(w){if(w._active&&!w._requestIsQueued){if(w._requestInFlight){w._requestIsQueued=true;return;}var x=u(w);if(x.length){w._requestInFlight=true;if(x.length>n){x=x.slice(0,n);w._requestIsQueued=true;}}x.forEach(function(y){w._processedThreadIds[y]=true;w._pendingThreadIds[y]=true;h.getThreadMessagesRange(y,0,l.INITIAL_MESSAGES_LIMIT+1,function(){v(w,y);},null,g.MercuryAPIArgsSource&&g.MercuryAPIArgsSource.WEBMESSENGER);});}}function u(w){var x=i.getThreadlistUntilTimestamp(0,g.MessagingTag.INBOX),y=x.filter(function(da){return !w._processedThreadIds[da]&&!h.hasLoadedNMessages(da,l.INITIAL_MESSAGES_LIMIT+1);});if(w._strategy===p){var z=[],aa=[];for(var ba=0;ba<y.length;ba++){var ca=k.getThreadMetaNow(y[ba]);if(ca){if(ca.unread_count&&aa.length<r)aa.push(y[ba]);if(!ca.unread_count&&z.length<q)z.push(y[ba]);if(aa.length>=r&&z.length>=q)break;}}y=z.concat(aa);}return y;}function v(w,x){if(w._pendingThreadIds[x])delete w._pendingThreadIds[x];if(Object.keys(w._pendingThreadIds).length===0){if(!w._iterative)w._active=false;w._requestInFlight=false;if(w._requestIsQueued){w._requestIsQueued=false;t(w);}}}e.exports=s;});
__d("WebMessengerWidthControl",["event-extensions","Arbiter","DOMDimensions","throttle","ViewportBounds","WebMessengerEvents","WebMessengerSubscriptionsHandler"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('DOMDimensions'),i=b('throttle'),j=b('ViewportBounds'),k=b('WebMessengerEvents'),l=b('WebMessengerSubscriptionsHandler'),m=206,n=981,o=275,p=848,q=724,r=.57;function s(u,v,w){this.masterChanged=u;this.detailChaned=v;l.addSubscriptions(Event.listen(window,'resize',i(t.shield(this,this),100)),g.subscribe(['sidebar/initialized','sidebar/show','sidebar/hide'],t.shield(this,this)));this._width=p;t(this,w);}function t(u,v){var w=j.getRight();if(!w&&v)w=m;var x=h.getViewportWithoutScrollbarDimensions().width-w,y=Math.round(Math.max(0,x/2-n/2));x=n+y-o;x=Math.max(q,Math.min(p,x));if(u._width!==x){u._width=x;var z=Math.round(x/(1+r)),aa=x-z;u.masterChanged(aa);u.detailChaned(z);}}e.exports=s;});
__d("WebMessengerApp",["Arbiter","WebMessengerDetailViewControlManager","DOM","WebMessengerMasterViewControlManager","WebMessengerPageTitleControl","PageTransitions","WebMessengerPermalinks","MercuryServerRequests","WebMessengerShortcuts","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerStateStore","MercuryThreadInformer","WebMessengerThreadMessagesAgent","URI","VaultBoxURI","WebMessengerAdsControl","emptyFunction","WebMessengerSubscriptionsHandler","WebMessengerWidthControl","clickRefAction","userAction","MercuryStateCheck","WebMessengerTemplates"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('WebMessengerDetailViewControlManager'),i=b('DOM'),j=b('WebMessengerMasterViewControlManager'),k=b('WebMessengerPageTitleControl'),l=b('PageTransitions'),m=b('WebMessengerPermalinks'),n=b('MercuryServerRequests'),o=b('WebMessengerShortcuts'),p=b('WebMessengerStateConstants'),q=b('WebMessengerStateManager'),r=b('WebMessengerStateStore'),s=b('MercuryThreadInformer'),t=b('WebMessengerThreadMessagesAgent'),u=b('URI'),v=b('VaultBoxURI'),w=b('WebMessengerAdsControl'),x=b('emptyFunction'),y=b('WebMessengerSubscriptionsHandler'),z=b('WebMessengerWidthControl'),aa=b('clickRefAction'),ba=b('userAction');b('MercuryStateCheck');var ca=b('WebMessengerTemplates');d(['VideoCallCore'],x);var da,ea;d(['VaultBox'],function(la){ea=la.getInstance();});function fa(la,ma){var na=ma&&ma.getQueryData().hasOwnProperty('theater'),oa=ma&&v.isVaultBoxURI(ma);if(na){da=g.subscribe('PhotoSnowlift.CLOSE',ga.curry(la),g.SUBSCRIBE_NEW);return false;}else if(oa){if(ea)da=ea.subscribe('close',ga.curry(la),g.SUBSCRIBE_NEW);return false;}var pa=m.processURI(ma);if(pa){var qa=q.getCurrentStateData();if(pa.redirect){m.goNextURI(pa.master_state,pa.detail_state,pa.data,pa.replace);}else q.updateStateOnURI(pa.master_state,pa.detail_state,pa.data);l.transitionComplete();la._adsControl.stateChanged(qa,q.getCurrentStateData());return true;}ka(la);return false;}function ga(la){l.registerHandler(fa.curry(la),6);if(da){da.unsubscribe();da=null;}}function ha(){var la=q.getCurrentStateData();r.setLastSeen(la.folder,la.thread_id);}function ia(la,ma,na,oa,pa){y.engage();ga(this);g.inform('chat/set_does_page_occlude_tabs',true,g.BEHAVIOR_PERSISTENT);g.inform('chat/set_show_tab_unread_ui',false,g.BEHAVIOR_PERSISTENT);new t();n.handleUpdate(ma);i.empty(la);var qa=ca[':fb:web-messenger:page-skeleton'].build();i.setContent(la,qa.getRoot());o.registerGeneralShortcuts();this._masterViewManager=new j(qa.getNode('masterView'));this._detailViewManager=new h(qa.getNode('detailView'));this._pageTitleControl=new k();oa&&i.prependContent(qa.getRoot(),oa);this._widthControl=new z(this._masterViewManager.resizeTo.bind(this._masterViewManager),this._detailViewManager.resizeTo.bind(this._detailViewManager),pa);this._adsControl=w.init();var ra=na?new u(na):m.getDefaultURI();fa(this,ra);aa('web_messenger').set_namespace('web_messenger');ba('web_messenger').uai('load').add_event('tti',0,window._cstart);y.addSubscriptions(s.subscribe('threads-deleted',function(sa,ta){var ua=q.getCurrentStateData().thread_id,va=q.getCurrentDetailState();if(va==p.DETAIL.RECENT_MESSAGES&&ta[ua]){q.updateDetailState(p.DETAIL.RECENT_MESSAGES,{thread_id:null});}else ha();}),q.subscribe(p.STATE_CHANGE_EVENT,ha));d(['MercuryBrowserAlerts'],function(sa){y.addSubscriptions(s.subscribe('messages-received',function(ta,ua){for(var va in ua){var wa=ua[va];for(var xa=0;xa<wa.length;xa++)sa.messageReceived(wa[xa]);}}));sa.subscribe('before-alert',function(ta,event){if(event.threadID==ja())event.cancelAlert();});});}function ja(){var la=q.getCurrentDetailState(),ma=q.getCurrentStateData();if(la==p.DETAIL.RECENT_MESSAGES||la==p.DETAIL.SEARCH_CONTEXT)return ma.thread_id;return null;}function ka(la){var ma=true;d(['ChatTabModel'],function(na){ma&&na.persistLocalRaised();});y.release();g.inform('chat/set_does_page_occlude_tabs',false,g.BEHAVIOR_PERSISTENT);g.inform('chat/set_show_tab_unread_ui',true,g.BEHAVIOR_PERSISTENT);la._masterViewManager.destroy();la._detailViewManager.destroy();ma=false;}e.exports=ia;});
/*1355957874,173213979*/

if (self.CavalryLogger) { CavalryLogger.start_js(["3f4Vl"]); }

__d("BuddyListNub",["event-extensions","Arbiter","AvailableList","BlackbirdUpsell","ChannelConnection","ChannelConstants","ChatConfig","ChatVisibility","Class","CSS","Dock","DOM","HTML","Keys","MercuryConfig","NubController","OrderedFriendsList","PresencePrivacy","Toggler","copyProperties","ge","tx"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('AvailableList'),i=b('BlackbirdUpsell'),j=b('ChannelConnection'),k=b('ChannelConstants'),l=b('ChatConfig'),m=b('ChatVisibility'),n=b('Class'),o=b('CSS'),p=b('Dock'),q=b('DOM'),r=b('HTML'),s=b('Keys'),t=b('MercuryConfig'),u=b('NubController'),v=b('OrderedFriendsList'),w=b('PresencePrivacy'),x=b('Toggler'),y=b('copyProperties'),z=b('ge'),aa=b('tx'),ba=32,ca=10;function da(ea,fa,ga){this.parent.construct(this);this.parent.init(ea);this.root=ea;this.orderedList=fa;this.typeahead=ga;this.button=q.find(ea,'a.fbNubButton');this.label=q.find(ea,'span.label');this.body=q.scry(ea,'div.fbNubFlyoutBody')[0];var ha=q.find(ea,'div.fbNubFlyoutTitlebar');x.createInstance(ha).setSticky(false);fa.subscribe('render',this.flyoutContentChanged.bind(this));fa.setScrollContainer(this.body);h.subscribe('buddylist/availability-changed',this._updateCount.bind(this));g.subscribe('chat/connect',this._handleConnect.bind(this));w.subscribe('privacy-user-presence-changed',this._handleVisibilityChange.bind(this));this.message=q.find(ea,'div.fbDockChatBuddyListNubMessage div.message');this.warningMsgText=null;this.warningMsgEventListener=null;this.showWarningTimeout=null;j.subscribe(j.CONNECTED,this._handleChannelConnected.bind(this));j.subscribe(j.SHUTDOWN,this._handleChannelShutdown.bind(this));j.subscribe(j.RECONNECTING,this._handleChannelReconnecting.bind(this));j.subscribe([j.MUTE_WARNING,j.UNMUTE_WARNING],this._updateView.bind(this));this.subscribe('show',this.onShow.bind(this));this.subscribe('hide',this.onHide.bind(this));this.subscribe('resize',this.onResize.bind(this));Event.listen(ea,'keydown',this._onKeyDown.bind(this));Event.listen(this.button,'click',this.onButtonClick.bind(this));ga.subscribe(['respond','reset'],function(ia,ja){if(this._isOpen){var ka=this.orderedList.isVisible();if(ja&&ja.value&&ja.value===ga.getCore().getValue()&&ga.getView().isVisible()){p.setUseMaxHeight(this.root,false);this.orderedList.hide();}else this._showBuddyList();if(ka!==this.orderedList.isVisible())this.flyoutContentChanged();}}.bind(this));g.subscribe('sidebar/show',this.hide.bind(this));this._orderedListCount=v.getList().length;g.inform('buddylist-nub/initialized',this,g.BEHAVIOR_PERSISTENT);this._handleVisibilityChange();}n.extend(da,u);y(da.prototype,{getButton:function(){return this.button;},getRoot:function(){return this.root;},_handleConnect:function(ea){this._updateView(true);},_getShutdownReason:function(ea){switch(ea){case k.HINT_AUTH:return "Your session has timed out. Please log in.";case k.HINT_CONN:return aa._("Facebook {Chat} is currently unavailable.",{Chat:"Chat"});case k.HINT_MAINT:return aa._("Facebook {Chat} is currently down for maintenance.",{Chat:"Chat"});default:return aa._("Facebook {Chat} is currently unavailable.",{Chat:"Chat"});}},_getReconnectMsg:function(ea){var fa;if(ea===null){fa="Unable to connect to chat. Check your Internet connection.";}else if(ea>l.get('warning_countdown_threshold_msec')){var ga=q.create('a',{href:'#',className:'fbChatReconnectLink'},"Try again"),ha=q.create('div',null,ga),ia=ha.innerHTML;fa=r(aa._("Unable to connect to chat. {try-again-link}",{'try-again-link':ia}));}else if(ea>1000){fa=aa._("Unable to connect to chat. Reconnecting in {seconds}...",{seconds:Math.floor(ea/1000)});}else fa="Unable to connect to chat. Reconnecting...";return fa;},_resetShowWarningTimeout:function(){if(this.showWarningTimeout){clearTimeout(this.showWarningTimeout);this.showWarningTimeout=null;}},_handleChannelConnected:function(ea){this._resetShowWarningTimeout();if(this.orderedList.isVisible())m.goOnline();this.warningMsgText=null;this._updateView();},_handleChannelShutdown:function(ea,fa){this._resetShowWarningTimeout();this.warningMsgText=this._getShutdownReason(fa);this._updateView();},_handleChannelReconnecting:function(ea,fa){this._resetShowWarningTimeout();this.warningMsgText=this._getReconnectMsg(fa);if(fa>1000){if(fa>l.get('warning_countdown_threshold_msec')){if(this.warningMsgEventListener){this.warningMsgEventListener.remove();this.warningMsgEventListener=null;}this.warningMsgEventListener=Event.listen(this.message,'click',function(event){if(o.hasClass(event.getTarget(),'fbChatReconnectLink')){this._tryReconnect();event.kill();}}.bind(this));}this.showWarningTimeout=setTimeout(this._handleChannelReconnecting.bind(this,ea,fa-1000),1000,false);}this._updateView();},_tryReconnect:function(){if(j.disconnected())j.reconnect();},_handleVisibilityChange:function(){this._updateView();if(i.shouldShow()){if(m.hasBlackbirdEnabled()){i.showBlackbirdDialog(this.getButton(),w.getVisibility());}else if(!m.isOnline())i.showOfflineDialog(this.getButton());}else i.hide();if(!m.isOnline())this.hide();},_updateView:function(ea){var fa=z('fbDockChat');o.conditionClass(fa,'offline',!m.isOnline());o.conditionClass(fa,'error',j.disconnected());if(j.disconnected())q.setContent(this.message,this.warningMsgText);if(!m.isOnline()){if(t.ChatControlLanguageChangeGK){this._setLabel(aa._("{Chat} (Off)",{Chat:"Chat"}));}else this._setLabel(aa._("{Chat} (Offline)",{Chat:"Chat"}));}else if(j.disconnected()){this._setLabel(aa._("{Chat} (Disconnected)",{Chat:"Chat"}));}else{var ga=h.getOnlineCount();if(ga){var ha=aa._("{Chat} {number-available}",{Chat:"Chat",'number-available':['<span class="count">','(<strong>',ga,'</strong>)','</span>'].join('')});this._setLabel(r(ha));}else this._setLabel("Chat",ea);}},onButtonClick:function(){this._conditionallyShowTypeahead();if(o.shown(this.typeahead.getElement())){var ea=this.subscribe('show',function(){this.typeahead.getCore().getElement().focus();i.dismiss();}.bind(this));this.unsubscribe.bind(this,ea).defer();}},onHide:function(){this._isOpen=false;if(this._buddyListRenderSubscription){this.orderedList.unsubscribe(this._buddyListRenderSubscription);this._buddyListRenderSubscription=null;}this.orderedList.hide();this.typeahead.getCore().reset();},_onKeyDown:function(event){var ea=Event.getKeyCode(event);if(ea===s.ESC&&!o.hasClass(this.root,'menuOpened')){this.hide();return false;}},onResize:function(){var ea=p.getMaxFlyoutHeight(this.root)-60,fa=Math.max(250,ea);this.orderedList.setNumTopFriends(Math.floor(fa/ba));},_showBuddyList:function(){if(!this._buddyListRenderSubscription)this._buddyListRenderSubscription=this.orderedList.subscribe('render',p.setUseMaxHeight.bind(p,this.root,false));this.orderedList.show();},onShow:function(){this._isOpen=true;if(j.disconnected()){this._tryReconnect();this._showBuddyList();}else m.goOnline(this._showBuddyList.bind(this));},_setLabel:function(ea,fa){var ga=this.label.cloneNode(true);q.setContent(ga,ea);q.replace(this.label,ga);this.label=ga;this.throbber&&o.conditionShow(this.throbber,!!fa);},_conditionallyShowTypeahead:function(){o.conditionShow(this.typeahead.getElement(),this._orderedListCount>=ca);},_updateCount:function(){this._updateView();this._conditionallyShowTypeahead();}});e.exports=da;});
__d("TooltipLink",["Parent","Tooltip"],function(a,b,c,d,e,f){var g=b('Parent'),h=b('Tooltip'),i={setTooltipText:function(j,k){j=g.byTag(j,'a');j&&h.set(j,k);}};e.exports=i;});
__d("ChatOnlineFriends",["event-extensions","AvailableList","AvailableListConstants","ChannelConnection","Chat","ChatConfig","ChatVisibility","Class","CSS","DataStore","DOM","OrderedFriendsList","Parent","Run","ShortProfiles","TooltipLink","XHPTemplate","copyProperties","createObjectFrom","ChatTypeaheadBehavior","ChatTypeaheadCore","ChatTypeaheadDataSource","ChatTypeaheadRenderer","Typeahead"],function(a,b,c,d,e,f){b('event-extensions');var g=b('AvailableList'),h=b('AvailableListConstants'),i=b('ChannelConnection'),j=b('Chat'),k=b('ChatConfig'),l=b('ChatVisibility'),m=b('Class'),n=b('CSS'),o=b('DataStore'),p=b('DOM'),q=b('OrderedFriendsList'),r=b('Parent'),s=b('Run'),t=b('ShortProfiles'),u=b('TooltipLink'),v=b('XHPTemplate'),w=b('copyProperties'),x=b('createObjectFrom');b('ChatTypeaheadBehavior');b('ChatTypeaheadCore');b('ChatTypeaheadDataSource');b('ChatTypeaheadRenderer');b('Typeahead');function y(aa){switch(aa){case h.OFFLINE:return 'chatOffline';case h.IDLE:return 'chatIdle';case h.ACTIVE:return 'chatOnline';case h.MOBILE:return 'chatMobile';}}var z=function(aa,ba,ca,da,ea,fa,ga){var ha=(da&&ea)||(fa&&ga);if(aa&&ba&&ca&&ha)this.init(aa,ba,ca,da,ea,fa,ga);};w(z.prototype,{chatFriends:{},chatStatuses:['chatOnline','chatIdle','chatMobile','chatOffline'],_availableListSubscribe:function(event,aa){this._arbiterTokens.push(g.subscribe(event,aa));},_channelSubscribe:function(event,aa){this._arbiterTokens.push(i.subscribe(event,aa));},onunload:function(){this._arbiterTokens.forEach(function(aa){aa.unsubscribe();});},_setStatus:function(aa,ba){if(n.hasClass(aa,ba))return;this.chatStatuses.forEach(function(ca){n.conditionClass(aa,ca,ca==ba);});},initTypeahead:function(aa,ba,ca){aa.subscribe('reset',function(){n.show(ba);});aa.subscribe('query',function(da,ea){n.conditionShow(ba,!ea.value);});if(ca)aa.subscribe(['query','reset'],function(da){n.conditionShow(ca,da==='reset');});},init:function(aa,ba,ca,da,ea,fa,ga){this.maxElements=aa;this._faceTmpl=ea;this._arbiterTokens=[];this._root=ca;s.onLeave(this.onunload.bind(this));var ha=p.scry(ca,'.chatUpgradeLink');this.initTypeahead(ba,da||fa,ha[0]);var ia=p.find(ca,'.sidebarBtn');Event.listen(ia,'click',function(event){j.toggleSidebar();event.kill();});this._faceFutures&&this._hideAllFaces();this._faceFutures=[];this._orderedFriends=q.getList();this._hashedFriends=x(this._orderedFriends);this._availableListSubscribe(h.ON_AVAILABILITY_CHANGED,this.update.shield(this));this.update.bind(this).defer();this._channelSubscribe(i.CONNECTED,this.update.shield(this));this._channelSubscribe(i.RECONNECTING,this._handleChannelReconnecting.bind(this));this._channelSubscribe(i.SHUTDOWN,this._handleChannelShutdown.bind(this));this._channelSubscribe([i.MUTE_WARNING,i.UNMUTE_WARNING],this.update.shield(this));if(da){this._facepile=da.firstChild;Event.listen(da,'click',this.clickHandler.bind(this));}else{this._miniDivebar=fa;this._divebarTmpl=ga;}Event.listen(p.find(ca,'.fbChatGoOnlineLink'),'click',function(event){if(i.disconnected()){j.openBuddyList();}else l.goOnline(j.openBuddyList);event.kill();}.bind(this));Event.listen(p.find(ca,'.fbChatReconnectLink'),'click',function(event){if(i.disconnected())i.reconnect();event.kill();}.bind(this));g.update();},_updateMiniDivebar:function(){var aa=Math.min(this._orderedFriends.length,10),ba=[];for(var ca=0;ca<aa;ca++)ba.push(this._renderDivebarItem(this._orderedFriends[ca]));p.setContent(this._miniDivebar,ba);},_renderDivebarItem:function(aa){var ba=this._divebarTmpl.build(),ca=ba.getNode('anchor'),da=ba.getNode('status'),ea=g.get(aa);if(ea===h.ACTIVE){n.addClass(da,'active');}else if(ea===h.MOBILE)n.addClass(da,'mobile');t.get(aa,function(fa){ba.setNodeContent('name',fa.name).setNodeProperty('profile-photo','src',fa.thumbSrc);Event.listen(ca,'click',function(){j.openTab(aa,null,'friend','online_friends');return false;});});return ba.getRoot();},_handleChannelReconnecting:function(aa,ba){var ca=(ba<1000),da=p.find(this._root,'.fbChatReconnectLink'),ea=p.find(this._root,'.fbChatReconnecting');n.conditionShow(da,!ca);n.conditionShow(ea,ca);},_handleChannelShutdown:function(){var aa=p.find(this._root,'.fbChatReconnectLink'),ba=p.find(this._root,'.fbChatReconnecting');n.hide(aa);n.hide(ba);},update:function(){var aa=i.disconnected(),ba=l.isOnline();n.conditionClass(this._root,'disconnected',aa);if(this._facepile){n.conditionShow(this._facepile,ba);ba&&this._updateFacepile(aa);}else ba&&this._updateMiniDivebar();var ca=p.find(this._root,'.typeaheadContainer');n.conditionShow(ca,ba);if(k.get('chat_upgrade_link')){var da=p.find(this._root,'.chatUpgradeLink');n.conditionShow(da,ba);}var ea=p.find(this._root,'.chatGoOnlineLink');n.conditionShow(ea,!ba);var fa=p.find(this._root,'.chatReconnectLink');n.conditionShow(fa,ba&&aa);},_updateFacepile:function(aa){g.getAvailableIDs().forEach(function(ha){if(!this._hashedFriends[ha]){this._orderedFriends.push(ha);this._hashedFriends[ha]=true;}}.bind(this));var ba=0;for(var ca=0;ca<this._orderedFriends.length;ca++){var da=this._orderedFriends[ca],ea=g.get(da),fa=this._faceFutures[ca],ga=(aa||ea!==h.OFFLINE)&&(ba<this.maxElements);if(ga){if(!fa){fa=this._makeFace(ca);this._faceFutures[ca]=fa;}ba++;}this._updateFace(fa,ga,y(ea));}},_updateFace:function(aa,ba,ca){aa&&aa(function(da){this._setStatus(da,ca);n.conditionShow(da,ba);}.bind(this));},_makeFace:function(aa){var ba=null,ca=null,da=this._orderedFriends[aa];t.get(da,function(ea){ca=this._faceTmpl.render();o.set(ca,'friendID',da);var fa=v.getNode(ca,'img'),ga=fa.cloneNode(false);ga.setAttribute('src',ea.thumbSrc);p.replace(fa,ga);var ha=v.getNode(ca,'anchor');u.setTooltipText(ha,ea.name);ba&&ba(ca);var ia=false;for(var ja=aa+1;ja<this._orderedFriends.length&&!ia;ja++){var ka=this._faceFutures[ja],la=ka&&ka();if(la){this._facepile.insertBefore(ca,la);ia=true;}}if(!ia)this._facepile.appendChild(ca);}.bind(this));return function ea(fa){if(fa)if(ca){fa(ca);}else ba=fa;return ca;};},clickHandler:function(event){var aa=event.getTarget(),ba=r.byClass(aa,'uiFacepileItem');if(ba){var ca=o.get(ba,'friendID');if(ca&&l.isOnline()){j.openTab(ca,null,'friend','online_friends');return false;}}},_hideAllFaces:function(){this._faceFutures.forEach(function(aa){aa&&aa(function(ba){p.remove(ba);});});}});e.exports=z;});
__d("LiveBarData",["function-extensions","Arbiter","ArbiterMixin","AsyncRequest","ChannelConstants","LayerDestroyOnHide","copyProperties","setTimeoutAcrossTransitions","throttle"],function(a,b,c,d,e,f){b('function-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('AsyncRequest'),j=b('ChannelConstants'),k=b('LayerDestroyOnHide'),l=b('copyProperties'),m=b('setTimeoutAcrossTransitions'),n=b('throttle'),o=false,p={},q={},r={};function s(z){if((z.expires*1000)-Date.now()>0)return true;return false;}function t(z){var aa=z.payload.actions;if(!(aa&&aa.length))return;var ba;for(var ca=0;ca<aa.length;ca++){ba=aa[ca].actor_id;if(!p[ba]||aa[ca].action_id!=p[ba].action_id)continue;if(aa[ca].delete_action||aa[ca].remove){w(aa[ca]);continue;}}}function u(z){var aa=false;for(var ba=0;ba<z.length;ba++){if(z[ba].delete_action||z[ba].remove){w(z[ba]);continue;}var ca=z[ba].actor_id,da=z[ba].action_id;if(p[ca]){if(p[ca].action_id==da)continue;w(p[ca]);}aa=true;p[ca]=z[ba];v(z[ba]);}if(aa)y.inform('new-actions');}function v(z){var aa=(z.expires*1000)-Date.now();q[z.actor_id]=m(w.curry(z),Math.max(0,aa));}function w(z){if(!p[z.actor_id])return;if(p[z.actor_id].action_id!=z.action_id)return;delete p[z.actor_id];var aa=z.actor_id;if(q[aa]){clearTimeout(q[aa]);delete q[aa];}x(aa);y.inform('remove-action',z);}function x(z){var aa=r[z];if(aa){aa.enableBehavior(k);if(!aa.isShown())aa.destroy();delete r[z];}}g.subscribe(j.getArbiterType('livebar_update'),function(z,aa){u(aa.obj.actions);});var y={};l(y,h,{fetch:function(){if(o)return;var z=[];for(var aa in p){var ba=p[aa];if(ba.suppress_callout)continue;if(!r[ba.actor_id])z.push(p[aa]);}if(z.length>0){o=true;new i().setURI('/ajax/chat/livebar.php').setData({actions:z}).setHandler(t).setFinallyHandler(function(){o=false;}).setAllowCrossPageTransition(true).send();}},addActions:u,getAction:function(z){var aa=p[z];if(aa&&s(aa))return aa;return null;},getDialog:function(z){var aa=this.getAction(z);if(aa&&r[aa.actor_id])return r[aa.actor_id];return null;},setDialog:function(z,aa,ba){var ca=p[z];if(ca&&ca.action_id==aa){x(z);r[z]=ba;y.inform('dialog-fetched',z);}}});e.exports=y;});
__d("LiveBar",["event-extensions","function-extensions","ChatConfig","CSS","LiveBarData","$","copyProperties","ge","setTimeoutAcrossTransitions","tx","ChatOrderedList","ContextualDialogX"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('ChatConfig'),h=b('CSS'),i=b('LiveBarData'),j=b('$'),k=b('copyProperties'),l=b('ge'),m=b('setTimeoutAcrossTransitions'),n=b('tx');b('ChatOrderedList');b('ContextualDialogX');var o=g.get('livebar_fetch_defer')||1000;function p(q,r,s){this._orderedList=q;this._root=q.getRoot();this._liveBarTypes=s;this._hoverController=q.getHoverController();this._hoverController.subscribe('hover',this._mouseMove.bind(this));this._hoverController.subscribe('leave',this._mouseLeave.bind(this));q.subscribe('render',this._handleChatListUpdate.shield(this));i.subscribe('new-actions',this._updateIcons.bind(this));i.subscribe('remove-action',this._handleRemoveAction.bind(this));i.subscribe('dialog-fetched',function(t,u){this._setDialogContent(u);}.bind(this));i.addActions(r);}k(p,{setDialog:function(q,r,s){i.setDialog(q,r,s);}});k(p.prototype,{_root:null,_liveBarTypes:null,_hoverController:null,_registrations:{},_renderedIcons:{},_fetchTimer:null,_mouseLeftRoot:false,_chatListRendered:false,_getLiveBarTypes:function(){return this._liveBarTypes;},_handleChatListUpdate:function(){if(!this._chatListRendered){this._chatListRendered=true;this._updateIcons();}},_handleShow:function(q){this._setDialogContent(q);},_mouseMove:function(){if(!this._fetchTimer){this._fetchTimer=m(this._fetch.bind(this),o);this._mouseLeftRoot=false;}},_mouseLeave:function(){this._mouseLeftRoot=true;clearTimeout(this._fetchTimer);this._fetchTimer=null;},_setDialogContent:function(q){var r=i.getDialog(q);if(r)this._hoverController.showHovercard(q,r);},_fetch:function(){if(this._mouseLeftRoot)return;this._fetchTimer=null;i.fetch();},_updateIcons:function(){if(!this._chatListRendered)return;var q=this._orderedList.getAllNodes(),r=this._getLiveBarTypes();for(var s in q){var t=i.getAction(s);if(t&&(!this._renderedIcons[s]||this._renderedIcons[s]!=t.action_id)){for(var u=0;u<r.length;u++)h.removeClass(q[s],r[u]);h.addClass(q[s],t.livebar_type);this._renderedIcons[s]=t.action_id;var v=this._hoverController.register(s,this._handleShow.bind(this));if(v)this._registrations[s]=v;}}},_handleRemoveAction:function(q,r){var s=r.action_id,t=r.actor_id;this._registrations[t]&&this._registrations[t].unregister();delete this._registrations[t];if(this._renderedIcons[t]==s){var u=this._getLiveBarTypes(),v=this._orderedList.getAllNodes();if(v[t])for(var w=0;w<u.length;w++)h.removeClass(v[t],u[w]);delete this._renderedIcons[t];}}});e.exports=p;});
__d("LiveBarDark",["Class","LiveBar","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('Class'),h=b('LiveBar'),i=b('copyProperties'),j=b('emptyFunction');function k(l,m,n){this.parent.construct(this,l,m,n);}g.extend(k,h);i(k.prototype,{_setupDialogContent:j,_show:j,_updateIcons:j,_handleRemoveAction:j,_handleChatListUpdate:j});e.exports=k;});
__d("ChatSidebarDropdown",["Arbiter","AsyncRequest","Chat","ChatOptions","ChatVisibility","CSS","DOM","JSLogger","PresenceState","Selector","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('Chat'),j=b('ChatOptions'),k=b('ChatVisibility'),l=b('CSS'),m=b('DOM'),n=b('JSLogger'),o=b('PresenceState'),p=b('Selector'),q=b('copyProperties');function r(s){this._root=s;this._logger=n.create('blackbird');this._displayBrowserNotificationsIfNeeded();p.listen(s,'select',this._onSelect.bind(this));p.listen(s,'toggle',this._onToggle.bind(this));g.subscribe('chat/option-changed',this._onOptionChanged.bind(this));}q(r.prototype,{changeSetting:function(s,t){if(this._pendingChange)return false;this._pendingChange=true;var u={};u[s]=t;j.setSetting(s,t,'sidebar_menu');new h('/ajax/chat/settings.php').setHandler(this._onChangeSettingResponse.bind(this,s,t)).setErrorHandler(this._onChangeSettingError.bind(this,s,t)).setFinallyHandler(this._onChangeFinally.bind(this)).setData(u).setAllowCrossPageTransition(true).send();},_displayBrowserNotificationsIfNeeded:function(){if(window.webkitNotifications){m.scry(document,'li.sidebar-browser-notif').forEach(l.show);if(window.webkitNotifications.checkPermission()!==0)m.scry(document,'li.sidebar-browser-notif').forEach(function(s){l.removeClass(s,'checked');});}},_conditionEnabled:function(s,t){var u=p.getOption(this._root,s);u&&p.setOptionEnabled(u,t);},_onChangeSettingResponse:function(s,t,u){o.doSync();},_onChangeSettingError:function(s,t,u){j.setSetting(s,!t,'sidebar_menu_error');},_onChangeFinally:function(){this._pendingChange=false;},_onOptionChanged:function(s,t){var u=t.name,v=t.value;if(u==='sound'||u==='browser_notif'){var w=p.getOption(this._root,u);if(v!==p.isOptionSelected(w))p.setSelected(this._root,u,v);}},_onSelect:function(s){if(this._pendingChange)return false;var t=false,u=false,v=p.getOptionValue(s.option);switch(v){case 'sidebar':return this.toggleSidebar();case 'online':if(!k.isOnline()){k.goOnline();}else u=true;t=true;break;case 'offline':if(k.isOnline()){k.goOffline();}else u=true;t=true;break;case 'advanced_settings':g.inform('chat/advanced-settings-dialog-opened');t=true;break;}if(u){this._logger.error('sidebar_dropdown_visibility_error',{action:v});}else this._logger.log('sidebar_dropdown_set_visibility',{action:v});if(t){p.toggle(this._root);return false;}},_onToggle:function(s){if(this._pendingChange)return false;var t=p.getOptionValue(s.option),u=p.isOptionSelected(s.option);switch(t){case 'visibility':if(!k){this._jslogger.error('on_toggle_visibility_undefined');return;}k.toggleVisibility();this._logger.log('sidebar_dropdown_toggle_visibility',{available:u});break;case 'browser_notif':if(u&&window.webkitNotifications&&window.webkitNotifications.checkPermission()!==0){window.webkitNotifications.requestPermission(function(){this.changeSetting(t,u);}.bind(this));}else this.changeSetting(t,u);break;case 'sound':this.changeSetting(t,u);break;}p.toggle(this._root);},_onVisibilityChanged:function(){var s=k.isOnline(),t=p.getOption(this._root,'visibility');if(s!==p.isOptionSelected(t))p.setSelected(this._root,'visibility',s);},toggleSidebar:function(){i.toggleSidebar();p.toggle(this._root);return false;}});e.exports=r;});
__d("FbdEventLog",["URI","AsyncSignal"],function(a,b,c,d,e,f){var g=b('URI'),h=b('AsyncSignal'),i={log:function(j,k,l,m){if(!j)return;var n=g('/desktop/eventlog.php'),o=new h(n.toString(),{event:j,category:k||'unknown',payload:l||''});o.setHandler(m).send();}};e.exports=i;});
__d("ModalMask",["DOM","Vector"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('Vector'),i=null,j=0,k={show:function(){j++;if(!i){i=g.create('div',{id:'modalMaskOverlay'});g.appendContent(document.body,i);}},hide:function(){if(j){j--;if(!j&&i){g.remove(i);i=null;}}}};e.exports=k;});
__d("DownloadDialog",["event-extensions","Arbiter","Class","CSS","DataStore","ModalMask","Overlay","Parent","Style","copyProperties","emptyFunction"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('Class'),i=b('CSS'),j=b('DataStore'),k=b('ModalMask'),l=b('Overlay'),m=b('Parent'),n=b('Style'),o=b('copyProperties'),p=b('emptyFunction');function q(){this.parent.construct(this);return this;}h.extend(q,l);o(q,{POSITIONS:{BOTTOM_LEFT:'bottom_left',TOP_LEFT:'top_left',IE9_BOTTOM:'ie9_bottom'},activeDialogs:{},dismissAll:function(){for(var r in this.POSITIONS)this.hideDialog(this.POSITIONS[r]);},hideDialog:function(r){var s=this.activeDialogs[r];s&&s.hide();this.activeDialogs[r]=null;}});o(q.prototype,{_cancelHandler:p,_closeHandler:p,_width:null,position:q.POSITIONS.BOTTOM_LEFT,init:function(r,s){this.parent.init(r);this.position=s;var t=(j.get(this._root,'modal')==='true');q.hideDialog(s);q.activeDialogs[s]=this;Event.listen(this._root,'click',function(event){if(m.byClass(event.getTarget(),'closeButton'))if(this._cancelHandler()!==false)q.hideDialog(this.position);}.bind(this));this.subscribe('show',function(){if(t)k.show();g.inform('layer_shown',{type:'DownloadDialog'});}.bind(this));this.subscribe('hide',function(){if(t)k.hide();g.inform('layer_hidden',{type:'DownloadDialog'});this._closeHandler();}.bind(this));},setWidth:function(r){this._width=Math.floor(r);return this;},updatePosition:function(){if(this._width)n.set(this._overlay,'width',this._width+'px');return true;},setCancelHandler:function(r){this._cancelHandler=r||p;return this;},setCloseHandler:function(r){this._closeHandler=r||p;return this;}});e.exports=q;});
__d("FbdConversionTracking",["AsyncRequest","emptyFunction"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('emptyFunction'),i={logClick:function(j,k){if(!k)k='desktop';new g().setURI('/ajax/desktop/log_clicks.php').setData({click_source:j,promo:k}).setAllowCrossPageTransition(true).setErrorHandler(h).send();},logConversion:function(j,k){if(!k)k='desktop';new g().setURI('/ajax/desktop/log_conversions.php').setData({conversion_action:j,promo:k}).setAllowCrossPageTransition(true).setErrorHandler(h).send();}};e.exports=i;});
__d("MegaphoneHelper",["Animation","AsyncRequest","Dialog","ge"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('AsyncRequest'),i=b('Dialog'),j=b('ge'),k={hideStory:function(l,m,n,o,p){var q={mp_id:l,location:m,context:o};new h().setURI('/ajax/megaphone/megaphone_hide.php').setMethod('POST').setData(q).setHandler(function(s){p&&p(s);}).send();var r=j(n);if(r)g(r).to('height',0).duration(500).hide().go();},createModalStory:function(l,m,n,o){var p;if(!l.buttons||!l.buttons.length){l.buttons=i.CLOSE;p=this.hideStory.bind(this,m,n,o,null);}var q=new i(l);if(p)q.setHandler(p);q.show();},buttonOnClick:function(l,m,n,o,p,q){var r=function(){if(p){new h().setURI(o).send();}else document.location.href=o;};if(q){this.hideStory(l,m,'',n,function(){r();});}else r();}};e.exports=k;});
__d("FbdInstall",["$","AsyncRequest","CSS","DOM","DownloadDialog","FbdConversionTracking","FbdEventLog","FBDesktopDetect","FBDesktopPlugin","MegaphoneHelper"],function(a,b,c,d,e,f){var g=b('$'),h=b('AsyncRequest'),i=b('CSS'),j=b('DOM'),k=b('DownloadDialog'),l=b('FbdConversionTracking'),m=b('FbdEventLog'),n=b('FBDesktopDetect'),o=b('FBDesktopPlugin'),p=b('MegaphoneHelper'),q=1000,r=300*q,s={cancelSetup:function(){var t=JSON.stringify({ref:this.ref});m.log('download_canceled','setup',t);l.logConversion('download_canceled');},hideMegaphone:function(){if(this.megaphoneId&&this.megaphoneLoc)p.hideStory(this.megaphoneId,this.megaphoneLoc,this.elementId,'',null);},init:function(t,u){this.downloadUrl=t;this.ref=u||'unknown';},initInstallWait:function(t,u,v){this.megaphoneId=t;this.megaphoneLoc=u;this.elementId=v;this._waitForInstall(r);},promptDownload:function(t){t=t||this.downloadUrl;if(t){var u=JSON.stringify({ref:this.ref});m.log('download_prompted','setup',u);l.logConversion('download_prompted');var v=j.create('iframe',{src:t,className:'hidden_elem'});j.appendContent(document.body,v);}},_responseHandler:function(t){if(t.payload){this._authToken=t.payload.access_token;this._userId=t.payload.id;}if(this._authToken&&this._userId){this._waitForRunningStart=new Date().getTime();setTimeout(this._waitForRunning.bind(this),q);}},setupPlugin:function(){new h('/ajax/desktop/download').send();this.promptDownload();},updateSidebarLinkVisibility:function(){if(!n.isPluginInstalled()){i.show(g('sidebar-messenger-install-link'));i.show(g('sidebar-messenger-install-separator'));}},_waitForInstall:function(t){var u=JSON.stringify({ref:this.ref});if(n.isPluginInstalled()){m.log('install_success','setup',u);l.logConversion('install_success');o.recheck();new h("/desktop/fbdesktop2/transfer.php").setMethod("POST").setHandler(this._responseHandler.bind(this)).send();k.dismissAll();this.hideMegaphone();return;}if(t<=0){m.log('install_timeout','setup',u);l.logConversion('install_timeout');k.dismissAll();}else setTimeout(this._waitForInstall.bind(this,t-q),q);},_waitForRunning:function(){var t=new Date().getTime()-this._waitForRunningStart;if(o.isAppRunning()){o.transferAuthToken(this._authToken,this._userId);}else if(t<r)setTimeout(this._waitForRunning.bind(this),q);}};e.exports=s;});
__d("legacy:fbdesktop2-install-js",["FbdInstall"],function(a,b,c,d){a.FbdInstall=b('FbdInstall');},3);
__d("legacy:fbdesktop-conversion-tracking",["FbdConversionTracking"],function(a,b,c,d){a.FbdConversionTracking=b('FbdConversionTracking');},3);
__d("AppRequestReminders",["AsyncRequest","CSS","DOM","ge"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('CSS'),i=b('DOM'),j=b('ge'),k=0,l={},m=1,n=j('OtherAppReqReminder'),o=function(u,v,w){l[v]={node:u,seq:m++,reqCount:w};},p=function(u){k=u;},q=function(u){return u.id.split('_')[1];},r=function(u){var v=j(u),w=v.nextSibling;if(w!==n){h.show(w);k-=l[q(w)].reqCount;}s(k);},s=function(u){new g().setURI('/ajax/reminders/update_count.php').setData({new_count:u}).setMethod('POST').send();},t=function(u,v){if(n&&v&&u>0){i.setContent(j('OtherAppReqLabel'),v);}else if(n){h.hide(n);}else h.hide(j('OtherAppReqReminder'));};f.initNode=o;f.handleRemove=r;f.updateCount=t;f.setTotalOtherCount=p;});
__d("SidebarTicker",["Arbiter","AsyncRequest","ChatSidebar","CSS","DOM","Run","SimpleDrag","TickerController","$","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('ChatSidebar'),j=b('CSS'),k=b('DOM'),l=b('Run'),m=b('SimpleDrag'),n=b('TickerController'),o=b('$'),p=b('copyProperties'),q=1e-07;function r(s){this._ticker=o('pagelet_ticker');this._initSubscriptions();if(j.hasClass(document.documentElement,'sidebarMode'))this._onSidebarShow();this._initResizeBehavior(s);}r.hide=function(){l.onAfterLoad(function(){k.remove(o('pagelet_ticker'));k.remove(k.find(document.body,'div.fbSidebarGripper'));i.resize();});};p(r.prototype,{_initResizeBehavior:function(s){var t=this._ticker,u=t.parentNode,v=this._saveResizedState.bind(this),w,x,y,z=function(ca,event){w=event.clientY;x=t.offsetHeight;y=u.offsetHeight;},aa=function(ca,event){var da=x+(event.clientY-w),ea=100-(((y-da)/y)*100);ea=Math.max(q,Math.min(90,ea));t.style.height=ea+'%';if(ca=='end'){v(ea);g.inform('Ticker/resized');}i.resize();},ba=new m(s);ba.subscribe('start',z);ba.subscribe(['update','end'],aa);},_saveResizedState:function(s){new h('/ajax/feed/ticker/resize').setData({height:''+s}).setMethod('POST').send();},_initSubscriptions:function(){this._subscriptions=[g.subscribe('sidebar/show',this._onSidebarShow.bind(this))];},_onSidebarShow:function(){n.show(this._ticker);}});e.exports=r;});
__d("MercuryLeftNavCountControl",["Arbiter","MercuryConstants","CSS","DOM","MercuryServerRequests","MercuryThreadInformer","MercuryUnreadState","URI","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('MercuryConstants'),i=b('CSS'),j=b('DOM'),k=b('MercuryServerRequests'),l=b('MercuryThreadInformer'),m=b('MercuryUnreadState'),n=b('URI'),o=b('copyProperties'),p,q,r=function(s,t){p=s;q=t;this.render();this.listenerToken=l.subscribe('unread-updated',this.render.bind(this));this.subscriptions=[g.subscribe('onload/exit',this.cleanup.bind(this))];};o(r.prototype,{render:function(){var s=m.exceedsMaxCount(h.MessagingTag.INBOX);if(s){j.setContent(p,h.MercuryThreadlistConstants.MAX_UNREAD_COUNT);}else{var t=m.getUnreadCount(h.MessagingTag.INBOX);j.setContent(p,t.toString());i.conditionClass(p.parentNode,'hidden_elem',t<=0);}j.setContent(q,s?'+':'');},cleanup:function(){this.subscriptions.forEach(g.unsubscribe);l.unsubscribe(this.listenerToken);}});e.exports=r;});
__d("MercuryLeftNav",["DOM","MercuryServerRequests","MercuryLeftNavCountControl"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('MercuryServerRequests'),i=b('MercuryLeftNavCountControl');e.exports=function(j,k){h.handleUpdate(k);var l=g.scry(j,'span.countValue')[0],m=g.scry(j,'span.maxCountIndicator')[0],n=new i(l,m);};});
__d("legacy:CounterDisplay",["CounterDisplay"],function(a,b,c,d){a.CounterDisplay=b('CounterDisplay');},3);
function startMessagingNavCountUpdater(a){var b=FutureSideNav.getInstance().getNodeForKey('inbox');if(!b)return;var c=FutureSideNav.getInstance().getNodeForKey('other'),d=DOM.scry(c,'span.count')[0],e=DOM.scry(d,'span.countValue')[0],f=DOM.scry(d,'span.maxCountIndicator')[0];new CounterMaxDisplay('other_unseen',e,d,null,null,true).setMaxCounter(a,f);}function CounterMaxDisplay(){this._maxValue=null;this._maxIndicatorNode=null;var a=[this].concat($A(arguments));return this.parent.construct.apply(this.parent,a);}Class.extend(CounterMaxDisplay,'CounterDisplay');copyProperties(CounterMaxDisplay.prototype,{setMaxCounter:function(a,b){this._maxValue=a;this._maxIndicatorNode=b;},paint:function(){var a=this._maxValue&&this._count>this._maxValue,b=a?this._maxValue:this._count;if(this._maxIndicatorNode){DOM.setContent(this._maxIndicatorNode,a?'+':'');}else if(a)b=b+'+';DOM.setContent(this._valueNode,b);this._toggleNodes();}});
__d("ReminderStory",["event-extensions","DOMQuery"],function(a,b,c,d,e,f){b('event-extensions');var g=b('DOMQuery');function h(i,j){Event.listen(i,'click',function(k){j.show();});j.subscribe('aftershow',function(){var k=j.getRoot(),l=g.scry(k,'.inlineReplyTextArea');if(l.length>0)l[0].focus();});}e.exports=h;});
__d("CalendarUI",["event-extensions","Arbiter","AsyncRequest","CSS","DOM","DOMPosition","DOMQuery","DOMScroll","Hovercard","Parent","Run","ScrollAwareDOM","Style","UIPagelet","Vector","ViewportBounds","$","copyProperties","ge","goURI"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('AsyncRequest'),i=b('CSS'),j=b('DOM'),k=b('DOMPosition'),l=b('DOMQuery'),m=b('DOMScroll'),n=b('Hovercard'),o=b('Parent'),p=b('Run'),q=b('ScrollAwareDOM'),r=b('Style'),s=b('UIPagelet'),t=b('Vector'),u=b('ViewportBounds'),v=b('$'),w=b('copyProperties'),x=b('ge'),y=b('goURI');function z(){}w(z,{EVENT_ACTION:'EVENT_ACTION',SUGGESTIONS_LOADED:'SUGGESTIONS_LOADED',HIDE_SUGGESTED_EVENT:'HIDE_SUGGESTED_EVENT',_todayButton:null,_todayElement:null,_registeredReminders:false,init:function(){g.subscribe(this.EVENT_ACTION,function(){s.loadFromEndpoint('CalendarHeaderPagelet','pagelet_calendar_header');if(x('pagelet_calendar_invites'))s.loadFromEndpoint('CalendarInvitesPagelet','pagelet_calendar_invites');});var aa=u.addTop(function(){var ba=x('pagelet_calendar_header');if(ba&&r.isFixed(ba.firstChild)){var ca=ba.firstChild.getBoundingClientRect();return ca.bottom;}return 0;});p.onLeave(function(){aa.remove();});},initGridItem:function(aa,ba){Event.listen(aa,'click',function(event){if(o.byTag(event.getTarget(),'a'))return;h.bootstrap(ba,aa.firstChild);return;});},initGridItemList:function(aa,ba,ca){g.subscribe(this.SUGGESTIONS_LOADED,function(da,ea){if(ba==ea.timestamp)for(var fa=0;fa<ca&&fa<ea.content.length;fa++)j.appendContent(aa,ea.content[fa]);});},initScrollItem:function(aa,ba){Event.listen(aa,'click',this.scrollTo.bind(this,ba));},scrollTo:function(aa,ba){aa=l.isNode(aa)?aa:x(aa);var ca=0;if(aa){var da=t.getElementPosition(v('fbCalendarWrapper')).y,ea=t.getElementPosition(aa).y;ca=ea-da;}else ca=t.getElementPosition(v('bottomContent')).y;m.scrollTo(new t(0,ca,'document'),ba!==false);},registerHomepageReminders:function(){if(!this._registeredReminders){g.subscribe(this.EVENT_ACTION,function(aa,ba){if(x('pagelet_reminders'))s.loadFromEndpoint('RemindersPagelet','pagelet_reminders');});this._registeredReminders=true;}},registerTodayClickHandler:function(){this._todayButton.onclick=null;Event.listen(this._todayButton,'click',this.scrollTo.bind(this,this._todayElement));},registerTodayElement:function(aa){this._todayElement=l.isNode(aa)?aa:x(aa);this._todayButton&&this.registerTodayClickHandler();},registerTodayButton:function(aa){this._todayButton=aa;this._todayElement&&this.registerTodayClickHandler();},registerEventLink:function(aa,ba){g.subscribe(this.EVENT_ACTION,function(ca,da){if(da.eid===ba){var ea=l.scry(v("facebook"),".fbCalendarSuggestedLabel");if(ea.length>0)i.addClass(ea[0],"hidden_elem");switch(da.action){case 'GOING':i.removeClass(aa.parentNode,"hidden_elem");i.removeClass(aa,"fbCalendarEventSuggested");i.addClass(aa,"fbCalendarEventGoing");break;case 'MAYBE':i.removeClass(aa.parentNode,"hidden_elem");i.removeClass(aa,"fbCalendarEventSuggested");i.removeClass(aa,"fbCalendarEventGoing");break;case 'DECLINED':case 'HIDDEN':n.hide(true);i.addClass(aa.parentNode,"hidden_elem");break;case 'EDITED':if(da.name)j.setContent(aa,da.name);if(da.day){var fa=x("pagelet_calendar_day_"+da.day);if(fa){var ga=l.find(fa,".fbCalendarGridEventList");if(l.scry(ga,"li").length>=4){i.addClass(aa.parentNode,"hidden_elem");s.loadFromEndpoint("CalendarDayPagelet","pagelet_calendar_day_"+da.day,{day:da.timestamp});}else j.prependContent(ga,aa.parentNode);}else i.addClass(aa.parentNode,"hidden_elem");}break;}}});},informEventGoing:function(aa){g.inform(this.EVENT_ACTION,{eid:aa,action:'GOING'});},informEventMaybe:function(aa){g.inform(this.EVENT_ACTION,{eid:aa,action:'MAYBE'});},informEventDeclined:function(aa){g.inform(this.EVENT_ACTION,{eid:aa,action:'DECLINED'});},informEventHidden:function(aa){g.inform(this.EVENT_ACTION,{eid:aa,action:'HIDDEN'});},informEventEdited:function(aa,ba,ca,da){g.inform(this.EVENT_ACTION,{eid:aa,action:'EDITED',name:ba,day:ca,timestamp:da});},informSuggestionsAdded:function(aa,ba){g.inform(this.SUGGESTIONS_LOADED,{timestamp:aa,content:ba});},removeCalendarListHeader:function(aa){var ba=j.scry(aa,"^.fbCalendarList .fbCalendarItem"),ca=j.find(aa,"^.fbCalendarItem");if(ba.length==1)ca=j.find(aa,"^.fbCalendarList");j.remove(ca);},reloadPage:function(){y(window.location);},unhide:function(aa){!function(){q.monitor(aa.nextSibling,i.show.curry(aa));}.defer();}});e.exports=z;});
__d("CanvasAppRequestUpdater",["Arbiter","CSS","ChannelConstants","DOM","copyProperties","csx"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('CSS'),i=b('ChannelConstants'),j=b('DOM'),k=b('copyProperties'),l=b('csx');function m(n){this._root=n;g.subscribe(i.getArbiterType('app_request_create'),function(o,p){var q=j.scry(this._root,".item_"+p.obj.appid)[0],r=q&&j.scry(q,"._1k71")[0];r&&j.appendContent(r,p.obj.request);q&&this._updateBookmark(q,1);}.bind(this));g.subscribe(i.getArbiterType('app_request_delete'),function(o,p){var q=j.scry(this._root,".item_"+p.obj.appid)[0],r=q&&j.scry(q,"[data-requestid='"+p.obj.requestid+"']")[0];r&&j.remove(r.parentElement);q&&this._updateBookmark(q,-1);}.bind(this));}k(m.prototype,{_updateBookmark:function(n,o){var p=j.find(n,"._1k72"),q=j.find(n,'.countValue'),r=parseInt(j.getText(q),10),s=Math.max(0,r+o);j.setContent(q,s);if(s<1){h.hide(q.parentElement);h.hide(p);}else{h.show(q.parentElement);h.show(p);}}});e.exports=m;});
__d("CanvasFlyoutLoader",["event-extensions","AsyncRequest"],function(a,b,c,d,e,f){b('event-extensions');var g=b('AsyncRequest'),h={endpoint:'/ajax/canvas/flyouts',init:function(i,j,k){this.root=i;this.largeApps=j;this.seeAllApps=k;this.handler=Event.listen(i,'mouseenter',this.loadFlyouts.shield(this));},loadFlyouts:function(){this.handler.remove();this.handler=null;var i={items:this.largeApps,all_apps:this.seeAllApps};new g().setURI(this.endpoint).setRelativeTo(this.root).setMethod('post').setReadOnly(true).setData(i).setAllowCrossPageTransition(true).send();}};e.exports=h;});
__d("CanvasRecommendationFlyoutLoader",["event-extensions","AsyncRequest"],function(a,b,c,d,e,f){b('event-extensions');var g=b('AsyncRequest'),h={endpoint:'/ajax/canvas/recommendation/flyouts',init:function(i,j){this.root=i;this.apps=j;this.handler=Event.listen(i,'mouseenter',this.loadFlyouts.shield(this));},loadFlyouts:function(){this.handler.remove();this.handler=null;var i={items:this.apps};new g().setURI(this.endpoint).setRelativeTo(this.root).setMethod('post').setReadOnly(true).setData(i).setAllowCrossPageTransition(true).send();}};e.exports=h;});
window.init_live_message_receive=window.init_live_message_receive||function(a){window.init_live_message_receive=emptyFunction;Arbiter.subscribe(ChannelConstants.getArbiterType('app_msg'),function(b,c){if(c.obj.event_name=='beep_event'){Bootloader.loadComponents('beeper',function(){Beeper.ensureInitialized();Beeper.setParams(a);LiveMessageReceiver.route(c.obj);});}else LiveMessageReceiver.route(c.obj);});};
__d("legacy:megaphone",["MegaphoneHelper"],function(a,b,c,d){a.MegaphoneHelper=b('MegaphoneHelper');},3);
__d("FbdPromo",["event-extensions","Arbiter","AsyncRequest","ChatSidebar","copyProperties","CSS","DOM","FbdConversionTracking","FBDesktopDetect","FbdInstall"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('AsyncRequest'),i=b('ChatSidebar'),j=b('copyProperties'),k=b('CSS'),l=b('DOM'),m=b('FbdConversionTracking'),n=b('FBDesktopDetect'),o=b('FbdInstall'),p="show",q="install",r="cancel",s="learn_more";function t(u,v,w){this._root=u;Event.listen(l.find(u,'.install-button'),'click',this.installClick.bind(this,v));Event.listen(l.find(u,'.learn-more'),'click',this.learnMoreClick.bind(this));Event.listen(l.find(u,'.promo-close-button'),'click',this.cancelClick.bind(this));this.type=w;this.showPromo();}j(t.prototype,{cancelClick:function(){this.hidePromo();this.postPromoAction(r);},hidePromo:function(u){k.hide(this._root);i.resize();},installClick:function(u){o.init(u,this.type);o.setupPlugin();this.postPromoAction(q);setTimeout(function(){this.hidePromo();}.bind(this),3000);},learnMoreClick:function(){this.postPromoAction(s);},postPromoAction:function(u){new h("/ajax/desktop/promo_action.php").setMethod("POST").setData({action:u,type:this.type}).send();m.logClick(this.type+'_promo_'+u);},showPromo:function(){if(n.isPluginInstalled())return;k.show(this._root);if(i.isVisible()){this.postPromoAction(p);}else{var u=true;g.subscribe('sidebar/show',function(){if(u){u=false;this.postPromoAction(p);}}.bind(this));}}});e.exports=t;});
/*1355713616,178142515*/

if (self.CavalryLogger) { CavalryLogger.start_js(["ZQxoq"]); }

__d("PopoverMenuInterface",["Arbiter","ArbiterMixin","Class","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('Class'),j=b('copyProperties'),k=b('emptyFunction');function l(){}j(l.prototype,h,{getRoot:k,onShow:k,onHide:k,focusAnItem:k.thatReturnsFalse,blur:k,handleKeydown:k.thatReturnsFalse,done:function(){this.inform('done');}});e.exports=l;});
__d("MenuX",["event-extensions","Class","copyProperties","CSS","DataStore","DOM","HTML","Keys","Parent","PopoverMenuInterface","ScrollableArea","Style","UserAgent"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Class'),h=b('copyProperties'),i=b('CSS'),j=b('DataStore'),k=b('DOM'),l=b('HTML'),m=b('Keys'),n=b('Parent'),o=b('PopoverMenuInterface'),p=b('ScrollableArea'),q=b('Style'),r=b('UserAgent');function s(t,u,v,w){this.parent.construct(this);this._id=t;this._className=u;this._items=[];for(var x=0;x<v.length;x++)this._items[x]=new v[x].ctor(v[x]);this._config=w;}g.extend(s,o);h(s.prototype,{_focused:null,_root:null,addItem:function(t){this._items.push(t);if(this._root)this._insertItem(t);},getRoot:function(){if(!this._root)this._render();return this._root;},onShow:function(){if(this._config.maxheight)if(!this._scrollableArea){q.set(this._scrollableElems.root,'width',this._scrollableElems.body.offsetWidth+'px');this._scrollableArea=p.fromNative(this._scrollableElems.root,{fade:true});q.set(this._scrollableElems.wrap,'max-height',this._config.maxheight+'px');}else{q.set(this._scrollableElems.root,'width','');q.set(this._scrollableElems.content,'width','');if(r.ie()<=7){q.set(this._scrollableElems.root,'width',this._scrollableElems.content.offsetWidth+'px');}else q.set(this._scrollableElems.root,'width',this._scrollableElems.content.offsetWidth+'px');this._scrollableArea.resize();}},onHide:function(){this.blur();},focusAnItem:function(){return this._attemptFocus(0,1);},blur:function(){if(this._focused){this._focused.blur();this._focused=null;this.inform('blur');}},handleKeydown:function(t){var u=this._items.indexOf(this._focused);switch(t){case m.UP:case m.DOWN:var v=t===m.UP?-1:1;if(u!==-1){return this._attemptFocus(u+v,v);}else if(t===m.UP){return this._attemptFocus(this._items.length-1,-1);}else return this._attemptFocus(0,1);break;case m.SPACE:if(this._items.indexOf(this._focused)!==-1){this._handleItemClick(this._focused);return true;}return false;default:var w=String.fromCharCode(t).toLowerCase(),x;for(var y=u+1;y<this._items.length;y++){x=this._items[y].getAccessKey();if(x&&x.charAt(0).toLowerCase()===w)if(this._focusItem(this._items[y]))return true;}return false;}},_render:function(){this._ul=k.create('ul',{className:'uiMenuX'});this._ul.setAttribute('role','menu');this._items.forEach(this._insertItem.bind(this));Event.listen(this._ul,'click',this._handleClick.bind(this));Event.listen(this._ul,'mouseover',this._handleMouseOver.bind(this));Event.listen(this._ul,'mouseout',this._handleMouseOut.bind(this));var t=this._ul;if(this._config.maxheight){this._scrollableElems=p.renderDOM();k.setContent(this._scrollableElems.content,this._ul);t=this._scrollableElems.root;}var u='uiMenuXWrapper'+(this._className?' '+this._className:'');this._root=k.create('div',{className:u},k.create('div',{className:'uiMenuXBorder'},t));this._id&&this._root.setAttribute('id',this._id);},_handleClick:function(t){var u=this._getItemInstance(t.getTarget());if(u)return this._handleItemClick(u);},_handleItemClick:function(t){this.inform('itemclick',t);if(t.hasAction())this.done();return t.handleClick();},_handleMouseOver:function(t){var u=this._getItemInstance(t.getTarget());u&&this._focusItem(u);},_handleMouseOut:function(t){var u=this._getItemInstance(t.getTarget());if(u&&this._focused===u)this.blur();},_insertItem:function(t){var u=t.getRoot();i.addClass(u,'__MenuXItem');j.set(u,'MenuXItem',t);k.appendContent(this._ul,u);},_attemptFocus:function(t,u){var v=this._items[t];if(v)if(this._focusItem(v)){return true;}else return this._attemptFocus(t+u,u);return false;},_focusItem:function(t){if(t.focus()!==false){if(this._focused!==t){this.blur();this._focused=t;this.inform('focus');}return true;}return false;},_getItemInstance:function(t){var u=n.byClass(t,'__MenuXItem');return u?j.get(u,'MenuXItem'):null;}});e.exports=s;});
__d("MenuXSelectableItem",["Class","copyProperties","CSS","MenuXItem"],function(a,b,c,d,e,f){var g=b('Class'),h=b('copyProperties'),i=b('CSS'),j=b('MenuXItem');function k(l){this.parent.construct(this,l);}g.extend(k,j);h(k.prototype,{_selected:false,getLabel:function(){return this._data.label;},getIcon:function(){return this._data.icon;},isSelected:function(){return this._selected;},select:function(){i.addClass(this._root,'checked');this._selected=true;},deselect:function(){i.removeClass(this._root,'checked');this._selected=false;},render:function(){var l=this.parent.render();if(this._data.selected){i.addClass(l,'checked');this._selected=true;}return l;}});e.exports=k;});
__d("Popover",["event-extensions","Arbiter","ArbiterMixin","ContextualLayer","ContextualLayerHideOnScroll","CSS","DataStore","DOM","Input","KeyStatus","LayerHideOnEscape","Toggler","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('ContextualLayer'),j=b('ContextualLayerHideOnScroll'),k=b('CSS'),l=b('DataStore'),m=b('DOM'),n=b('Input'),o=b('KeyStatus'),p=b('LayerHideOnEscape'),q=b('Toggler'),r=b('copyProperties');q.subscribe(['show','hide'],function(t,u){var v=l.get(u.getActive(),'Popover');if(v)if(t==='show'){v.showLayer();}else v.hideLayer();});function s(t,u,v,w){this._root=t;this._triggerElem=u;this._behaviors=v;this._config=w;if(!(u.nodeName==='A'&&u.rel==='toggle'))Event.listen(u,'click',function(){q.bootstrap(u);});u.setAttribute('role','button');l.set(t,'Popover',this);}r(s.prototype,h,{_layer:null,_closeListener:null,ensureInit:function(){if(!this._layer)this._init();},showLayer:function(){this.ensureInit();this._layer.show();q.show(this._root);k.addClass(this._root,'selected');this.inform('show');this._triggerElem.setAttribute('aria-expanded','true');},getLayer:function(){return this._layer;},hideLayer:function(){this._layer.hide();this._triggerElem.setAttribute('aria-expanded','false');},isShown:function(){return this._layer.isShown();},setLayerContent:function(t){this.ensureInit();this._layer.setContent(t);},_init:function(){var t=new i({context:this._triggerElem,position:'below'},m.create('div'));t.enableBehaviors([j,p]);q.createInstance(t.getRoot()).setSticky(false);t.subscribe('hide',this._onLayerHide.bind(this));this._behaviors&&t.enableBehaviors(this._behaviors);this._layer=t;if(this._config.alignh)this._layer.setAlignment(this._config.alignh);if(this._config.layer_content)this._layer.setContent(this._config.layer_content);this.inform('init',null,g.BEHAVIOR_PERSISTENT);},_onLayerHide:function(){q.hide(this._root);k.removeClass(this._root,'selected');this.inform('hide');if(o.isKeyDown())n.focus(this._triggerElem);}});e.exports=s;});
__d("PopoverMenu",["event-extensions","Arbiter","ArbiterMixin","ARIA","BehaviorsMixin","Class","Input","Keys","KeyStatus","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('ARIA'),j=b('BehaviorsMixin'),k=b('Class'),l=b('Input'),m=b('Keys'),n=b('KeyStatus'),o=b('copyProperties');function p(q,r,s,t){this._popover=q;this._triggerElem=r;this._initialMenu=s;q.subscribe('init',this._onLayerInit.bind(this));q.subscribe('show',this._onPopoverShow.bind(this));q.subscribe('hide',this._onPopoverHide.bind(this));t&&this.enableBehaviors(t);}o(p.prototype,h,j);o(p.prototype,{_popoverShown:false,setMenu:function(q){this._menu=q;var r=q.getRoot();this._popover.setLayerContent(r);q.subscribe('done',this._onMenuDone.bind(this));if(this._popoverShown)this._menu.onShow();i.owns(this._triggerElem,r);this.inform('setMenu',null,g.BEHAVIOR_PERSISTENT);},getPopover:function(){return this._popover;},getTriggerElem:function(){return this._triggerElem;},getMenu:function(){return this._menu;},_onLayerInit:function(){this.setMenu(this._initialMenu);this._popover.getLayer().subscribe('key',this._handleKeyEvent.bind(this));},_onPopoverShow:function(){if(this._menu){this._menu.onShow();if(n.isKeyDown())this._menu.focusAnItem();}this._popoverShown=true;},_onPopoverHide:function(){if(this._menu)this._menu.onHide();this._popoverShown=false;},_handleKeyEvent:function(q,r){var s=Event.getKeyCode(r);switch(s){case m.RETURN:return;case m.UP:case m.DOWN:this._menu.handleKeydown(s);break;default:if(this._menu.handleKeydown(s)===false){this._menu.blur();this._menu.handleKeydown(s);}break;}r.prevent();},_onMenuDone:function(q){this._popover.hideLayer.bind(this._popover).defer();if(n.isKeyDown())l.focus(this._triggerElem);}});e.exports=p;});
var StreamShareVideo={_endpoints:[],_thumbs:[],registerThumb:function(a,b,c,d){StreamShareVideo._endpoints[a+' '+c]=d;StreamShareVideo._thumbs[a+' '+c]=b;},clickTitle:function(a,b,event){return this.expandInlineOrRedirect(a,b,event);},expandInlineOrRedirect:function(a,b,event){if(StreamShareVideo._shouldFollowHref(event))return true;var c=StreamShareVideo._thumbs[a+' '+b],d=ge(c);if(d){CSS.addClass(d,"uiVideoThumbLoading");AsyncRequest.bootstrap(StreamShareVideo._endpoints[a+' '+b],d.parentElement);return false;}return true;},clickTimeline:function(a,b,event){if(StreamShareVideo._shouldFollowHref(event))return true;CSS.addClass(a,"_1xu");CSS.removeClass(a,"_1xv");AsyncRequest.bootstrap(b,a);return false;},_shouldFollowHref:function(event){event=$E(event);if(!event)return false;if(event.getModifiers().any||event.isMiddleClick())return true;return false;}};
__d("MenuXSelectable",["array-extensions","event-extensions","createArrayFrom","Class","copyProperties","MenuX"],function(a,b,c,d,e,f){b('array-extensions');b('event-extensions');var g=b('createArrayFrom'),h=b('Class'),i=b('copyProperties'),j=b('MenuX');function k(n,o,p,q){this.parent.construct(this,n,o,p,q);}function l(n){return n.select&&n.deselect&&n.isSelected;}function m(n){return l(n)&&n.isSelected();}h.extend(k,j);i(k.prototype,{focusAnItem:function(){for(var n=0;n<this._items.length;n++)if(m(this._items[n]))if(this._focusItem(this._items[n])!==false)return true;return this.parent.focusAnItem();},setValue:function(n){if(!this._root)this._render();var o=g(n);this._items.forEach(function(p){if(l(p))if(o.contains(p.getValue())){p.select();}else if(m(p))p.deselect();});this.inform('change',this._getSelection());},_handleItemClick:function(n){if(!l(n))return this.parent._handleItemClick(n);this.inform('itemclick',n);if(this._config.multiple){if(m(n)){n.deselect();}else n.select();this.inform('change',this._getSelection());}else{if(!m(n)){n.select();this._items.forEach(function(o){if(m(o)&&o!==n)o.deselect();});this.inform('change',this._getSelection());}this.done();}return n.handleClick();},_getSelection:function(){var n=[];this._items.forEach(function(o){if(m(o))n.push({label:o.getLabel(),value:o.getValue(),item:o});});if(!this._config.multiple)n=n[0];return n;}});e.exports=k;});
__d("SelectorX",["ArbiterMixin","BehaviorsMixin","Button","copyProperties"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('BehaviorsMixin'),i=b('Button'),j=b('copyProperties');function k(l,m,n,o){this._button=l;this._menu=m;this._input=n;this.init();o.behaviors&&this.enableBehaviors(o.behaviors);}j(k.prototype,g,h);j(k.prototype,{init:function(){this._menu.subscribe('change',function(l,m){i.setLabel(this._button,m.label);this._input.value=m.value;this.inform('change',m);}.bind(this));},setValue:function(l){this._menu.setValue(l);},getValue:function(){return this._input.value;},getName:function(){return this._input.name;},getButton:function(){return this._button;}});e.exports=k;});
__d("ContextualLayerAsyncRelative",["event-extensions","copyProperties","Parent"],function(a,b,c,d,e,f){b('event-extensions');var g=b('copyProperties'),h=b('Parent');function i(j){this._layer=j;}g(i.prototype,{_layerSubscription:null,_listener:null,enable:function(){this._layerSubscription=this._layer.subscribe('show',this._attachListener.bind(this));if(this._layer.isShown())this._attachListener();},disable:function(){this._layerSubscription.unsubscribe();this._layerSubscription=null;if(this._listener){this._listener.remove();this._listener=null;}},_attachListener:function(){this._listener=Event.listen(this._layer.getRoot(),'click',this._onclick.bind(this));},_onclick:function(j){var k=h.byTag(j.getTarget(),'A');if(!k)return;var l=k.getAttribute('ajaxify'),m=k.href,n=l||m;if(k.rel==='async'||k.rel==='async-post'){d(['AsyncRequest'],function(o){o.bootstrap(n,this._layer.getContext(),k.rel==='async-post');}.bind(this));return false;}}});e.exports=i;});
__d("Composer",["event-extensions","function-extensions","Arbiter","ArbiterMixin","Button","CSS","DOM","Env","FileForm","HTML","Input","PageTransitions","Parent","Run","ServerJS","TextAreaControl","URI","URLScraper","$","copyProperties","ge","tx"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('Button'),j=b('CSS'),k=b('DOM'),l=b('Env'),m=b('FileForm'),n=b('HTML'),o=b('Input'),p=b('PageTransitions'),q=b('Parent'),r=b('Run'),s=b('ServerJS'),t=b('TextAreaControl'),u=b('URI'),v=b('URLScraper'),w=b('$'),x=b('copyProperties'),y=b('ge'),z=b('tx'),aa=1,ba=4,ca={},da=function(){var ha=k.scry(this.root,'span.linkAttachment')[0];if(!ha&&this.isMetaComposer)ha=k.scry(this.root,'span.attachmentAcceptsLink')[0];if(!ha)return;var ia=q.byTag(ha,'form');this.scraper=new v(this.input);this.scraper.subscribe('match',function(ja,ka){if(this.isMetaComposer){var la=this.form.xhpc_targetid,ma=new u('/ajax/metacomposer/attachment/link/scraper.php');ma.addQueryData({scrape_url:encodeURIComponent(ka.url),alt_scrape_url:encodeURIComponent(ka.alt_url),targetid:la.value});ia.action=ma.toString();}else{j.show(ha);ia.action='/ajax/composer/attachment/link/scraper.php?scrape_url='+encodeURIComponent(ka.url);}ia.xhpc.value=ha.id;ia.xhpc.disabled=false;ia.xhpc.click();}.bind(this));this.isMetaComposer&&this.scraper.check();},ea=function(ha){if(this.inform('submit')===false){ha.kill();return false;}if(this.submitHandler)return (new Function(this.submitHandler)).apply(this.form);};function fa(ha,ia,ja,ka,la){ca[ha.id]=this;this.root=ha;this.resetCfg=ia;this.dataSource=ka;this.lazyEndpoint=this.resetCfg&&this.resetCfg.lazyEndpoint;this.focus=k.find(ha,'div.focus_target');this.form=k.find(ha,'form.attachmentForm');this.content=k.find(ha,'div.attachmentContent');this.isMetaComposer=ja;if(this.isMetaComposer){this.messageBox=k.find(ha,'div.uiMetaComposerMessageBox');this.metaArea=k.find(ha,'div.attachmentMetaArea');this.bottomArea=k.find(ha,'div.attachmentBottomArea');this.barArea=k.find(ha,'div.attachmentBarArea');this.auxBarArea=k.find(ha,'.attachmentAuxBarArea');this.blurb=k.find(ha,'div.uiMetaComposerMessageBox div.textBlurb');this.input=k.find(ha,'div.uiMetaComposerMessageBox textarea.input');this.button=k.find(ha,'div.uiMetaComposerMessageBox label.submitBtn');this.privacy=k.find(ha,'div.uiMetaComposerMessageBox li.privacyWidget');this.boosting=k.scry(ha,'div.uiMetaComposerMessageBox li.boostingWidget');}else{this.blurb=k.find(ha,'div.uiComposerMessageBox div.textBlurb');this.input=k.find(ha,'div.uiComposerMessageBox textarea.input');this.button=k.find(ha,'div.uiComposerMessageBox label.submitBtn');this.privacy=k.find(ha,'div.uiComposerMessageBox li.privacyWidget');this.boosting=[];}Event.listen(this.form,'submit',ea.bind(this));if(this.isMetaComposer){Event.listen(this.input,'focus',this.onFocus.bind(this));if(la){if(document.activeElement===this.input)this.onFocus.bind(this).defer();}else if(q.byClass(this.input,'child_was_focused'))this.onFocus.bind(this).defer();}g.inform('xhpc/construct/'+ha.id,this,g.BEHAVIOR_STATE);}x(fa.prototype,h,{init:function(ha){this.mentionsInput=ha;if(this.mentionsInput)this.mentionsInput.subscribe('init',function(){var ia=this.mentionsInput.getTypeahead().getView();ia.subscribe(['reset','render'],function(ja){j.conditionClass(this.root,'uiComposerMention',(ja=='render'));}.bind(this));}.bind(this));da.call(this);this.inform('init',null,g.BEHAVIOR_PERSISTENT);this.setupListen();r.onBeforeUnload(this._handleUnsavedChanges.bind(this));},setupListen:function(){Event.listen(this.root,'click',this.clickHandler.bind(this));},clickHandler:function(event){var ha=event.getTarget();if(q.byClass(ha,'collapsedPostButton'))this.focusInput.bind(this).defer();},setBlurb:function(ha){k.setContent(this.blurb,ha);},setEnabled:function(ha){i.setEnabled(this.button,ha);},getEndpoint:function(){return this.form.getAttribute('action');},setEndpoint:function(ha){this.form.setAttribute('action',ha);},setLoading:function(ha){j.conditionClass(this.root,'async_saving',!!ha);},setContentVisible:function(ha){j.conditionClass(this.root,'uiComposerHideContent',!ha);},setMessageBoxVisible:function(ha){j.conditionClass(this.root,'uiComposerHideMessageBox',!ha);},setInputVisible:function(ha){j.conditionClass(this.root,'uiComposerHideInput',!ha);},setStatusBoxVisible:function(ha){j.conditionClass(this.root,'uiComposerHideStatusBox',!ha);},setTopicTaggerVisible:function(ha){j.conditionClass(this.root,'uiTagComposerHidden',!ha);},mutate:function(ha){if(this.lastComposerInput)o.setValue(this.input,o.getValue(y(this.lastComposerInput)));var ia=y(ha.xhpc);if(ia){var ja=k.scry(this.root,'.uiComposerAttachmentSelected')[0];if(ha.confirmAugmentation&&ja!==ia)return;ja&&j.removeClass(ja,'uiComposerAttachmentSelected');j.addClass(ia,'uiComposerAttachmentSelected');if(!ha.disableCache)Event.listen(ia,'click',function(la){la.stop();ha.disableCache=true;this.mutate(ha);}.bind(this));}if(!ha.keepContentAreas){this.setContentVisible(false);k.empty(this.content);if(this.isMetaComposer){this.mentionsInput&&this.mentionsInput.setAuxContent(null);k.empty(this.metaArea);k.empty(this.bottomArea);k.empty(this.barArea);k.empty(this.auxBarArea);}}if(ha.content){k.setContent(this.content,n(ha.content));this.setContentVisible(true);}if(this.isMetaComposer){ha.metaContent&&k.setContent(this.metaArea,n(ha.metaContent));ha.bottomContent&&k.setContent(this.bottomArea,n(ha.bottomContent));ha.barContent&&k.setContent(this.barArea,n(ha.barContent));ha.auxBarContent&&k.setContent(this.auxBarArea,n(ha.auxBarContent));}this.setMessageBoxVisible(!ha.messageBoxHidden);j.conditionClass(this.root,'uiComposerWhiteMessageBox',!ha.messageBoxHidden&&!ha.inputHidden&&!ha.content);this.setInputVisible(!ha.inputHidden);this.setStatusBoxVisible(!ha.statusBoxHidden);j.conditionShow(this.privacy,!ha.privacyWidgetHidden);if(this.boosting.length>0)j.conditionShow(this.boosting[0],!ha.boostingWidgetHidden);if(!ha.keepContentAreas){o.setPlaceholder(this.input,ha.placeholder);i.setLabel(this.button,ha.buttonLabel);}this.setBlurb(n(ha.blurb));if(ha.autoscrape){this.scraper&&this.scraper.enable();}else this.scraper&&this.scraper.disable();this.setEnabled(!ha.disabled);this.setTopicTaggerVisible(!ha.hideTopicTagger);this.setEndpoint(ha.endpoint);if(ha.formType==aa){this.form.setAttribute('rel','async');}else this.form.removeAttribute('rel');this.form.removeAttribute('target');if(ha.formType==ba){if(!this._fileForm){this._fileForm=new m(this.form);this._fileForm.setAllowCrossOrigin(l.allowCrossOriginComposerUpload);this._fileForm.subscribe('submit',this.setLoading.bind(this,true));this._fileForm.subscribe('failure',this.setLoading.bind(this,false));}}else if(this._fileForm){this._fileForm.destroy();this._fileForm=null;}this.submitHandler=ha.submitHandler;this.lazyEndpoint=ha.lazyEndpoint;j.addClass(this.root,'uiComposerInteracted');j.addClass(this.root,'uiComposerOpen');if(ha.messageBoxFocused){var ka=document.activeElement;if(ka===document.body||q.byClass(ka,'attachmentLink'))this.focusInput.bind(this).defer();}if(ha.inputElement){o.setValue(y(ha.inputElement),o.getValue(this.input));t.getInstance(y(ha.inputElement)).update();}else t.getInstance(this.input).update();this.lastComposerInput=ha.inputElement;g.inform('composer/mutate',this);},subscribeToMutate:function(ha){return g.subscribe('composer/mutate',function(ia,ja){if(ja===this)ha();}.bind(this));},unsubscribeFromMutate:function(ha){ha.unsubscribe();},reset:function(ha){if(this.isMetaComposer){k.empty(this.metaArea);k.empty(this.bottomArea);k.empty(this.barArea);k.empty(this.auxBarArea);}if(this.resetCfg){this.mutate(this.resetCfg);}else{var ia=k.scry(this.root,'.uiComposerAttachmentSelected')[0];if(ia)j.removeClass(ia,'uiComposerAttachmentSelected');}if(!ha){o.reset(this.input);this.mentionsInput&&this.mentionsInput.reset();this.scraper&&this.scraper.reset();}j.removeClass(this.root,'uiComposerInteracted');j.setClass(this.focus,'focus_target');this.setLoading(false);g.inform('composer/reset');},onFocus:function(){if(this.lazyEndpoint){var ha=k.find(this.root,'form.attachmentSelectForm'),ia=new u(this.lazyEndpoint);ia.addQueryData({isAugmentation:true});ha.action=ia.toString();var ja=k.scry(this.root,'.uiComposerAttachmentSelected')[0];ha.xhpc.value=ja&&ja.id;ha.xhpc.click();j.removeClass.curry(this.root,'async_saving').defer();}this.inform('focus');},focusInput:function(){o.focus(this.input);},getInput:function(){return this.input;},updateDataSourceToken:function(ha){if(this.dataSource)this.dataSource.updateToken(ha);},_handleUnsavedChanges:function(){var ha=p.getNextURI();if(ha.getQueryData().hasOwnProperty('theater'))return;if(this.input.offsetParent!==null&&!o.isEmpty(this.input)&&!(a.Dialog&&a.Dialog.getCurrent()))return "You haven't finished your post yet. Do you want to leave without finishing?";}});var ga;x(fa,{setNodeToConfigure:function(ha){ga=ha;},configure:function(ha,ia,ja){var ka=q.byClass(ga,'uiComposer').id,la=g.subscribe('xhpc/construct/'+ka,function(ma,na){(function(){la.unsubscribe();}).defer();na.mutate(ha);na.subscribe('init',function(){new s().handle(ia);new Function(ja)();if(ha.attachmentJS)new Function(ha.attachmentJS).call(na);});});},publish:function(ha,ia){ia=ia||{};ia.composer_id=ha;ia.composer=fa.getInstance(ha);if(ia.streamNode){ia.streamStory=ia.streamNode;}else if(ia.streamMarkup)ia.streamStory=n(ia.streamMarkup).getRootNode();g.inform('composer/publish',ia);ia.composer&&ia.composer.reset(false);},finish:function(ha){fa.getInstance(ha).setLoading(false);},getInstance:function(ha){var ia=q.byClass(w(ha),'uiComposer');return ia?ca[ia.id]:null;}});e.exports=fa;});
__d("ComposerXAttachmentBootstrap",["CSS","Form","Parent","URI","cx"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('Form'),i=b('Parent'),j=b('URI'),k=b('cx'),l=[],m={bootstrap:function(n){m.load(i.byTag(n,'form'),n.getAttribute('data-endpoint'));},load:function(n,o,p){var q=j(o).addQueryData({composerurihash:m.getURIHash(o)});g.conditionClass(n,"_fu",p);var r=i.byClass(n,"_2_4");g.removeClass(r,'async_saving');h.setDisabled(n,false);n.action=q.toString();h.bootstrap(n);},getURIHash:function(n){if(n==='initial')return 'initial';var o=l.indexOf(n);if(o!==-1){return o+'';}else{o=l.length;l[o]=n;return o+'';}}};e.exports=m;});
__d("ComposerXStore",["function-extensions","Arbiter","ge"],function(a,b,c,d,e,f){b('function-extensions');var g=b('Arbiter'),h=b('ge'),i={};function j(l,m){return 'ComposerX/'+l+'/'+m;}var k={set:function(l,m,n){if(!i[l])i[l]={};i[l][m]=n;g.inform(j(l,m),{},g.BEHAVIOR_STATE);},get:function(l,m){if(i[l])return i[l][m];return null;},getAllForComposer:function(l){return i[l]||{};},waitForComponents:function(l,m,n){g.registerCallback(n,m.map(j.curry(l)));}};g.subscribe('page_transition',function(){for(var l in i)if(!h(l))delete i[l];});e.exports=k;});
__d("ComposerX",["Arbiter","ComposerXAttachmentBootstrap","ComposerXStore","CSS","DOM","DOMQuery","copyProperties","csx","cx","getObjectValues"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ComposerXAttachmentBootstrap'),i=b('ComposerXStore'),j=b('CSS'),k=b('DOM'),l=b('DOMQuery'),m=b('copyProperties'),n=b('csx'),o=b('cx'),p=b('getObjectValues'),q='any';function r(s){this._root=s;this._composerID=s.id;this._attachments={};this._attachmentFetchForm=l.find(s,"._2_4");this._resetSubscription=g.subscribe('composer/publish',function(t,u){if(u.composer_id===this._composerID)this.reset();}.bind(this));}m(r.prototype,{_endpointHashToShow:q,_lastFetchEndpoint:'',_initialAttachmentEndpoint:'',getAttachment:function(s,t){var u=h.getURIHash(s);this._endpointHashToShow=u;var v=this._attachments[u];if(v){this._showAttachmentAfterComponentsLoaded(u);}else this.fetchAttachmentData(s,t);},fetchAttachmentData:function(s,t){var u=h.getURIHash(s);if(this._attachments[u])return;if(s!==this._lastFetchEndpoint){h.load(this._attachmentFetchForm,s,t);this._lastFetchEndpoint=s;}},setAttachment:function(s,t,u,v){this._setupAttachment(s,t,u,v);this._showAttachmentAfterComponentsLoaded(s);},setInitialAttachment:function(s,t,u,v){var w=h.getURIHash(s);this._setupAttachment(w,t,u,v);this._initialAttachmentEndpoint=s;if(!this._currentInstance)this._showAttachmentAfterComponentsLoaded(w);},setComponent:function(s,t){if(!i.get(this._composerID,s)){i.set(this._composerID,s,t);k.appendContent(this._attachmentFetchForm,k.create('input',{type:'hidden',name:'loaded_components[]',value:s}));}},reset:function(){if(this._currentInstance){this._currentInstance.cleanup();this._currentInstance=null;}for(var s in this._attachments)this._attachments[s].instance.reset();var t=i.getAllForComposer(this._composerID);p(t).forEach(function(u){if(u.reset)u.reset(u);});this.getAttachment(this._initialAttachmentEndpoint);g.inform('composer/reset');},destroy:function(){if(this._resetSubscription){this._resetSubscription.unsubscribe();this._resetSubscription=null;}},addPlaceholders:function(s,t){var u;for(var v in this._attachments){u=this._attachments[v];if(u.instance===s){t.forEach(function(w){u.placeholders.push(w);u.required_components.push(w.component_name);});break;}}if(this._currentInstance===s)this._fillPlaceholders(t);},_setupAttachment:function(s,t,u,v){t.setComposerID(this._composerID);this._attachments[s]={instance:t,placeholders:u,required_components:v};var w=l.find(this._root,"div._118"),x=t.getRoot();if(x.parentNode!==w){j.hide(x);k.appendContent(w,x);}},_showAttachment:function(s,t,u){if(this._currentInstance===s)return;if(this._endpointHashToShow===q){this._endpointHashToShow=null;}else if(this._endpointHashToShow!==t)return;if(this._currentInstance){if(!this._currentInstance.canSwitchAway())return;this._currentInstance.cleanup();}this._currentInstance=s;var v=l.find(this._root,"div._118"),w=v.childNodes,x=s.getRoot();for(var y=0;y<w.length;y++)if(w[y]!==x)j.hide(w[y]);j.show(x);this._fillPlaceholders(u);var z=h.getURIHash(this._initialAttachmentEndpoint),aa=t===z;s.initWithComponents(aa);this._setAttachmentSelectedClass(s.attachmentClassName);g.inform('composer/initializedAttachment',{composerRoot:this._root,isInitial:aa});},_showAttachmentAfterComponentsLoaded:function(s){var t=this._attachments[s];i.waitForComponents(this._composerID,t.required_components,this._showAttachment.bind(this,t.instance,s,t.placeholders));},_fillPlaceholders:function(s){s.forEach(function(t){var u=i.get(this._composerID,t.component_name);if(t.element!==u.element.parentNode)k.setContent(t.element,u.element);}.bind(this));},_setAttachmentSelectedClass:function(s){var t=l.scry(this._root,"._4n")[0];if(t)j.removeClass(t,"_4n");if(s){var u=l.scry(this._root,'.'+s)[0];if(u)j.addClass(u,"_4n");}}});e.exports=r;});
__d("ComposerXAttachment",["ComposerXStore","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('ComposerXStore'),h=b('copyProperties'),i=b('emptyFunction');function j(){}h(j.prototype,{getRoot:i,initWithComponents:function(k){},cleanup:i,reset:i,attachmentClassName:'',getComponent:function(k){return g.get(this._composerID,k);},canSwitchAway:i.thatReturnsTrue,setComposerID:function(k){this._composerID=k;}});e.exports=j;});
__d("ComposerXController",["Arbiter","ComposerX","ComposerXAttachmentBootstrap","Parent","$","cx","emptyFunction","ge"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ComposerX'),i=b('ComposerXAttachmentBootstrap'),j=b('Parent'),k=b('$'),l=b('cx'),m=b('emptyFunction'),n=b('ge'),o={};function p(r){var s=j.byClass(k(r),"_119"),t=s.id;if(!o[t])o[t]=new h(s);return o[t];}var q={getAttachment:function(r,s,t){var u=p(r);u.getAttachment(s,t);},fetchAttachmentData:function(r,s,t){p(r).fetchAttachmentData(s,t);},setAttachment:function(r,s,t,u,v){var w=p(r);w.setAttachment(s,t,u,v);},setInitialAttachment:function(r,s,t,u,v){var w=p(r);w.setInitialAttachment(s,t,u,v);},setComponent:function(r,s,t){var u=p(r);u.setComponent(s,t);},reset:function(r){var s=p(r);s.reset();},holdTheMarkup:m,getEndpoint:function(r,s,t){var u=p(r);i.load(u._attachmentFetchForm,s,t);},addPlaceholders:function(r,s,t){var u=p(r);u.addPlaceholders(s,t);}};i.bootstrap=function(r){q.getAttachment(r,r.getAttribute('data-endpoint'));};g.subscribe('page_transition',function(){for(var r in o)if(!n(r)){o[r].destroy();delete o[r];}});e.exports=q;});
__d("DragDropFileUpload",[],function(a,b,c,d,e,f){f.isSupported=function(){return typeof(FileList)!=="undefined";};});
__d("DocumentDragDrop",["event-extensions","Arbiter","CSS","DOM","DragDropFileUpload","emptyFunction","getObjectValues"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('CSS'),i=b('DOM'),j=b('DragDropFileUpload'),k=b('emptyFunction'),l=b('getObjectValues'),m={},n=0;function o(){n=0;l(m).forEach(function(r){h.removeClass(r.element,r.className);});}function p(){if(!j.isSupported())return;Event.listen(document,'dragenter',function(s){if(n===0)l(m).forEach(function(t){h.addClass(t.element,t.className);g.inform('dragenter',{element:t.element});});n++;});Event.listen(document,'dragleave',function(s){n--;if(n===0)o();});Event.listen(document,'drop',Event.prevent);Event.listen(document,'dragover',Event.prevent);var r=null;document.addEventListener('dragover',function(){r&&clearTimeout(r);r=setTimeout(o,839);},true);p=k;}var q={registerStatusElement:function(r,s){p();m[i.getID(r)]={element:r,className:s};},removeStatusElement:function(r){var s=i.getID(r),t=m[s];h.removeClass(t.element,t.className);delete m[s];}};e.exports=q;});
__d("DragDropTarget",["event-extensions","CSS","DocumentDragDrop","DragDropFileUpload","copyProperties","emptyFunction"],function(a,b,c,d,e,f){b('event-extensions');var g=b('CSS'),h=b('DocumentDragDrop'),i=b('DragDropFileUpload'),j=b('copyProperties'),k=b('emptyFunction');function l(m){this._element=m;this._listeners=[];this._statusElem=m;this._dragEnterCount=0;this._enabled=false;}j(l.prototype,{_onFilesDropCallback:k,_onURLDropCallback:k,_fileFilterFn:k.thatReturnsArgument,setOnFilesDropCallback:function(m){this._onFilesDropCallback=m;return this;},setOnURLDropCallback:function(m){this._onURLDropCallback=m;return this;},enable:function(){if(!i.isSupported())return this;h.registerStatusElement(this._statusElem,'fbWantsDragDrop');this._listeners.push(Event.listen(this._element,'dragenter',this._onDragEnter.bind(this)));this._listeners.push(Event.listen(this._element,'dragleave',this._onDragLeave.bind(this)));this._listeners.push(Event.listen(this._element,'dragover',Event.kill));this._listeners.push(Event.listen(this._element,'drop',function(m){this._dragEnterCount=0;g.removeClass(this._statusElem,'fbDropReady');var n=this._fileFilterFn(m.dataTransfer.files);if(n.length)this._onFilesDropCallback(n);var o=m.dataTransfer.getData('url')||m.dataTransfer.getData('text/uri-list');if(o)this._onURLDropCallback(o);m.kill();}.bind(this)));this._enabled=true;return this;},disable:function(){if(!this._enabled)return this;h.removeStatusElement(this._statusElem,'fbWantsDragDrop');g.removeClass(this._statusElem,'fbDropReady');while(this._listeners.length)this._listeners.pop().remove();this._enabled=false;return this;},setFileFilter:function(m){this._fileFilterFn=m;return this;},setStatusElement:function(m){this._statusElem=m;return this;},_onDragEnter:function(){if(this._dragEnterCount===0)g.addClass(this._statusElem,'fbDropReady');this._dragEnterCount++;},_onDragLeave:function(){this._dragEnterCount=Math.max(this._dragEnterCount-1,0);if(this._dragEnterCount===0)g.removeClass(this._statusElem,'fbDropReady');}});e.exports=l;});
__d("PopoverAsyncMenuLoading",["Class","copyProperties","DOM","PopoverMenuInterface"],function(a,b,c,d,e,f){var g=b('Class'),h=b('copyProperties'),i=b('DOM'),j=b('PopoverMenuInterface');function k(l){this.parent.construct(this);this._className=l||'';}g.extend(k,j);h(k.prototype,{_root:null,getRoot:function(){if(!this._root)this._root=i.create('div',{className:this._className},i.create('div',{className:'uiMenuXBorder'},i.create('div',{className:'uiMenuX uiMenuXLoading'},i.create('span',{className:'spinner'}))));return this._root;}});e.exports=k;});
__d("PopoverAsyncMenu",["event-extensions","AsyncRequest","Class","CSS","DOM","PopoverAsyncMenuLoading","PopoverMenu","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('AsyncRequest'),h=b('Class'),i=b('CSS'),j=b('DOM'),k=b('PopoverAsyncMenuLoading'),l=b('PopoverMenu'),m=b('copyProperties'),n={},o=0;function p(q,r,s,t,u){this._endpoint=t;this._loadingMenu=s;this._instanceId=o++;n[this._instanceId]=this;this._mouseoverListener=Event.listen(r,'mouseover',this._fetchMenu.bind(this));this.parent.construct(this,q,r,null,u);}p.setMenu=function(q,r){n[q].setMenu(r);};h.extend(p,l);m(p.prototype,{_fetched:false,_mouseoverListener:null,_onLayerInit:function(){if(!this._menu)this.setMenu(this._loadingMenu);this._fetchMenu();},_fetchMenu:function(){if(this._fetched)return;new g().setURI(this._endpoint).setData({pmid:this._instanceId}).send();this._fetched=true;if(this._mouseoverListener){this._mouseoverListener.remove();this._mouseoverListener=null;}}});e.exports=p;});
__d("PopoverMenuOverlappingBorder",["function-extensions","CSS","DOM","Style","copyProperties"],function(a,b,c,d,e,f){b('function-extensions');var g=b('CSS'),h=b('DOM'),i=b('Style'),j=b('copyProperties');function k(l){this._popoverMenu=l;this._popover=l.getPopover();this._triggerElem=l.getTriggerElem();}j(k.prototype,{_shortBorder:null,_setMenuSubscription:null,_showSubscription:null,_menuSubscription:null,enable:function(){this._setMenuSubscription=this._popoverMenu.subscribe('setMenu',this._onSetMenu.bind(this));},disable:function(){this._popoverMenu.unsubscribe(this._setMenuSubscription);this._setMenuSubscription=null;this._removeBorderSubscriptions();this._removeShortBorder();},_onSetMenu:function(){this._removeBorderSubscriptions();this._menu=this._popoverMenu.getMenu();this._renderShortBorder(this._menu.getRoot());this._showSubscription=this._popover.subscribe('show',this._updateBorder.bind(this));this._menuSubscription=this._menu.subscribe(['change','resize'],Function.prototype.defer.shield(this._updateBorder.bind(this)));this._updateBorder();},_updateBorder:function(){var l=this._menu.getRoot(),m=this._triggerElem.offsetWidth;i.set(l,'min-width',m+'px');var n=Math.max(l.offsetWidth-m,0);i.set(this._shortBorder,'width',n+'px');},_renderShortBorder:function(l){this._shortBorder=h.create('div',{className:'uiMenuXShortBorder'});h.appendContent(l,this._shortBorder);g.addClass(l,'uiMenuXWithShortBorder');},_removeShortBorder:function(){if(this._shortBorder){h.remove(this._shortBorder);this._shortBorder=null;g.removeClass(this._popoverMenu.getMenu().getRoot(),'uiMenuXShortBorder');}},_removeBorderSubscriptions:function(){if(this._showSubscription){this._popover.unsubscribe(this._showSubscription);this._showSubscription=null;}if(this._menuSubscription){this._menu.unsubscribe(this._menuSubscription);this._menuSubscription=null;}}});e.exports=k;});
__d("PhotosUploadID",[],function(a,b,c,d,e,f){var g=1024,h={getNewID:function(){return g++;}};e.exports=h;});
__d("ComposerXDragDrop",["Arbiter","AsyncUploadRequest","ComposerXController","DragDropTarget","PhotosUploadID","URI","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncUploadRequest'),i=b('ComposerXController'),j=b('DragDropTarget'),k=b('PhotosUploadID'),l=b('URI'),m=b('copyProperties'),n='/ajax/composerx/attachment/media/upload/',o='/ajax/composerx/attachment/link/scraper/',p=function(r){r();};function q(r,s,t,u){this._root=r;this._composerID=s;this._targetID=t;u=u||p;this._dragdrop=new j(r).setOnFilesDropCallback(function(v){u(this._uploadFiles.bind(this,v));}.bind(this)).setFileFilter(q.filterImages).enable();}q.filterImages=function(r){var s=[];for(var t=0;t<r.length;t++)if(r[t].type.match('image/*'))s.push(r[t]);return s;};m(q.prototype,{enableURLDropping:function(){this._dragdrop.setOnURLDropCallback(this._onURLDrop.bind(this));},deactivate:function(){this._dragdrop.disable();},_uploadFiles:function(r){i.getAttachment(this._root,n);g.inform('ComposerXFilesStore/filesDropped/'+this._composerID+'/mediaupload',{files:r},g.BEHAVIOR_PERSISTENT);},_onURLDrop:function(r){var s=new l(o);s.addQueryData({scrape_url:encodeURIComponent(r)});i.getAttachment(this._root,s.toString());}});e.exports=q;});
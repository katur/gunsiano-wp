/*1355110313,173217823*/

if (self.CavalryLogger) { CavalryLogger.start_js(["EvvXr"]); }

__d("StickyController",["event-extensions","CSS","DOM","Style","Vector","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('CSS'),h=b('DOM'),i=b('Style'),j=b('Vector'),k=b('copyProperties');function l(m,n,o,p){this._element=m;this._marginTop=n;this._onchange=o;this._proxy=p||m.parentNode;this._boundQueryOnScroll=this._queryOnScroll.bind(this);this._boundMutateOnScroll=this._mutateOnScroll.bind(this);}k(l.prototype,{handleScroll:function(){h.queryThenMutate(this._boundQueryOnScroll,this._boundMutateOnScroll);},_queryOnScroll:function(){this._shouldFix=j.getElementPosition(this._proxy,'viewport').y<=this._marginTop;},_mutateOnScroll:function(){var m=this._shouldFix;if(this.isFixed()!==m){i.set(this._element,'top',m?this._marginTop+'px':'');g.conditionClass(this._element,'fixed_elem',m);this._onchange&&this._onchange(m);}},start:function(){if(this._event)return;this._event=Event.listen(window,'scroll',this.handleScroll.bind(this));this.handleScroll.bind(this).defer();},stop:function(){this._event&&this._event.remove();this._event=null;},isFixed:function(){return g.hasClass(this._element,'fixed_elem');}});e.exports=l;});
__d("TimelineSideAds",["event-extensions","function-extensions","Arbiter","cx","csx","CSS","DOM","StickyController","TimelineConstants","TimelineController","UIPagelet","URI","Vector","debounce","ge"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('Arbiter'),h=b('cx'),i=b('csx'),j=b('CSS'),k=b('DOM'),l=b('StickyController'),m=b('TimelineConstants'),n=b('TimelineController'),o=b('UIPagelet'),p=b('URI'),q=b('Vector'),r=b('debounce'),s=b('ge'),t=2,u=3,v=75,w='data-height',x=30000,y=0,z=false,aa,ba,ca,da,ea=[],fa,ga=false,ha,ia=Infinity,ja=5,ka=false,la,ma,na,oa,pa,qa=false,ra=[],sa,ta=false,ua={about:true};function va(nb,ob,pb){var qb=0;if(ob)qb+=ob.getHeight();if(!ab()&&!qb)return;nb-=qb;var rb=0;for(var sb=0;sb<pb;sb++)rb+=fb(sb);if(ob)if(nb<rb){nb+=ob.fold(rb-nb);}else if(nb>rb)nb-=ob.unfold(nb-rb);return nb;}function wa(){var nb=ba.cloneNode(true);nb.id='';var ob=true;k.scry(nb,'div.ego_unit').forEach(function(pb){if(ob){ob=false;}else k.remove(pb);});j.addClass(nb,'fixed_elem');return nb;}function xa(){if(!n.pageHasScrubber(fa)){bb(ja);db();}else if(ma){cb(ba,false);var nb=na;na&&k.remove(na);na=wa();if(nb)kb();bb(n.sidebarInitialized()&&ga?u:t);db();if(!ha){var ob=n.getCurrentScrubber();if(ob)jb(ob.getRoot(),ob.getOffset());}ha&&ha.start();}else mb.adjustAdsToFit();}function ya(){if(na){k.remove(na);na=null;}if(ha){ha.stop();ha=null;}if(ab()){j.conditionClass(ba,'fixed_elem',!ma);j.conditionClass(ba,"_22s",!n.pageHasScrubber(fa));}else j.conditionClass(ba,'fixed_elem',!ma&&n.pageHasScrubber(fa));}function za(nb){var ob=q.getViewportDimensions().y,pb=n.getCurrentScrubber(),qb=pb?pb.getOffset():m.SCRUBBER_DEFAULT_OFFSET,rb=ob-qb-v;if(pb||ab())return va(rb,pb,nb);}function ab(){if(ta)return fa in ua;return n.fixedAds();}function bb(nb){da=Math.min(nb,ea.length);for(var ob=0;ob<ea.length;ob++)cb(ea[ob],ob>=da);cb(ba,da===0);}function cb(nb,ob){j.conditionClass(nb,"_22r",ob);nb.setAttribute('aria-hidden',ob?'true':'false');}function db(){if(!oa)return;for(var nb=da-1;nb>=0;--nb){if(ha&&ha.isFixed()&&((nb!==0)||(na&&!j.shown(na))))continue;var ob=k.find(ea[nb],"div._4u8"),pb=ob.getAttribute('data-ad'),qb=JSON.parse(pb).adid;if(!oa[qb])return;var rb=k.create('iframe',{src:p('/ai.php').addQueryData({aed:oa[qb]}),width:0,height:0,frameborder:0,scrolling:'no',className:'fbEmuTracking'});rb.setAttribute('aria-hidden','true');k.appendContent(ba,rb);delete oa[qb];}}function eb(nb){var ob=0;while(nb>0&&ob<ja){nb-=fb(ob);if(nb>=0)ob++;}return ob;}function fb(nb){var ob=ea[nb];if(!ob)return 0;if(!ob.getAttribute(w))gb(ob);return parseInt(ob.getAttribute(w),10);}function gb(nb){nb.setAttribute(w,nb.offsetHeight);}function hb(){for(var nb=0;nb<ea.length;nb++){var ob=ea[nb];if(!ob)continue;gb(ob);}}function ib(){ea=k.scry(ba,'div.ego_unit');var nb=ea.length;if(!nb)return;ka=nb;xa();var ob=function(pb){gb(pb);ka=--nb;mb.adjustAdsToFit();if(!ka)ia=Date.now();};ea.forEach(function(pb){function qb(){ob.curry(pb).defer();}var rb=k.scry(pb,'img.img')[0];if(!rb)return;if(rb.complete){qb();}else Event.listen(rb,{load:qb,error:qb,abort:qb});});}function jb(nb,ob){ha=new l(nb,ob,function(pb){if(pb){kb();}else{k.remove(na);db();}});if(na)ha.start();}function kb(){k.insertAfter(ba,na);lb();}function lb(){j.conditionShow(na,fb(0)<=za(1)&&!j.hasClass(document.documentElement,'tinyViewport'));}var mb={init:function(nb,ob,pb){if(z)return;ja=pb.max_ads;aa=pb.refresh_delay;x=pb.refresh_threshold;z=true;ca=ob;ba=nb;ta=pb.is_standalone;if(ta){ma=false;fa=pb.page_key;ya();}mb.adjustAdsType(n.shouldShowWideAds());pa=g.subscribe(['UFI/CommentAddedActive','UFI/CommentDeletedActive','UFI/LikeActive','Curation/Action','ProfileBrowser/LoadMoreContent','Ads/NewContentDisplayed'],mb.loadAdsIfEnoughTimePassed);sa=r(mb.loadAdsIfEnoughTimePassed,aa,this,true);if(pb.mouse_move){ra.push(Event.listen(window,'mousemove',sa));ra.push(Event.listen(window,'scroll',sa));ra.push(Event.listen(window,'resize',sa));}n.register(n.ADS,mb);},setShortMode:function(nb){ma=nb;},start:function(nb){oa=nb;la=null;ib();},updateCurrentKey:function(nb){if(nb==fa)return;fa=nb;ya();},loadAds:function(nb){if(ka||la)return;ia=Infinity;la=o.loadFromEndpoint('WebEgoPane',ba.id,{pid:33,data:[ca,false,'timeline_'+nb,ma?u:ja,++y]},{crossPage:true,bundle:false});},registerScrubber:function(nb){if(ma)jb(nb.getRoot(),nb.getOffset());!la&&mb.adjustAdsToFit();},loadAdsIfEnoughTimePassed:function(){if(x&&(Date.now()-ia>=x)&&!j.hasClass(document.documentElement,'tinyViewport')&&(!ha||ha.isFixed())&&(!oa||!oa[ea[0]]))mb.loadAds(fa);mb.adjustAdsToFit();},adjustAdsType:function(nb){if(nb!=ga){j.conditionClass(ba,"_22q",!nb);j.conditionClass(ba,"_35q",!nb);na&&j.conditionClass(na,"_22q",!nb);na&&j.conditionClass(na,"_35q",!nb);ga=nb;hb();mb.adjustAdsToFit();var ob=s('rightColContent');if(ob)j.conditionClass(ob,'fbTimelineWideRightCol',nb);}},adjustAdsToFit:function(){if(!ba||qa)return;qa=true;var nb=ga?u:t;if(ma){if(ha&&na){ha.handleScroll();if(ha.isFixed()){j.conditionShow(na,fb(0)<=za(1)&&!j.hasClass(document.documentElement,'tinyViewport'));}else bb(nb);db();}}else{var ob=za(nb);if(typeof ob!=='undefined'){bb(eb(ob));if(!ka)db();}}qa=false;},reset:function(){ha&&ha.stop();la&&la.cancel();ea=[];ga=false;ba=null;ha=null;la=null;y=0;ka=null;ma=null;na=null;fa=null;ia=Infinity;z=false;pa&&g.unsubscribe(pa);pa=null;ra.forEach(function(nb){nb.remove();});ra=[];sa&&sa.reset();}};e.exports=a.TimelineSideAds||mb;});
/*1355700298,173217321*/

if (self.CavalryLogger) { CavalryLogger.start_js(["\/ayIo"]); }

var ReviewsApp={writeReview:false,writeReviewElem:null,ON_RATING_SET:'reviews/on_rating_set',ON_REVIEW_SUBMITTED:'reviews/on_review_submitted',IMAGE_STAR_ON:null,IMAGE_STAR_OFF:null,initialize:function(a,b){ReviewsApp.IMAGE_STAR_ON=a;ReviewsApp.IMAGE_STAR_OFF=b;var c=[a,b];for(var d=0;d<c.length;d++)(new Image()).src=c[d];}};function reviews_show_editor_inline(a){hide('review_editor_status');toggle(ge('reviews_inline_editor'));ReviewsApp.writeReviewElem=a;}function reviews_jump_to_and_open_editor(){var a=ge('reviews_inline_editor');if(a){show(a);$('review_blurb').focus();DOMScroll.scrollTo(a,true,true);}}function reviews_set_rating(a){var b=ge('review_rating');b.value=a;for(var c=1;c<=5;c++){var d=$('review_rating_star'+c).getElementsByTagName('img')[0];if(c<=a){d.src=ReviewsApp.IMAGE_STAR_ON;}else d.src=ReviewsApp.IMAGE_STAR_OFF;}Arbiter.inform(ReviewsApp.ON_RATING_SET,{element:b});return false;}function reviews_hover_rating(a){var b=ge('review_rating');if(!(b.value>0)){for(var c=1;c<=5;c++){var d=$('review_rating_star'+c).getElementsByTagName('img')[0];if(c<=a){d.src=ReviewsApp.IMAGE_STAR_ON;}else d.src=ReviewsApp.IMAGE_STAR_OFF;}}else return false;}function reviews_submit(a,b,c,d){if(c){new Dialog().setTitle(c).setBody(d).setModal(true).setButtons([Dialog.CLOSE]).show();return false;}var e=ge('review_blurb'),f=ge('review_rating'),g=Input.getValue(e),h=f.value,b=$('review_id').value;e.disabled=true;var i=(h<1)||(h>5);if(i){var j="You must choose a star rating",k=$('review_editor_error');DOM.setContent(k,HTML(j));show(k);e.disabled=false;return false;}else{var l=function(m){var n="Post successful.",o=$('review_editor_status');DOM.setContent(o,HTML(n));if(b>0){var p=ge('review_'+b);p.parentNode.removeChild(p);}var q=ge('new_review_container'),r=m.getPayload();if(r.reload)window.location.reload();if(r.oid)$('review_id').value=parseInt(r.oid);DOM.setContent(q,HTML(r.markup));show(o);setTimeout(function(){hide(o);},3000);hide('review_editor_error');hide('reviews_inline_editor');if(ReviewsApp.writeReview){if(ReviewsApp.writeReviewElem)DOM.setContent(ReviewsApp.writeReviewElem,HTML("Update Review"));ReviewsApp.writeReview=false;}};new AsyncRequest().setURI('/ajax/applications/reviews/inline/editor.php?of='+a).setData({review_id:b,rating:h,blurb:g}).setHandler(l).send();e.disabled=false;return true;}}
var EditAppSettings={currentTab:undefined,callbackUrl:'/ajax/edit_app_settings.php',statusElement:'edit_app_settings_save_fill',profileHandler:emptyFunction,extendedHandler:emptyFunction,appID:0,setup:function(a,b,c){this.appID=a;this.profileID=b;this.currentTab=c;return this;},_getCurrentTab:function(){if(!this.currentTab){var a=['profile','bookmark','extended'];for(var b=0;b<a.length;b++)if(ge(this._getTabId(a[b]))){this.currentTab=a[b];break;}}return this.currentTab;},_getTabId:function(a){return a+'_tab_link';},setupHandlers:function(a){this.profileHandler=a.profile||emptyFunction;this.extendedHandler=a.extended||emptyFunction;},switchTab:function(a){CSS.removeClass(this._getTabId(this._getCurrentTab()),'tab_link_selected');hide('app_settings_'+this._getCurrentTab()+'_tab');CSS.addClass(this._getTabId(a),'tab_link_selected');show('app_settings_'+a+'_tab');this.currentTab=a;},isUiMode:function(){return Dialog.getCurrent();},setExtendedPermission:function(a,b){var c=ge('explanation_'+a);if(c)(b?hide:show)(c);var d=new AsyncRequest().setURI(this.callbackUrl).setHandler(this.extendedHandler.bind(this,this.appID,a)).setData({extended:1,permission:a,allow:b,profile_id:this.profileID,app_id:this.appID});if(this.isUiMode())d.setStatusElement(this.statusElement);d.send();return true;},makeProfileChange:function(a){var b=new AsyncRequest().setURI(this.callbackUrl).setHandler(this.profileHandler.bind(this,this.appID)).setData({profile:1,item:'tab',action:a,app_id:this.appID,profile_id:this.profileID});if(this.isUiMode())b.setStatusElement(this.statusElement);b.send();if(this.isUiMode()){toggleDisplayNone('app_settings_profile_tab_add');toggleDisplayNone('app_settings_profile_tab_remove');CSS.toggleClass($('profile_tab_name_changer'),'hidden_elem');}},removeApplication:function(a){var b=a||emptyFunction,c={remove:1,app_id:this.appID,profile_id:this.profileID};new AsyncRequest().setURI(this.callbackUrl).setHandler(b).setData(c).send();},blockApplication:function(a){var b=a||emptyFunction;new AsyncRequest().setURI(this.callbackUrl).setHandler(b).setData({block:1,app_id:this.appID,profile_id:this.profileID}).send();},setBlockComposer:function(a,b){new AsyncRequest().setURI(this.callbackUrl).setHandler(b||emptyFunction).setData({composer:1,blocked_composer:a,profile_id:this.profileID,app_id:this.appID}).send();},reviveComposerDialog:function(a,b){var c=tx._("Unblock {app-name} Publisher?",{'app-name':htmlize(a)}),d='<p>'+"Are you sure you want to allow this application's publisher on your profile? "+'</p>',e="Unblock";new Dialog().setTitle(c).setBody(d).setButtons([{name:'remove',label:e},Dialog.CANCEL]).setHandler(this.setBlockComposer.bind(this,0,b)).show();}};
__d("legacy:string-escape",["escapeJSQuotes","htmlSpecialChars","htmlize","escapeRegex"],function(a,b,c,d){a.escape_js_quotes=b('escapeJSQuotes');a.htmlspecialchars=b('htmlSpecialChars');a.htmlize=b('htmlize');a.escapeRegex=b('escapeRegex');},3);
__d("isEmail",[],function(a,b,c,d,e,f){var g=/^[\w!#\$%&'\*\+\/\=\?\^`\{\|\}~\-]+(:?\.[\w!#\$%&`\*\+\/\=\?\^`\{\|\}~\-]+)*@(?:[a-z0-9](?:[a-z0-9\-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9\-]*[a-z0-9])?$/i;function h(i){return g.test(i);}e.exports=h;});
__d("legacy:string-misc",["htmlHyperlink","isEmail"],function(a,b,c,d){a.html_hyperlink=b('htmlHyperlink');a.is_email=b('isEmail');},3);
__d("Collection",[],function(a,b,c,d,e,f){function g(h,i){if(!h.__collection__){var j=new Function();for(var k in h.prototype)j.prototype[k]=g._call.bind(null,k);h.__collection__=j;}var l=new h.__collection__();l._elements=i;return l;}g._call=function(h){var i=Array.prototype.slice.call(arguments,1);this._elements.forEach(function(j){j[h].apply(j,i);});return this;};e.exports=g;});
__d("Drag",["event-extensions","Arbiter","DOM","Style","Vector"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('DOM'),i=b('Style'),j=b('Vector'),k={};k.currentDraggable=null;k.grab=function(l){if(k.currentDraggable)k._onmouseup();l.lastDragOver=null;k.attachDragEvents();k.currentDraggable=l;};k.attachDragEvents=function(){document.onselectstart=function(){document.onselectstart=null;return false;};if(k.dragEventsAttached)return;k.dragEventsAttached=true;g.subscribe('scroller/scroll',k._onmousemove);Event.listen(document,{mousemove:k._onmousemove,mouseup:k._onmouseup});};k.droppables={};k.addDroppable=function(l,m){(k.droppables[l]=k.droppables[l]||[]).push(m);};k.removeDroppable=function(l,m){k.droppables[l]=k.droppables[l].filter(function(n){return n!=m;});};k.getOffsetParent=function(l){if(h.isNodeOfType(l,['body','html']))return document.body;while((l=l.parentNode)&&l!==document.body)if(i.get(l,'position')!=='static')return l;return document.body;};k._onmousemove=function(event,l){if(!k.currentDraggable)return;var m=l||j.getEventPosition(event),n=k.currentDraggable,o=k.droppables[n.namespace];if(n.namespace&&n.active&&o){var p={};o.forEach(function(v){p[v.zIndex]=v.zIndex;});var q=[];for(var r in p)q.push(p[r]);q.sort();var s=n.lastDragOver,t=null;for(var u=q.length-1;u>=0;u--)if(s&&s.dom!=null&&s.zIndex==q[u]&&s.pointInside(m)){t=s;break;}else for(r=0;r<o.length;r++){if(q[u]!=o[r].zIndex)continue;if(s!=o[r]&&n.dom!=o[r].dom&&o[r].pointInside(m)){t=o[r];u=-1;break;}}if(t&&t!=s){t.ondragover(n);k.currentDraggable.adjustCursorPosition();}if(t)t.ondragmove(n,m.sub(j.getElementPosition(t.dom)));n.lastDragOver=t;}k.currentDraggable._onmousemove(m);};k._onmouseup=function(l){document.onselectstart=null;if(k.currentDraggable){k.currentDraggable._ondrop();k.currentDraggable=null;}};e.exports=k;});
__d("Draggable",["event-extensions","Arbiter","Collection","DOM","Drag","Rect","Style","Vector","emptyFunction"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('Collection'),i=b('DOM'),j=b('Drag'),k=b('Rect'),l=b('Style'),m=b('Vector'),n=b('emptyFunction');function o(r){this.canvas=r;this.scrollZone=50;this.velocity=100;this.coefficient=1;}o.findScrollParent=function(r){var s;r=r.parentNode;while(r){if(r.scrollHeight!=r.offsetTop){s=l.get(r,'overflowY');if(s=='scroll'||s=='auto')return r;}r=r.parentNode;}return document.body;};o.prototype.activate=function(){this.activate=n;this.event=Event.listen(document,'mousemove',this._onmousemove.bind(this));this.interval=setInterval(this._intervalHandler.bind(this),50);this.cursor=null;};o.prototype.deactivate=function(){delete this.activate;this.event&&this.event.remove();this.event=null;clearInterval(this.interval);};o.prototype._onmousemove=function(event){this.cursor=new m.getEventPosition(event);};o.prototype._intervalHandler=function(){if(!this.cursor)return;var r=this.canvas==document.body?k.getViewportBounds():new k(this.canvas),s=new k(this.cursor.y-r.t,r.r-this.cursor.x,r.b-this.cursor.y,this.cursor.x-r.l),t=new m(0,0);if(s.t<s.b&&s.t<this.scrollZone){t.y=-this.scrollZone+s.t;}else if(s.b<this.scrollZone)t.y=this.scrollZone-s.b;t.y=this._doMath(t.y);if(s.l<s.r&&s.l<this.scrollZone){t.x=-this.scrollZone+s.l;}else if(s.r<this.scrollZone)t.x=this.scrollZone-s.r;t.x=this._doMath(t.x);if(t.x||t.y){t.scrollElementBy(this.canvas);if(document.body==this.canvas)this.cursor=this.cursor.add(t);g.inform('scroller/scroll',this.cursor);}};o.prototype._doMath=function(r){r=(r>=0?Math.min(r,this.scrollZone):Math.max(r,-this.scrollZone));return Math.floor(Math.pow(r/this.scrollZone*this.velocity,this.coefficient));};function p(r){if(!r)throw new Error('Element should be a DOM node');if(!(this instanceof p)){if(r instanceof Array){var s=[];r.forEach(function(t){s.push(new p(t));});return new h(p,s);}else return new p(r);}else{this.data={};this.handles=[];this.dom=r;this.boundingBox=null;this.useScroller=true;this.grabPctX=this.grabPctY=0;this.addHandle(this.dom);}}p.prototype.destroy=function(){this.handles.forEach(function(r){this.removeHandle(r.obj);}.bind(this));this.data=this.dom=null;};p.prototype.adjustCursorPosition=function(){var r=m.getElementDimensions(this.dom);this.cursorPositionVector=new m(parseInt(this.grabPctX*r.x,10),parseInt(this.grabPctY*r.y,10));};p.prototype._onclick=function(event){if(this.active)return Event.kill(event);};p.prototype._ongrab=function(r){this.ongrab();if(this.useScroller){if(!this.scroller)this.scroller=new o(o.findScrollParent(this.dom));this.scroller.activate();}if(this.active){if(!this.oldPosition)this.oldPosition=this.dom.style.position;this.dom.style.position=this.absolute?'absolute':'relative';r.sub(this.cursorPositionVector).setElementPosition(this.dom);}};p.prototype._onmousedown=function(event){if(!((event.which&&event.which===1)||(event.button&&event.button===1)))return;var r=event.getTarget();if(i.isNodeOfType(r,['input','select','textarea','object','embed']))return true;var s=m.getEventPosition(event),t=m.getElementDimensions(this.dom);this.draggableInitialVector=m.getElementPosition(this.dom);this.cursorPositionVector=s.sub(this.draggableInitialVector);this.grabPctX=t.x===0?0:this.cursorPositionVector.x/t.x;this.grabPctY=t.y===0?0:this.cursorPositionVector.y/t.y;j.grab(this,event);if(this.gutter){this.cursorInitialVector=s;}else{this._setActive(true);this._ongrab(s);}return Event.kill(event);};p.prototype._onmousemove=function(r){if(!this.active)if(r.distanceTo(this.cursorInitialVector)>=this.gutter){this._setActive(true);this._ongrab(r);}if(this.active){var s=r.sub(this.cursorPositionVector),t;if(this.boundingBox){var u=k.newFromVectors(s,m.getElementDimensions(this.dom));u=u.boundWithin(this.boundingBox);s=u.getPositionVector();if(this.boundingBox.w()===0){t=new m(this.draggableInitialVector.x,s.y,'document');}else if(this.boundingBox.h()===0){t=new m(s.x,this.draggableInitialVector.y,'document');}else t=s;}else t=s;var v=j.getOffsetParent(this.dom);if(v!==document.body)t=t.sub(m.getElementPosition(v));t.setElementPosition(this.dom);this.ondrag(r);}};p.prototype._ondrop=function(){this.scroller&&this.scroller.deactivate();if(this.active){(function(){this._setActive(false);}).bind(this).defer();this.ondrop();if(this.lastDragOver)this.lastDragOver.ondrop(this);}};p.prototype.killDrag=function(){this._setActive(false);j._onmouseup();};p.prototype.setBoundingBox=function(r){this.boundingBox=r;return this;};p.prototype.resetPosition=function(){this.dom.style.position=this.oldPosition;this.oldPosition=null;this.dom.style.left='';this.dom.style.top='';return this;};p.prototype.setUseAbsolute=function(r){this.absolute=r;return this;};p.prototype.ondrag=n;p.prototype.setDragHandler=function(r){this.ondrag=r;return this;};p.prototype.ongrab=n;p.prototype.setGrabHandler=function(r){this.ongrab=r;return this;};p.prototype.ondrop=n;p.prototype.setDropHandler=function(r){this.ondrop=r;return this;};p.prototype.gutter=0;p.prototype.setGutter=function(r){this.gutter=r;return this;};p.prototype.setNamespace=function(r){this.namespace=r;return this;};p.prototype.setUseScroller=function(r){this.useScroller=r;return this;};p.prototype.handles=null;p.prototype.addHandle=function(r){if(this.handles.length==1&&this.handles[0].obj==this.dom)this.removeHandle(this.dom);this.handles.push({obj:r,evt:[Event.listen(r,'mousedown',this._onmousedown.bind(this)),Event.listen(r,'click',this._onclick.bind(this)),Event.listen(r,'drag',q),Event.listen(r,'selectstart',q)]});return this;};function q(r){if(r.getTarget()!==document.activeElement)return r.kill();}p.prototype.removeHandle=function(r){this.handles=this.handles.filter(function(s){if(s.obj!=r){return true;}else{s.evt.forEach(function(t){t.remove();});return false;}});};p.prototype.getDOM=function(){return this.dom;};p.prototype.setKey=function(r,s){this.data[r]=s;return this;};p.prototype.getKey=function(r){return this.data[r];};p.prototype._setActive=function(r){this.dom.activeDrag=this.active=r;for(var s=0;s<this.handles.length;s++)this.handles[s].obj.activeDrag=r;};e.exports=p;});
__d("Droppable",["Collection","Drag","Draggable","Vector","emptyFunction"],function(a,b,c,d,e,f){var g=b('Collection'),h=b('Drag'),i=b('Draggable'),j=b('Vector'),k=b('emptyFunction');function l(m){if(!m)throw new Error('Element should be a DOM node');if(!(this instanceof l)){if(m instanceof Array){var n=[];m.forEach(function(o){n.push(new l(o));});return new g(l,n);}else return new l(m);}else{this.data={};this.dom=m;this.namespace=null;}}l.prototype.destroy=function(){if(this.namespace)h.removeDroppable(this.namespace,this);this.data=this.dom=null;};l.prototype.setNamespace=function(m){if(this.namespace)h.removeDroppable(this.namespace,this);this.namespace=m;h.addDroppable(m,this);return this;};l.prototype.zIndex=0;l.prototype.setZIndex=function(m){this.zIndex=m;return this;};l.prototype.pointInside=function(m){var n=j.getElementPosition(this.dom);return n.x<=m.x&&this.dom.offsetWidth+n.x>m.x&&n.y<=m.y&&this.dom.offsetHeight+n.y>m.y;};l.prototype.ondragover=k;l.prototype.setDragOverHandler=function(m){this.ondragover=m;return this;};l.prototype.ondragmove=k;l.prototype.setDragMoveHandler=function(m){this.ondragmove=m;return this;};l.prototype.ondrop=k;l.prototype.setDropHandler=function(m){this.ondrop=m;return this;};l.prototype.getDOM=i.prototype.getDOM;l.prototype.setKey=i.prototype.setKey;l.prototype.getKey=i.prototype.getKey;e.exports=l;});
__d("SortableGroup",["CSS","DOM","Draggable","Droppable","Style","Vector","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DOM'),i=b('Draggable'),j=b('Droppable'),k=b('Style'),l=b('Vector'),m=b('copyProperties'),n=b('emptyFunction');function o(){this.namespace='sortable'+(++o.instanceCount);this.draggables={};this.droppables={};this.sortables={};this.linkedGroups=[];this.linkedGroups.onbeforelinkjump=n;this.linkedGroups.onlinkjump=n;this.rootNode=null;this.boundingBox=null;this.neverEmpty=false;this.hasEmptyMessage=false;this.isDroppable=true;this.isDraggable=true;this.requireSameParent=true;this.anchor=null;this.disabled=false;this.autoWidth=false;}o.instanceCount=0;m(o.prototype,{gutter:15,onbeforegrabcallback:n,onbeforedragover:n,ondragover:n,ondropcallback:n,ongrabcallback:n,onorderchange:n,addEmptyMessage:function(p,q){var r='placeholder';if(p.parentNode!=q)h.appendContent(q,p);this.emptyMessage=p;this._initializeAdded(r,p);this.hasEmptyMessage=true;this.sortables[r]=p;this.droppables[r]=(new j(p)).setNamespace(this.namespace).setDragOverHandler(this._dragOverHandlerShim.bind(this,r));return this;},setAutoWidth:function(p){this.autoWidth=p;},removeEmptyMessage:function(){if(this.emptyMessage)h.remove(this.emptyMessage);this.hasEmptyMessage=false;this.removeSortable('placeholder');return this;},addSortable:function(p,q,r){this._initializeAdded(p,q);this.sortables[p]=q;this.draggables[p]=(new i(q)).setNamespace(this.namespace).setGutter(this.gutter).setUseAbsolute(true).setGrabHandler(this.grabHandler.bind(this,p)).setDropHandler(this.dropHandler.bind(this,p)).setKey('key',p).setBoundingBox(this.boundingBox);if(r)this.draggables[p].addHandle(r);this.droppables[p]=(new j(q)).setNamespace(this.namespace).setDragOverHandler(this._dragOverHandlerShim.bind(this,p));return this;},destroy:function(){for(var p in this.droppables)this.droppables[p].destroy();for(var q in this.draggables)this.draggables[q].destroy();this.droppables=this.draggables=this.rootNode=null;this.linkedGroups.remove(this);for(var r=0;r<this.linkedGroups.length;r++)this.linkedGroups[r].linkedGroups=this.linkedGroups;},dragOverHandler:function(p,q){if(!this.isDroppable&&!this.anchor)return;var r=false;if(!(q in this.draggables)){this.linkedGroups.onbeforelinkjump.call(this,q);if(!this.migrateLinkedSortable(q))throw new Error('Draggable dropped onto a foreign droppable!');r=true;}var s=true,t=this.getSortables(),u=this.sortables[q],v=this.sortables[p];if(!this.anchor){var w=t.length;for(var x=0;x<w;x++)if(t[x]==v){break;}else if(t[x]==u){s=false;break;}}else v=this.anchor;this.onbeforedragover(u,v);var y=this.linkedGroups.placeholder;this.insertPlaceholder(y,v,s||this.anchor);y.parentNode.insertBefore(u,y);this.ondragover(u,v);if(r)this.linkedGroups.onlinkjump.call(this,q);},dropHandler:function(p){if(this._checkLastRemaining()){this.draggables[p].resetPosition();return;}var q=this.linkedGroups.placeholder;g.removeClass(this.sortables[p],'drag');this.draggables[p].resetPosition();q.parentNode.insertBefore(this.sortables[p],q);q.parentNode.removeChild(q);for(var r=0;r<this.linkedGroups.length;r++)if(this.linkedGroups[r].anchor)delete this.linkedGroups[r].anchor;this.ondropcallback(p,this.sortables[p]);this.onorderchange();},getOrder:function(){var p=[],q=this.getSortables();for(var r=0;r<q.length;r++)for(var s in this.sortables)if(this.sortables[s]==q[r]){p.push(s);break;}return p;},getSortables:function(){return this.rootNode?this.rootNode.childNodes:[];},grabHandler:function(p){if(this.disabled||this._checkLastRemaining()||!this.isDraggable){this.draggables[p].killDrag();return;}this.onbeforegrabcallback(this.sortables[p],p);var q=this.linkedGroups.placeholder,r=this.sortables[p];g.setClass(q,r.className);g.addClass(q,'droppable_placeholder');g.addClass(r,'drag');l.getElementDimensions(r).setElementDimensions(q);if(this.autoWidth)k.set(q,'width','auto');r.parentNode.insertBefore(q,r);this.ongrabcallback(this.sortables[p],p);if(!this.isDroppable){this.anchor=r.nextSibling;if(!this.anchor){this.anchor=h.create('div');r.parentNode.appendChild(this.anchor);}}},insertPlaceholder:function(p,q,r){if(r){h.insertBefore(q,p);}else h.insertAfter(q,p);},keyExists:function(p){return this.sortables[p];},link:function(p){p.linkedGroups=this.linkedGroups;if(!this.linkedGroups.length)this.linkedGroups.push(this);this.linkedGroups.push(p);for(var q=0;q<this.linkedGroups.length;q++)if(this.linkedGroups[q].namespace!=this.namespace){this.linkedGroups[q].namespace=this.namespace;for(var r in this.linkedGroups[q].droppables){this.linkedGroups[q].droppables[r].setNamespace(this.namespace);var s=this.linkedGroups[q].draggables[r];s&&s.setNamespace(this.namespace);}}return this;},migrateLinkedSortable:function(p){for(var q=0;q<this.linkedGroups.length;q++)if(p in this.linkedGroups[q].draggables){this.sortables[p]=this.linkedGroups[q].sortables[p];this.draggables[p]=this.linkedGroups[q].draggables[p];this.draggables[p].setGrabHandler(this.grabHandler.bind(this,p)).setDropHandler(this.dropHandler.bind(this,p));this.droppables[p]=this.linkedGroups[q].droppables[p];this.droppables[p].setDragOverHandler(this._dragOverHandlerShim.bind(this,p));delete this.linkedGroups[q].sortables[p];delete this.linkedGroups[q].draggables[p];delete this.linkedGroups[q].droppables[p];return true;}return false;},removeSortable:function(p){if(p in this.sortables){if(p in this.draggables)this.draggables[p].destroy();if(p in this.droppables)this.droppables[p].destroy();delete this.draggables[p];delete this.droppables[p];delete this.sortables[p];}},setDisabled:function(p){this.disabled=p;return this;},forceDrop:function(p){if(p in this.sortables)this.draggables[p].killDrag();},setBeforeGrabCallback:function(p){this.onbeforegrabcallback=p;return this;},setBoundingBox:function(p){this.boundingBox=p;for(var q in this.draggables)this.draggables[q].setBoundingBox(this.boundingBox);return this;},setBeforeDragOverCallback:function(p){this.onbeforedragover=p;return this;},setDragOverCallback:function(p){this.ondragover=p;return this;},setDropCallback:function(p){this.ondropcallback=p;return this;},setDroppable:function(p){this.isDroppable=p;return this;},setDraggable:function(p){this.isDraggable=p;return this;},setGrabCallback:function(p){this.ongrabcallback=p;return this;},setBeforeLinkJumpHandler:function(p){this.linkedGroups.onbeforelinkjump=p;return this;},setInsertPlaceholderHandler:function(p){this.insertPlaceholder=p;},setLinkJumpHandler:function(p){this.linkedGroups.onlinkjump=p;return this;},setNeverEmpty:function(p){this.neverEmpty=p;},setOrderChangeHandler:function(p){this.onorderchange=p;return this;},setRequireSameParent:function(p,q){this.requireSameParent=q;},setSortablesGetter:function(p){this.getSortables=p;},_checkLastRemaining:function(p){var q=this.hasEmptyMessage?2:1;return this.neverEmpty&&this.getSortables().length==q;},_dragOverHandlerShim:function(p,q){this.dragOverHandler(p,q.getKey('key'));},_initializeAdded:function(p,q){if(this.rootNode===null){this.rootNode=q.parentNode;if(!this.linkedGroups.placeholder)this.linkedGroups.placeholder=h.create(q.tagName,{className:'dragPlaceholder',style:{padding:'0'}});}else if(this.requireSameParent&&this.rootNode!=q.parentNode)throw new Error('All sortables of a collection must share the same parentNode');if(p in this.draggables)throw new Error('All sortables must have a unique key');}});e.exports=a.SortableGroup||o;});
__d("legacy:sort",["SortableGroup"],function(a,b,c,d){a.SortableGroup=b('SortableGroup');},3);
var EditAppsController={BOOKMARKS_VIEW:'bookmarks',currentView:'',sortableGroup:null,ownedApps:null,init:function(a,b){this.profileID=a;this.ownedApps=b;EditAppSettings.setupHandlers({profile:this.changeProfileCallback,extended:this.setExtendedPermissionCallback});},setView:function(a){this.currentView=a;},switchView:function(a){goURI(new URI('/editapps.php').addQueryData({v:a}).toString());},changeProfileCallback:function(a){if(ge('editapps_tab_'+a)){toggleDisplayNone('editapps_tab_'+a);toggleDisplayNone('editapps_tab_'+a+'_undo');}},removeApplication:function(a,b,c){var d=htmlize(b),e=tx._("Remove {application-name}?",{'application-name':d}),f='<a href="/?sk=apps">'+"Apps Page"+'</a>',g='<p>'+tx._("If you remove {application-name}, it will be taken off your timeline, bookmarks and from the list of apps you use in your settings. You can also block apps to prevent them from accessing the non-public information you share with others who use them.",{'application-name':d,'applications-link':f})+'</p>';g+='<input type="hidden" name="remove_appId" value="'+a+'" />';var h={name:'remove',label:"Remove"},i=[h,Dialog.CANCEL];g='<div class="remove_application_dialog">'+g+'</div>';new Dialog().setTitle(e).setBody(g).setButtons(i).setModal(true).setHandler(function(){EditAppSettings.setup(a,this.profileID).removeApplication(c);}).show();return false;},setExtendedPermission:function(a,b,c){EditAppSettings.setup(a,this.profileID).setExtendedPermission(b,c);return true;},setExtendedPermissionCallback:function(a,b){toggleDisplayNone('editapps_extperm_'+b+'_'+a);toggleDisplayNone('editapps_extperm_'+b+'_'+a+'_undo');},addSortable:function(a){var b=$('editapps_bookmarked_wrapper_'+a);this.sortableGroup.addSortable(a,b);}};
function MegaphoneEmailStoriesHelper(){}copyProperties(MegaphoneEmailStoriesHelper,{_endpoint_uri:'/ajax/emails/email_stories.php',submitEmail:function(a,b){form=document.forms[a];if(form&&!this.pending_request){email=form.elements[b];if(email&&email.value!=''&&is_email(email.value)){this.pending_request=true;this._ajaxSubmitForm(a,{divid:a});}}return false;},resendEmail:function(a,b,c){if(a!=''&&b!=''){form=document.forms[a];if(form&&!this.pending_request){if(form.elements.newemail)form.elements.newemail.value='';this.pending_request=true;this._ajaxSubmitForm(a,{resend:1,divid:a});}}return false;},cancelEmail:function(a,b){if(a!=''&&b!=''){form=document.forms[a];if(form){if(form.elements.newemail)form.elements.newemail.value='';this._ajaxSubmitForm(a,{cancel:1,divid:a});}}return false;},_ajaxSubmitForm:function(a,b){var c=Form.serialize(document.forms[a]);copyProperties(c,b);new AsyncRequest().setURI(this._endpoint_uri).setData(c).setHandler(function(d){var e=d.getPayload();if(document.forms[a].modal&&document.forms[a].modal.value==1)Dialog.hideCurrent();if(e.show_msg)new Dialog().setTitle(e.title).setBody(e.msg).setButtons([Dialog.OK]).show();}).setFinallyHandler(bind(this,function(d){this.pending_request=false;var e=d.getPayload();if(e.redirect)goURI(e.redirect_uri);if(e.hide_mp){hide(a);}else if(e.replace_mp){var f=DOM.find($('pagelet_megaphone'),'div.UIContentBox');if(e.success){CSS.addClass(f,'megaphone_story_highlighted');}else CSS.removeClass(f,'megaphone_story_highlighted');DOM.setContent($('DarkMergeRoosterHeader'),HTML(e.new_header));DOM.setContent($('DarkMergeRoosterBody'),HTML(e.new_body));}})).send();}});
function PhotoInlineOrganizer(a,b){this.root=$(a);this.url=b;this.IDLE='idle';this.PENDING='pending';this.SAVING='saving';this.UP='up';this.DOWN='down';this.state=this.IDLE;this.sortable=new SortableGroup();this.sortable.setAutoWidth(PhotoInlineOrganizer.autoWidth);this.sortable.setRequireSameParent(false);this.sortable.setSortablesGetter(function(){return DOM.scry(this.root,'div.dragWrapper');}.bind(this));this.sortable.setInsertPlaceholderHandler(this.insertPlaceholder.bind(this));this.sortable.setOrderChangeHandler(this.onSave.bind(this));PhotoInlineOrganizer.cache[a]=this;PhotoInlineOrganizer.refresh(a);this.order=this.sortable.getOrder();this.offsetDelta=0;Event.listen(this.root,'click',this.moveListener.bind(this));}PhotoInlineOrganizer.cache={};PhotoInlineOrganizer.refresh=function(a){var b=PhotoInlineOrganizer.cache[a];DOM.scry(b.root,'td').forEach(function(c){if(c.getAttribute('data-id')){var d=DOM.find(c,'div.dragWrapper'),e=DOM.find(d,'a.uiMediaThumb');b.sortable.addSortable(c.getAttribute('data-id'),d,e);c.removeAttribute('data-id');}});};PhotoInlineOrganizer.getInlineOrganizer=function(a){var b=$(a),c=DOM.scry(b,'table')[0];return PhotoInlineOrganizer.cache[c.id];};PhotoInlineOrganizer.setOffsetDelta=function(a,b){var c=PhotoInlineOrganizer.getInlineOrganizer(a);c.offsetDelta=Math.max(c.offsetDelta,b);};PhotoInlineOrganizer.setAutoWidth=function(a,b){var c=PhotoInlineOrganizer.getInlineOrganizer(a);c.sortable.setAutoWidth(b);};PhotoInlineOrganizer.appendToExisting=function(a,b){var c=PhotoInlineOrganizer.getInlineOrganizer(a),d=DOM.find(c.root,'tbody'),e=$(b),f=DOM.find(e,'table');DOM.scry(f,'tr').forEach(function(h){d.appendChild(h);});var g=DOM.scry(e,'.uiMorePager');if(g.length>0)e.appendChild(g[0].parentNode);PhotoInlineOrganizer.refresh(c.root.id);};copyProperties(PhotoInlineOrganizer.prototype,{getItems:function(){return DOM.scry(this.root,'div.dragWrapper').filter(function(a){return !CSS.hasClass(a,'drag');});},moveListener:function(event){var a=event.getTarget();if(CSS.hasClass(a,'arrow')){this.movePhoto(Parent.byClass(a,'dragWrapper'),CSS.hasClass(a,this.DOWN)?this.DOWN:this.UP);a.focus();return false;}},movePhoto:function(a,b){var c=DOM.scry(this.root,'td'),d=this.getItems(),e=d.indexOf(a),f=0;if(b==this.UP&&e>0){f=-1;}else if(b==this.DOWN&&e<d.length-1)f=1;if(f!==0){DOM.appendContent(c[e+this.offsetDelta],d[e+f]);DOM.appendContent(c[e+f+this.offsetDelta],d[e]);}this.onSave();},save:function(){if(this.state!=this.IDLE){this.state=this.PENDING;}else{this.state=this.SAVING;new AsyncRequest().setURI(this.url).setMethod('POST').setData({order:this.order}).setHandler(this.saveResponse.bind(this)).setErrorHandler(this.saveResponse.bind(this)).send();}},saveResponse:function(a){var b=this.state;this.state=this.IDLE;if(b==this.PENDING)this.save();if(a.getError())AsyncResponse.verboseErrorHandler(a);},onSave:function(){var a=this.sortable.getOrder();if(a.join('|')!=this.order.join('|')){this.order=a;this.save();}},insertPlaceholder:function(a,b,c){var d=DOM.scry(this.root,'td'),e=this.getItems(),f=e.indexOf(b),g=e.indexOf(a),h;if(f>g){for(h=g;h<f;h++)DOM.appendContent(d[h+this.offsetDelta],e[h+1]);}else for(h=g-1;h>=f;h--)DOM.appendContent(d[h+1+this.offsetDelta],e[h]);DOM.appendContent(d[f+this.offsetDelta],a);}});